<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Stok Produk v49 - Advanced CDN System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Advanced Glass Morphism */
        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Advanced Card Styles */
        .advanced-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .advanced-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .advanced-card:hover::before {
            left: 100%;
        }
        
        .advanced-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(102, 126, 234, 0.2);
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        /* Advanced Sidebar */
        .advanced-sidebar {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(25px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-item {
            position: relative;
            margin: 8px 12px;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .sidebar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }
        
        .sidebar-item:hover::before,
        .sidebar-item.active::before {
            left: 0;
        }
        
        .sidebar-item:hover,
        .sidebar-item.active {
            color: white;
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        /* Advanced Table */
        .advanced-table {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .table-row {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
        }
        
        .table-row:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, rgba(255, 255, 255, 0.8) 100%);
            border-left-color: #667eea;
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }
        
        /* Advanced Stats Cards */
        .stat-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        /* Advanced Buttons */
        .btn-advanced {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-advanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-advanced:hover::before {
            left: 100%;
        }
        
        .btn-advanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-advanced:active {
            transform: translateY(0);
        }
        
        /* Advanced Form Inputs */
        .form-advanced {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-advanced:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.95);
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        /* Advanced Badges */
        .badge-advanced {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .badge-primary { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.3) 100%); color: #1d4ed8; }
        .badge-success { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.3) 100%); color: #047857; }
        .badge-warning { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(245, 158, 11, 0.3) 100%); color: #92400e; }
        .badge-danger { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.3) 100%); color: #991b1b; }
        
        /* Loading Animations */
        .loading-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .loading-spin {
            animation: spin 1s linear infinite;
        }
        
        .loading-bounce {
            animation: bounce 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: none; animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .animate-slideInUp { animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-slideInRight { animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-fadeIn { animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Advanced Progress Bar */
        .progress-advanced {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar-advanced {
            background: var(--primary-gradient);
            height: 8px;
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar-advanced::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        

        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .advanced-sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
                height: 100vh;
                width: 280px;
            }
            
            .advanced-sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
                padding: 12px;
            }
            
            .fab {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .stat-card {
                padding: 16px;
            }
            
            .advanced-card {
                margin: 8px 0;
                padding: 16px !important;
            }
            
            /* Mobile table styles */
            .advanced-table {
                border-radius: 12px;
            }
            
            .mobile-table-card {
                background: white;
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                border-left: 4px solid #3B82F6;
            }
            
            .mobile-table-header {
                font-weight: bold;
                color: #1F2937;
                margin-bottom: 8px;
                font-size: 16px;
            }
            
            .mobile-table-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 4px 0;
                border-bottom: 1px solid #F3F4F6;
            }
            
            .mobile-table-row:last-child {
                border-bottom: none;
            }
            
            .mobile-table-label {
                font-weight: 600;
                color: #6B7280;
                font-size: 12px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .mobile-table-value {
                font-weight: bold;
                color: #1F2937;
                text-align: right;
            }
            
            /* Hide desktop table on mobile */
            .desktop-table {
                display: table;
            }
            
            .mobile-table {
                display: none;
            }
            
            @media (max-width: 768px) {
                .desktop-table {
                    display: none;
                }
                
                .mobile-table {
                    display: block;
                }
            }
            
            /* Mobile stats grid */
            .grid {
                gap: 16px;
            }
            
            @media (max-width: 640px) {
                .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-4 {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .grid-cols-1.md\\:grid-cols-4 {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .grid-cols-1.md\\:grid-cols-3 {
                    grid-template-columns: repeat(1, 1fr);
                }
            }
            
            /* Mobile text sizes */
            h2 {
                font-size: 2rem !important;
                line-height: 1.2;
            }
            
            .text-5xl {
                font-size: 2rem !important;
            }
            
            .text-4xl {
                font-size: 1.5rem !important;
            }
            
            .text-2xl {
                font-size: 1.25rem !important;
            }
            
            .text-xl {
                font-size: 1rem !important;
            }
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .glass-morphism {
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .advanced-card {
                background: linear-gradient(145deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.7) 100%);
                border: 1px solid rgba(255, 255, 255, 0.1);
                color: white;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
        
        /* Advanced Search */
        .search-container {
            position: relative;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .search-results.show {
            display: block;
        }
        
        .search-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .search-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .search-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="advanced-card p-8 w-full max-w-md mx-4 animate-slideInUp">
            <div class="text-center mb-8">
                <div class="mx-auto w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center mb-6 shadow-2xl transform hover:scale-105 transition-transform">
                    <div class="text-white text-4xl">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <h2 class="text-4xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">Dashboard v49</h2>
                <p class="text-gray-600 font-medium text-lg">Advanced Stock Management System</p>
                <div class="mt-4 flex items-center justify-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-sm text-gray-500 font-medium">CDN Data Ready</span>
                </div>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">Username</label>
                    <div class="relative">
                        <input type="text" id="username" required 
                               class="form-advanced w-full pl-12 pr-4 py-4"
                               placeholder="Enter your username" autocomplete="username">
                        <i class="fas fa-user absolute left-4 top-5 text-blue-500"></i>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">Password</label>
                    <div class="relative">
                        <input type="password" id="password" required 
                               class="form-advanced w-full pl-12 pr-12 py-4"
                               placeholder="Enter your password" autocomplete="current-password">
                        <i class="fas fa-lock absolute left-4 top-5 text-blue-500"></i>
                        <button type="button" onclick="togglePassword()" class="absolute right-4 top-5 text-gray-400 hover:text-blue-500 transition-colors">
                            <i id="passwordToggle" class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div id="loginError" class="hidden bg-red-50 border-l-4 border-red-500 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                        <span class="text-red-700 font-medium">Invalid credentials! Please try again.</span>
                    </div>
                </div>
                
                <button type="submit" class="btn-advanced w-full py-4 text-lg font-bold shadow-xl">
                    <span id="loginButtonText" class="flex items-center justify-center">
                        <i class="fas fa-sign-in-alt mr-3"></i>Access Dashboard
                    </span>
                    <div id="loginSpinner" class="hidden flex items-center justify-center">
                        <div class="loading-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full mr-3"></div>
                        Authenticating...
                    </div>
                </button>
            </form>
            
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="advanced-card p-6">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center">
                        <i class="fas fa-key text-blue-500 mr-2"></i>Demo Accounts
                    </h4>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Admin:</span>
                            <span class="font-mono text-blue-600 font-bold">admin / admin123</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Manager:</span>
                            <span class="font-mono text-green-600 font-bold">manager / manager123</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Staff:</span>
                            <span class="font-mono text-purple-600 font-bold">staff / staff123</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Header -->
    <div class="md:hidden glass-morphism shadow-xl px-6 py-4 flex items-center justify-between relative z-40">
        <button onclick="UI.toggleSidebar()" class="text-blue-600 hover:text-purple-600 transition-colors p-2 rounded-lg hover:bg-blue-50">
            <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="flex items-center">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
                <i class="fas fa-chart-line text-white text-lg"></i>
            </div>
            <div>
                <h1 class="text-lg font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Dashboard v49</h1>
                <p class="text-xs text-gray-500 font-medium">Advanced System</p>
            </div>
        </div>
        <div class="w-10"></div>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay fixed inset-0 bg-black bg-opacity-50 z-30 hidden backdrop-blur-sm" onclick="UI.closeSidebar()"></div>

    <!-- Advanced Sidebar -->
    <div class="advanced-sidebar fixed left-0 top-0 h-full w-80 z-40">
        <div class="p-8 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mr-4 shadow-xl">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Dashboard</h1>
                        <p class="text-sm text-gray-500 font-bold mt-1">Advanced System</p>
                    </div>
                </div>
                <button onclick="UI.closeSidebar()" class="md:hidden text-gray-600 hover:text-purple-600 transition-colors p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
        </div>
        
        <!-- User Info -->
        <div id="userInfo" class="px-6 py-6 border-b border-gray-200 hidden">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mr-4 shadow-lg">
                        <i class="fas fa-user text-white"></i>
                    </div>
                    <div>
                        <div class="text-sm font-bold text-gray-800" id="userName">-</div>
                        <div class="text-xs text-gray-500 capitalize font-semibold" id="userRole">-</div>
                    </div>
                </div>
                <button onclick="Auth.logout()" class="text-gray-400 hover:text-red-500 transition-colors p-2 rounded-lg hover:bg-red-50" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <nav class="mt-8 px-6 space-y-4">
            <a href="#" class="sidebar-item active flex items-center px-6 py-4 text-white rounded-2xl font-bold shadow-lg" onclick="Navigation.showSection('dashboard')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-tachometer-alt text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Main Dashboard</div>
                    <div class="text-xs opacity-75">Stock Overview</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('analytics')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-chart-bar text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Analytics</div>
                    <div class="text-xs opacity-75">Advanced Reports</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('rekap-po')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-file-invoice text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">PO Summary</div>
                    <div class="text-xs opacity-75">Purchase Orders</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('rekap-brand')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-tags text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Brand Analysis</div>
                    <div class="text-xs opacity-75">Brand Performance</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('rekap-lokasi')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-map-marker-alt text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Location Tracking</div>
                    <div class="text-xs opacity-75">Warehouse Data</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('code-breakdown')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-code text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Code Breakdown</div>
                    <div class="text-xs opacity-75">Product Codes</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('data-entry-summary')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-calendar-alt text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Data Entry Summary</div>
                    <div class="text-xs opacity-75">Daily Breakdown</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('real-time')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-broadcast-tower text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Real-time Monitor</div>
                    <div class="text-xs opacity-75">Live Updates</div>
                </div>
            </a>
        </nav>
        

    </div>

    <!-- Main Content -->
    <div class="main-content ml-80 p-8 min-h-screen">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section animate-fadeIn">
            <!-- Header -->
            <div class="mb-10">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-5xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">Advanced Dashboard v49</h2>
                        <p class="text-gray-600 text-xl font-semibold">Real-time Stock Management & Analytics System</p>
                    </div>
                </div>
            </div>



            <!-- Advanced Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="totalItems">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total MC</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Master Cartons</span>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="totalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Weight</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Kilograms</span>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="uniqueProducts">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Products</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-cube text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-purple-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Unique Items</span>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.4s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-orange-600 mb-2" id="uniqueBrands">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Brands</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tags text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-orange-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Brand Count</span>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="advanced-card p-8 mb-10 animate-slideInUp" style="animation-delay: 0.5s">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-black text-gray-800">Advanced Filters</h3>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                            <span class="text-sm font-semibold text-gray-600">Real-time Filtering</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div id="connectionStatus" class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span id="connectionText" class="text-sm font-semibold text-gray-600">Google Sheets</span>
                        </div>
                        <div id="lastUpdateTime" class="text-xs text-gray-500 font-medium">
                            Target Date: Loading...
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Start Date</label>
                        <input type="date" id="startDate" class="form-advanced w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">End Date</label>
                        <input type="date" id="endDate" class="form-advanced w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Brand Selection</label>
                        <select id="brandFilter" class="form-advanced w-full">
                            <option value="">All Brands</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="search-container">
                        <label class="block text-sm font-bold text-gray-700 mb-3">Smart Search</label>
                        <div class="relative">
                            <input type="text" id="searchProduct" placeholder="Search products, brands, packaging, or PO numbers..." 
                                   class="form-advanced w-full pl-12 pr-4" onkeyup="SmartSearch.performSearch()">
                            <i class="fas fa-search absolute left-4 top-4 text-blue-500"></i>
                        </div>
                        <div id="searchResults" class="search-results"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Location Filter</label>
                        <select id="locationFilter" class="form-advanced w-full">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Sort By</label>
                        <select id="sortBy" class="form-advanced w-full" onchange="SmartSearch.applySorting()">
                            <option value="date-desc">Date (Newest First)</option>
                            <option value="date-asc">Date (Oldest First)</option>
                            <option value="product-asc">Product Name (A-Z)</option>
                            <option value="product-desc">Product Name (Z-A)</option>
                            <option value="brand-asc">Brand (A-Z)</option>
                            <option value="brand-desc">Brand (Z-A)</option>
                            <option value="mc-desc">MC Quantity (High to Low)</option>
                            <option value="mc-asc">MC Quantity (Low to High)</option>
                            <option value="kg-desc">Weight (Heavy to Light)</option>
                            <option value="kg-asc">Weight (Light to Heavy)</option>
                            <option value="po-asc">PO Number (A-Z)</option>
                            <option value="po-desc">PO Number (Z-A)</option>
                        </select>
                    </div>

                </div>
                
                <div class="flex flex-wrap gap-4">
                    <button onclick="Filters.apply()" class="btn-advanced px-8 py-3 shadow-xl">
                        <i class="fas fa-filter mr-2"></i>Apply Filters
                    </button>
                    <button onclick="Filters.reset()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-undo mr-2"></i>Reset All
                    </button>
                    <button onclick="DataLoader.loadFromJSON()" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl" id="refreshBtn">
    <i class="fas fa-sync-alt mr-2"></i>Refresh Data
</button>
                    <button onclick="Export.toPDF()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-file-pdf mr-2"></i>Export PDF
                    </button>
                </div>
            </div>



            <!-- Advanced Data Table -->
            <div class="advanced-table animate-slideInUp" style="animation-delay: 0.7s">
                <div class="table-header px-4 md:px-8 py-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg md:text-xl font-black">Stock Data Table</h3>
                        <div class="flex items-center space-x-4">
                            <span class="text-xs md:text-sm font-semibold opacity-90">Real-time Data</span>
                            <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Table -->
                <div class="desktop-table overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-blue-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(0)">
                                    Date <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(1)">
                                    Product <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(2)">
                                    Packaging <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(3)">
                                    Brand <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(4)">
                                    Code <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(5)">
                                    PO Number <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(6)">
                                    MC Qty <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(7)">
                                    Weight (Kg) <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(8)">
                                    Location <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile Table -->
                <div class="mobile-table p-4" id="mobileStockTable">
                    <!-- Mobile cards populated by JavaScript -->
                </div>
                
                <!-- Advanced Pagination -->
                <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-4 md:px-8 py-6 border-t border-gray-200">
                    <!-- Mobile Pagination -->
                    <div class="md:hidden">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-xs text-gray-700 font-bold">
                                <span id="showingStartMobile" class="font-black text-blue-600">0</span> - <span id="showingEndMobile" class="font-black text-blue-600">0</span> of <span id="totalRecordsMobile" class="font-black text-blue-600">0</span>
                            </div>
                            <select id="itemsPerPageMobile" onchange="Table.changeItemsPerPage()" class="form-advanced text-xs py-1 px-2">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="25">25</option>
                            </select>
                        </div>
                        <div class="flex items-center justify-center space-x-2">
                            <button onclick="Table.firstPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="firstBtnMobile">
                                <i class="fas fa-angle-double-left text-blue-600"></i>
                            </button>
                            <button onclick="Table.previousPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="prevBtnMobile">
                                <i class="fas fa-angle-left text-blue-600"></i>
                            </button>
                            <span id="pageInfoMobile" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-black shadow-lg text-sm">1</span>
                            <button onclick="Table.nextPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="nextBtnMobile">
                                <i class="fas fa-angle-right text-blue-600"></i>
                            </button>
                            <button onclick="Table.lastPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="lastBtnMobile">
                                <i class="fas fa-angle-double-right text-blue-600"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Desktop Pagination -->
                    <div class="hidden md:flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-700 font-bold">
                                Showing <span id="showingStart" class="font-black text-blue-600">0</span> - <span id="showingEnd" class="font-black text-blue-600">0</span> of <span id="totalRecords" class="font-black text-blue-600">0</span>
                            </div>
                            <select id="itemsPerPage" onchange="Table.changeItemsPerPage()" class="form-advanced text-sm py-2 px-3">
                                <option value="10">10 per page</option>
                                <option value="25">25 per page</option>
                                <option value="50">50 per page</option>
                                <option value="100">100 per page</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="Table.firstPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="firstBtn">
                                <i class="fas fa-angle-double-left text-blue-600"></i>
                            </button>
                            <button onclick="Table.previousPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="prevBtn">
                                <i class="fas fa-angle-left text-blue-600"></i>
                            </button>
                            <span id="pageInfo" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-black shadow-lg">1</span>
                            <button onclick="Table.nextPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="nextBtn">
                                <i class="fas fa-angle-right text-blue-600"></i>
                            </button>
                            <button onclick="Table.lastPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="lastBtn">
                                <i class="fas fa-angle-double-right text-blue-600"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-3">Advanced Analytics</h2>
                <p class="text-gray-600 text-xl font-semibold">Real-time Data Visualization & Insights</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Brand Distribution</h3>
                    <div class="h-80">
                        <canvas id="brandChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Stock Trend</h3>
                    <div class="h-80">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- PO Summary Section -->
        <div id="rekap-po-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-blue-600 to-green-600 bg-clip-text text-transparent mb-3">📁 PO Summary</h2>
                <p class="text-gray-600 text-xl font-semibold">Purchase Order Analysis & Tracking</p>
            </div>
            
            <!-- PO Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="totalPOs">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total POs</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-file-invoice text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="activePOs">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Active POs</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-check-circle text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="poTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total MC</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-orange-600 mb-2" id="poTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Weight</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PO Table -->
            <div class="advanced-table animate-slideInUp">
                <div class="table-header px-8 py-6">
                    <h3 class="text-xl font-black">Purchase Order Details</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-blue-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">PO Number</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Date</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Items</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total MC</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total Weight</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="poTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Brand Analysis Section -->
        <div id="rekap-brand-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-3">🏷️ Brand Analysis</h2>
                <p class="text-gray-600 text-xl font-semibold">Brand Performance & Distribution Analysis</p>
            </div>
            
            <!-- Brand Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="totalBrands">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Brands</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tags text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-pink-600 mb-2" id="topBrand">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Top Brand</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-pink-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-crown text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-indigo-600 mb-2" id="brandTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg MC/Brand</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-chart-pie text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-teal-600 mb-2" id="brandTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg Kg/Brand</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-teal-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-balance-scale text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Brand Chart and Table -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Brand Distribution</h3>
                    <div class="h-80">
                        <canvas id="brandDistributionChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Top Brands by Weight</h3>
                    <div class="space-y-4" id="topBrandsList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Brand Table -->
            <div class="advanced-table animate-slideInUp">
                <div class="table-header px-8 py-6">
                    <h3 class="text-xl font-black">Brand Performance Details</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-purple-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Brand Name</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Products</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total MC</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total Weight</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Market Share</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Performance</th>
                            </tr>
                        </thead>
                        <tbody id="brandTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Location Tracking Section -->
        <div id="rekap-lokasi-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent mb-3">📍 Location Tracking</h2>
                <p class="text-gray-600 text-xl font-semibold">Warehouse Distribution & Location Analysis</p>
            </div>
            
            <!-- Location Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="totalLocations">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Locations</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-map-marker-alt text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-teal-600 mb-2" id="busyLocation">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Busiest</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-teal-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-warehouse text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="locationTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg MC/Location</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="locationTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg Kg/Location</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Location Chart and Capacity -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Location Distribution</h3>
                    <div class="h-80">
                        <canvas id="locationChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Warehouse Capacity</h3>
                    <div class="space-y-6" id="warehouseCapacity">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Location Table -->
            <div class="advanced-table animate-slideInUp">
                <div class="table-header px-8 py-6">
                    <h3 class="text-xl font-black">Location Details</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-green-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Location</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Products</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total MC</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total Weight</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Utilization</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="locationTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Code Breakdown Section -->
        <div id="code-breakdown-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-indigo-600 to-cyan-600 bg-clip-text text-transparent mb-3">🔍 Code Breakdown</h2>
                <p class="text-gray-600 text-xl font-semibold">Brand Analysis & Product Breakdown</p>
            </div>
            
            <!-- Code Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-indigo-600 mb-2" id="totalCodes">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Brands</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tags text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-cyan-600 mb-2" id="uniqueCodeBrands">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Unique Products</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-cube text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="codeTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total MC</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-emerald-600 mb-2" id="codeTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Weight</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Code Search and Filter -->
            <div class="advanced-card p-8 mb-10 animate-slideInUp" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-black text-gray-800">Code Search & Filter</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-indigo-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-semibold text-gray-600">Smart Code Analysis</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Search by Brand</label>
                        <input type="text" id="codeSearch" placeholder="Search brands, products, codes..." 
                               class="form-advanced w-full" onkeyup="CodeBreakdown.searchCodes()">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Filter by Brand</label>
                        <select id="codeFilterBrand" class="form-advanced w-full" onchange="CodeBreakdown.filterCodes()">
                            <option value="">All Brands</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Filter PO</label>
                        <select id="codeFilterPO" class="form-advanced w-full" onchange="CodeBreakdown.filterCodes()">
                            <option value="">All PO Numbers</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-4">
                    <button onclick="CodeBreakdown.resetFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-undo mr-2"></i>Reset Filters
                    </button>
                    <button onclick="CodeBreakdown.exportToPDF()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-file-pdf mr-2"></i>Export PDF
                    </button>
                </div>
            </div>
            
            <!-- Code Breakdown Table -->
            <div class="advanced-table animate-slideInUp" style="animation-delay: 0.5s">
                <div class="table-header px-4 md:px-8 py-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg md:text-xl font-black">Product Code Details</h3>
                        <div class="hidden md:flex items-center space-x-4">
                            <span class="text-sm font-semibold opacity-90">Brand : Product : Packaging : Code</span>
                            <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Table -->
                <div class="desktop-table overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-indigo-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('brand')">
                                    Brand Name <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('po')">
                                    PO Number <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('products')">
                                    Products <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('mc')">
                                    Total MC <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('kg')">
                                    Total Weight <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">
                                    Product Details
                                </th>
                            </tr>
                        </thead>
                        <tbody id="codeTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile Code Breakdown -->
                <div class="mobile-table p-4" id="mobileCodeTable">
                    <!-- Mobile code cards populated by JavaScript -->
                </div>
                
                <!-- Code Pagination -->
                <div class="bg-gradient-to-r from-gray-50 to-indigo-50 px-8 py-6 flex items-center justify-between border-t border-gray-200">
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-700 font-bold">
                            Showing <span id="codeShowingStart" class="font-black text-indigo-600">0</span> - <span id="codeShowingEnd" class="font-black text-indigo-600">0</span> of <span id="codeTotalRecords" class="font-black text-indigo-600">0</span>
                        </div>
                        <select id="codeItemsPerPage" onchange="CodeBreakdown.changeItemsPerPage()" class="form-advanced text-sm py-2 px-3">
                            <option value="10">10 per page</option>
                            <option value="25">25 per page</option>
                            <option value="50">50 per page</option>
                            <option value="100">100 per page</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="CodeBreakdown.firstPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codeFirstBtn">
                            <i class="fas fa-angle-double-left text-indigo-600"></i>
                        </button>
                        <button onclick="CodeBreakdown.previousPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codePrevBtn">
                            <i class="fas fa-angle-left text-indigo-600"></i>
                        </button>
                        <span id="codePageInfo" class="px-6 py-2 bg-gradient-to-r from-indigo-500 to-cyan-600 text-white rounded-lg font-black shadow-lg">1</span>
                        <button onclick="CodeBreakdown.nextPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codeNextBtn">
                            <i class="fas fa-angle-right text-indigo-600"></i>
                        </button>
                        <button onclick="CodeBreakdown.lastPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codeLastBtn">
                            <i class="fas fa-angle-double-right text-indigo-600"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Entry Summary Section -->
        <div id="data-entry-summary-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-3">📅 Data Entry Summary</h2>
                <p class="text-gray-600 text-xl font-semibold">Daily Data Entry Breakdown & Analysis</p>
            </div>
            
            <!-- Date Entry Summary -->
            <div class="advanced-card p-8 mb-10 animate-slideInUp" style="animation-delay: 0.1s">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-black text-gray-800">📅 Data Entry Summary by Date</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-semibold text-gray-600">Daily Breakdown</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Date Summary Chart -->
                    <div class="h-80">
                        <canvas id="dateSummaryChart"></canvas>
                    </div>
                    
                    <!-- Date Summary Table -->
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-6 max-h-80 overflow-y-auto">
                        <h4 class="text-lg font-black text-gray-800 mb-4">Daily Statistics</h4>
                        <div id="dateSummaryList" class="space-y-3">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Monitor Section -->
        <div id="real-time-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text text-transparent mb-3">📡 Real-time Monitor</h2>
                <p class="text-gray-600 text-xl font-semibold">Live System Monitoring & Performance Metrics</p>
            </div>
            
            <!-- Real-time Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="systemStatus">Online</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">System Status</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-heartbeat text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="dataFreshness">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Data Age</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-clock text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="loadTime">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Load Time</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tachometer-alt text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-orange-600 mb-2" id="memoryUsage">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Memory</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-memory text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Performance Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">System Performance</h3>
                    <div class="h-80">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Data Flow Monitor</h3>
                    <div class="h-80">
                        <canvas id="dataFlowChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- System Logs -->
            <div class="advanced-card p-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-black text-gray-800">System Activity Log</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-semibold text-gray-600">Live Updates</span>
                    </div>
                </div>
                <div class="bg-gray-900 rounded-xl p-6 h-64 overflow-y-auto font-mono text-sm" id="systemLogs">
                    <!-- Logs populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="UI.showQuickActions()" title="Quick Actions">
        <i class="fas fa-plus"></i>
    </button>

    <script>
        // ===== ENHANCED CONFIGURATION =====
        const CONFIG = {
    VERSION: '49.0.0',
    JSON_URL: 'https://ppicwg.github.io/CS_WKB/data.json', // ✅ Data lokal
    ITEMS_PER_PAGE: window.innerWidth <= 768 ? 5 : 10,
    MAX_ITEMS_PER_PAGE: 100,
    AUTO_REFRESH_INTERVAL: 300000, // 5 menit
    ANIMATION_DURATION: 300,
            USERS: {
                'admin': { password: 'admin123', role: 'admin', name: 'System Administrator', permissions: ['all'] },
                'manager': { password: 'manager123', role: 'manager', name: 'Warehouse Manager', permissions: ['read', 'export', 'analytics'] },
                'staff': { password: 'staff123', role: 'staff', name: 'Warehouse Staff', permissions: ['read'] }
            },
            FEATURES: {
                REAL_TIME_UPDATES: true,
                ADVANCED_ANALYTICS: true,
                EXPORT_CAPABILITIES: true,
                SMART_SEARCH: true,
                AUTO_BACKUP: true
            }
        };

        // ===== ENHANCED GLOBAL STATE =====
        const State = {
            version: CONFIG.VERSION,
            currentUser: null,
            stockData: [],
            filteredData: [],
            currentPage: 1,
            itemsPerPage: CONFIG.ITEMS_PER_PAGE,
            sortColumn: -1,
            sortDirection: 'asc',
            isLoading: false,
            targetDate: '29/01/2024',
            lastUpdate: null,
            autoRefreshTimer: null,
            searchCache: new Map(),
            charts: {
                brand: null,
                trend: null,
                analytics: {}
            },
            performance: {
                loadTime: 0,
                renderTime: 0,
                dataSize: 0
            },
            filters: {
                startDate: '',
                endDate: '',
                brand: '',
                location: '',
                search: ''
            }
        };

        // ===== ENHANCED AUTHENTICATION MODULE =====
        const Auth = {
            init() {
                console.log(`🚀 Initializing Dashboard v${CONFIG.VERSION}...`);
                const savedUser = localStorage.getItem('dashboardUser_v49');
                if (savedUser) {
                    try {
                        State.currentUser = JSON.parse(savedUser);
                        if (this.validateSession()) {
                            this.showDashboard();
                        } else {
                            this.logout();
                        }
                    } catch (e) {
                        console.warn('Invalid session data:', e);
                        localStorage.removeItem('dashboardUser_v49');
                        this.showLogin();
                    }
                } else {
                    this.showLogin();
                }

                this.bindEvents();
            },

            bindEvents() {
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', this.handleLogin.bind(this));
                }

                // Auto-logout on tab visibility change for security
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && State.currentUser) {
                        console.log('🔒 Tab hidden - pausing auto-refresh');
                        if (State.autoRefreshTimer) {
                            clearInterval(State.autoRefreshTimer);
                        }
                    } else if (!document.hidden && State.currentUser) {
                        console.log('👁️ Tab visible - resuming auto-refresh');
                        this.startAutoRefresh();
                    }
                });
            },

            validateSession() {
                if (!State.currentUser || !State.currentUser.loginTime) return false;
                
                const loginTime = new Date(State.currentUser.loginTime);
                const now = new Date();
                const sessionDuration = now - loginTime;
                const maxSessionDuration = 8 * 60 * 60 * 1000; // 8 hours
                
                return sessionDuration < maxSessionDuration;
            },

            showLogin() {
                const modal = document.getElementById('loginModal');
                if (modal) {
                    modal.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                    
                    // Focus on username field
                    setTimeout(() => {
                        const usernameField = document.getElementById('username');
                        if (usernameField) usernameField.focus();
                    }, 300);
                }
            },

            hideLogin() {
                const modal = document.getElementById('loginModal');
                if (modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            },

            showDashboard() {
                this.hideLogin();
                this.updateUserInfo();
                this.startAutoRefresh();
                DataLoader.init();
                Charts.init();
                Utils.setCurrentTime();
                Performance.startTracking();
            },

            async handleLogin(e) {
                e.preventDefault();
                
                const elements = {
                    username: document.getElementById('username'),
                    password: document.getElementById('password'),
                    error: document.getElementById('loginError'),
                    buttonText: document.getElementById('loginButtonText'),
                    spinner: document.getElementById('loginSpinner')
                };
                
                const username = elements.username.value.trim();
                const password = elements.password.value;
                
                // Show loading state
                elements.buttonText.classList.add('hidden');
                elements.spinner.classList.remove('hidden');
                elements.error.classList.add('hidden');
                
                // Simulate authentication delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                if (CONFIG.USERS[username] && CONFIG.USERS[username].password === password) {
                    State.currentUser = {
                        username: username,
                        name: CONFIG.USERS[username].name,
                        role: CONFIG.USERS[username].role,
                        permissions: CONFIG.USERS[username].permissions,
                        loginTime: new Date().toISOString(),
                        sessionId: Utils.generateSessionId()
                    };
                    
                    localStorage.setItem('dashboardUser_v49', JSON.stringify(State.currentUser));
                    
                    elements.buttonText.innerHTML = '<i class="fas fa-check mr-3"></i>Access Granted!';
                    elements.buttonText.classList.remove('hidden');
                    elements.spinner.classList.add('hidden');
                    
                    setTimeout(() => {
                        this.showDashboard();
                        Utils.showNotification('success', `🎉 Welcome back, ${State.currentUser.name}!`);
                    }, 800);
                    
                } else {
                    elements.buttonText.classList.remove('hidden');
                    elements.spinner.classList.add('hidden');
                    elements.error.classList.remove('hidden');
                    elements.password.value = '';
                    elements.password.focus();
                }
            },

            updateUserInfo() {
                if (!State.currentUser) return;
                
                const elements = {
                    userInfo: document.getElementById('userInfo'),
                    userName: document.getElementById('userName'),
                    userRole: document.getElementById('userRole')
                };
                
                if (elements.userInfo && elements.userName && elements.userRole) {
                    elements.userInfo.classList.remove('hidden');
                    elements.userName.textContent = State.currentUser.name;
                    elements.userRole.textContent = State.currentUser.role.toUpperCase();
                }
            },

            startAutoRefresh() {
                if (State.autoRefreshTimer) {
                    clearInterval(State.autoRefreshTimer);
                }
                
                if (CONFIG.FEATURES.REAL_TIME_UPDATES) {
                    State.autoRefreshTimer = setInterval(() => {
                        if (!document.hidden) {
                            console.log('🔄 Auto-refreshing data...');
                            DataLoader.loadFromGoogleSheets(true);
                        }
                    }, CONFIG.AUTO_REFRESH_INTERVAL);
                }
            },

            logout() {
                if (confirm('Are you sure you want to logout?')) {
                    if (State.autoRefreshTimer) {
                        clearInterval(State.autoRefreshTimer);
                    }
                    
                    localStorage.removeItem('dashboardUser_v49');
                    State.currentUser = null;
                    
                    Utils.showNotification('info', '👋 Logged out successfully');
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                }
            }
        };

        // ===== ENHANCED DATA LOADER MODULE =====
        // ===== ENHANCED DATA LOADER MODULE (USING data.json) =====
const DataLoader = {
    init() {
        console.log('📊 Initializing JSON data loading system...');
        this.loadFromJSON();
    },

    async loadFromJSON(isAutoRefresh = false) {
        const startTime = performance.now();
        console.log('🔄 Loading data from JSON...', isAutoRefresh ? '(Auto-refresh)' : '(Manual)');

        const elements = {
            dataStatus: document.getElementById('dataStatus'),
            loadProgress: document.getElementById('loadProgress'),
            progressBar: document.getElementById('progressBar'),
            progressText: document.getElementById('progressText'),
            refreshBtn: document.getElementById('refreshBtn')
        };

        if (!isAutoRefresh) {
            this.updateLoadingUI(elements, 'loading');
        }

        try {
            if (!isAutoRefresh) {
                this.updateProgress(elements, 20, 'Fetching data.json...');
            }

                    const response = await fetch('https://ppicwg.github.io/CS_WKB/data.json');

            if (!response.ok) {
                throw new Error(`JSON file load error: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();

            if (!data.values || data.values.length === 0) {
                throw new Error('No data found in JSON file');
            }

            let targetDate = null;
            if (data.targetDate) {
                targetDate = data.targetDate;
                console.log('📅 Target date from JSON:', targetDate);
            }

            if (!isAutoRefresh) {
                this.updateProgress(elements, 40, 'Processing data...');
            }

            if (targetDate) {
                State.targetDate = targetDate;
            } else if (data.values.length > 1 && data.values[1][0]) {
                State.targetDate = data.values[1][0]; // First data row, first column
            }

            if (!isAutoRefresh) {
                this.updateProgress(elements, 70, 'Formatting data...');
            }

            const processedData = this.processSheetData(data.values);

            if (processedData.length === 0) {
                throw new Error('No valid data found in JSON');
            }

            const loadTime = performance.now() - startTime;
            State.performance.loadTime = loadTime;
            State.performance.dataSize = JSON.stringify(data.values).length;

            console.log(`✅ Successfully loaded ${processedData.length} records from JSON`);
            this.completeLoading(processedData, elements, isAutoRefresh);

        } catch (error) {
            console.error('❌ Error loading data from JSON:', error);
            if (!isAutoRefresh) {
                this.loadSampleData(elements);
            } else {
                Utils.showNotification('error', '⚠️ Auto-refresh failed - using cached data');
            }
        }
    },

    processSheetData(sheetValues) {
        const processedData = [];
        let validRows = 0;
        let skippedRows = 0;

        for (let i = 1; i < sheetValues.length; i++) {
            const row = sheetValues[i];

            while (row.length < 9) {
                row.push('');
            }

            const hasDate = row[0] && String(row[0]).trim() !== '';
            const hasProduct = row[1] && String(row[1]).trim() !== '';
            const hasMC = row[6] && !isNaN(parseFloat(row[6])) && parseFloat(row[6]) > 0;

            if (hasDate && hasProduct && hasMC) {
                const formattedRow = [
                    Utils.formatDate(row[0]),
                    String(row[1] || '').trim(),
                    String(row[2] || '').trim(),
                    String(row[3] || '').trim(),
                    String(row[4] || '').trim(),
                    String(row[5] || '').trim(),
                    parseFloat(row[6]) || 0,
                    parseFloat(row[7]) || 0,
                    String(row[8] || '').trim()
                ];
                processedData.push(formattedRow);
                validRows++;
            } else {
                skippedRows++;
            }
        }

        console.log(`📊 Sheet processing complete: ${validRows} valid rows, ${skippedRows} skipped`);
        return processedData;
    },

    updateLoadingUI(elements, status) {
        // Kosongkan jika belum ada implementasi
    },

    updateProgress(elements, percent, message) {
        // Kosongkan jika belum ada implementasi
    },

    completeLoading(data, elements, isAutoRefresh) {
        // Kosongkan jika belum ada implementasi
    },

    loadSampleData(elements) {
        // Kosongkan jika belum ada implementasi
    }
        };        


            
                
                
            

        // ===== ENHANCED UI MODULE =====
        const UI = {
            toggleSidebar() {
                const sidebar = document.querySelector('.advanced-sidebar');
                const overlay = document.querySelector('.mobile-overlay');
                
                if (sidebar) sidebar.classList.toggle('open');
                if (overlay) overlay.classList.toggle('hidden');
            },

            closeSidebar() {
                const sidebar = document.querySelector('.advanced-sidebar');
                const overlay = document.querySelector('.mobile-overlay');
                
                if (sidebar) sidebar.classList.remove('open');
                if (overlay) overlay.classList.add('hidden');
            },

            updateAll() {
                if (State.stockData.length === 0) return;
                
                const startTime = performance.now();
                
                this.populateFilters();
                Table.populate();
                this.updateStats();
                Charts.updateAll();
                
                const renderTime = performance.now() - startTime;
                State.performance.renderTime = renderTime;
                
                console.log(`🎨 UI updated in ${renderTime.toFixed(2)}ms`);
            },

            populateFilters() {
                const brands = [...new Set(State.stockData.map(row => row[3]).filter(item => item && item !== '-'))].sort();
                const locations = [...new Set(State.stockData.map(row => row[8]).filter(item => item && item !== '-'))].sort();
                
                const brandFilter = document.getElementById('brandFilter');
                const locationFilter = document.getElementById('locationFilter');
                
                if (brandFilter) {
                    brandFilter.innerHTML = '<option value="">All Brands</option>' + 
                        brands.map(b => `<option value="${b}">${b}</option>`).join('');
                }
                
                if (locationFilter) {
                    locationFilter.innerHTML = '<option value="">All Locations</option>' + 
                        locations.map(l => `<option value="${l}">${l}</option>`).join('');
                }
            },

            updateStats() {
                const totalItems = State.filteredData.reduce((sum, row) => sum + (parseInt(row[6]) || 0), 0);
                const totalKg = State.filteredData.reduce((sum, row) => sum + (parseFloat(row[7]) || 0), 0);
                const uniqueProducts = new Set(State.filteredData.map(row => row[1])).size;
                const uniqueBrands = new Set(State.filteredData.map(row => row[3])).size;
                
                const elements = {
                    totalItems: document.getElementById('totalItems'),
                    totalKg: document.getElementById('totalKg'),
                    uniqueProducts: document.getElementById('uniqueProducts'),
                    uniqueBrands: document.getElementById('uniqueBrands')
                };
                
                // Animate number changes
                if (elements.totalItems) this.animateNumber(elements.totalItems, totalItems);
                if (elements.totalKg) this.animateNumber(elements.totalKg, totalKg, 'kg');
                if (elements.uniqueProducts) this.animateNumber(elements.uniqueProducts, uniqueProducts);
                if (elements.uniqueBrands) this.animateNumber(elements.uniqueBrands, uniqueBrands);
            },

            animateNumber(element, targetValue, suffix = '') {
                const currentValue = parseInt(element.textContent.replace(/[^\d]/g, '')) || 0;
                const increment = (targetValue - currentValue) / 20;
                let current = currentValue;
                
                const timer = setInterval(() => {
                    current += increment;
                    if ((increment > 0 && current >= targetValue) || (increment < 0 && current <= targetValue)) {
                        current = targetValue;
                        clearInterval(timer);
                    }
                    
                    const displayValue = Math.round(current).toLocaleString();
                    element.textContent = suffix ? `${displayValue} ${suffix}` : displayValue;
                }, 50);
            },

            showQuickActions() {
                // Implementation for floating action button
                const actions = [
                    { icon: 'fas fa-file-pdf', text: 'Export PDF', action: () => Export.toPDF() },
                    { icon: 'fas fa-chart-bar', text: 'Analytics', action: () => Navigation.showSection('analytics') },
                    { icon: 'fas fa-calendar-alt', text: 'Data Summary', action: () => Navigation.showSection('data-entry-summary') }
                ];
                
                // Show quick actions menu (implementation would create a popup menu)
                console.log('Quick actions:', actions);
            }
        };

        // ===== ENHANCED TABLE MODULE =====
        const Table = {
            populate() {
                const tbody = document.getElementById('stockTableBody');
                const mobileTable = document.getElementById('mobileStockTable');
                
                const start = (State.currentPage - 1) * State.itemsPerPage;
                const end = Math.min(start + State.itemsPerPage, State.filteredData.length);
                const pageData = State.filteredData.slice(start, end);
                
                // Desktop table
                if (tbody) {
                    tbody.innerHTML = pageData.map((row, index) => `
                        <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                            <td class="px-8 py-6 text-sm font-bold text-gray-900">${row[0]}</td>
                            <td class="px-8 py-6 text-sm font-black text-gray-900">${row[1]}</td>
                            <td class="px-8 py-6 text-sm text-gray-700 font-semibold">${row[2]}</td>
                            <td class="px-8 py-6 text-sm">
                                <span class="badge-advanced badge-primary">${row[3]}</span>
                            </td>
                            <td class="px-8 py-6 text-sm text-gray-900 font-mono font-bold">${row[4]}</td>
                            <td class="px-8 py-6 text-sm text-gray-900 font-mono font-bold">${row[5]}</td>
                            <td class="px-8 py-6 text-sm text-blue-600 text-right font-black text-lg">${row[6].toLocaleString()}</td>
                            <td class="px-8 py-6 text-sm text-green-600 text-right font-black text-lg">${row[7].toLocaleString()} kg</td>
                            <td class="px-8 py-6 text-sm text-gray-900">
                                <span class="badge-advanced badge-success">${row[8] || '-'}</span>
                            </td>
                        </tr>
                    `).join('');
                }
                
                // Mobile table
                if (mobileTable) {
                    mobileTable.innerHTML = pageData.map((row, index) => `
                        <div class="mobile-table-card animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                            <div class="mobile-table-header">${row[1]}</div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Date</span>
                                <span class="mobile-table-value">${row[0]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Brand</span>
                                <span class="mobile-table-value">
                                    <span class="badge-advanced badge-primary text-xs">${row[3]}</span>
                                </span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Packaging</span>
                                <span class="mobile-table-value">${row[2]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Code</span>
                                <span class="mobile-table-value font-mono">${row[4]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">PO Number</span>
                                <span class="mobile-table-value font-mono">${row[5]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">MC Qty</span>
                                <span class="mobile-table-value text-blue-600 font-black">${row[6].toLocaleString()}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Weight</span>
                                <span class="mobile-table-value text-green-600 font-black">${row[7].toLocaleString()} kg</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Location</span>
                                <span class="mobile-table-value">
                                    <span class="badge-advanced badge-success text-xs">${row[8] || '-'}</span>
                                </span>
                            </div>
                        </div>
                    `).join('');
                }
                
                this.updatePagination();
            },

            updatePagination() {
                const total = State.filteredData.length;
                const start = (State.currentPage - 1) * State.itemsPerPage + 1;
                const end = Math.min(State.currentPage * State.itemsPerPage, total);
                const maxPages = Math.ceil(total / State.itemsPerPage);
                
                // Desktop pagination elements
                const elements = {
                    showingStart: document.getElementById('showingStart'),
                    showingEnd: document.getElementById('showingEnd'),
                    totalRecords: document.getElementById('totalRecords'),
                    pageInfo: document.getElementById('pageInfo'),
                    firstBtn: document.getElementById('firstBtn'),
                    prevBtn: document.getElementById('prevBtn'),
                    nextBtn: document.getElementById('nextBtn'),
                    lastBtn: document.getElementById('lastBtn')
                };
                
                // Mobile pagination elements
                const mobileElements = {
                    showingStart: document.getElementById('showingStartMobile'),
                    showingEnd: document.getElementById('showingEndMobile'),
                    totalRecords: document.getElementById('totalRecordsMobile'),
                    pageInfo: document.getElementById('pageInfoMobile'),
                    firstBtn: document.getElementById('firstBtnMobile'),
                    prevBtn: document.getElementById('prevBtnMobile'),
                    nextBtn: document.getElementById('nextBtnMobile'),
                    lastBtn: document.getElementById('lastBtnMobile')
                };
                
                // Update both desktop and mobile pagination
                [elements, mobileElements].forEach(elemSet => {
                    if (elemSet.showingStart) elemSet.showingStart.textContent = total > 0 ? start : 0;
                    if (elemSet.showingEnd) elemSet.showingEnd.textContent = end;
                    if (elemSet.totalRecords) elemSet.totalRecords.textContent = total.toLocaleString();
                    if (elemSet.pageInfo) elemSet.pageInfo.textContent = `${State.currentPage} / ${maxPages}`;
                    
                    if (elemSet.firstBtn) elemSet.firstBtn.disabled = State.currentPage <= 1;
                    if (elemSet.prevBtn) elemSet.prevBtn.disabled = State.currentPage <= 1;
                    if (elemSet.nextBtn) elemSet.nextBtn.disabled = State.currentPage >= maxPages;
                    if (elemSet.lastBtn) elemSet.lastBtn.disabled = State.currentPage >= maxPages;
                });
            },

            sort(columnIndex) {
                if (State.sortColumn === columnIndex) {
                    State.sortDirection = State.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    State.sortColumn = columnIndex;
                    State.sortDirection = 'asc';
                }
                
                State.filteredData.sort((a, b) => {
                    let aVal = a[columnIndex];
                    let bVal = b[columnIndex];
                    
                    // Handle numeric columns
                    if (columnIndex === 6 || columnIndex === 7) {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    }
                    
                    // Handle date columns
                    if (columnIndex === 0) {
                        aVal = Utils.parseDate(aVal);
                        bVal = Utils.parseDate(bVal);
                    }
                    
                    if (aVal < bVal) return State.sortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return State.sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
                
                State.currentPage = 1;
                this.populate();
            },

            changeItemsPerPage() {
                const select = document.getElementById('itemsPerPage');
                const mobileSelect = document.getElementById('itemsPerPageMobile');
                
                if (select) {
                    State.itemsPerPage = parseInt(select.value);
                    State.currentPage = 1;
                    this.populate();
                }
                
                if (mobileSelect) {
                    State.itemsPerPage = parseInt(mobileSelect.value);
                    State.currentPage = 1;
                    this.populate();
                }
            },

            firstPage() {
                State.currentPage = 1;
                this.populate();
            },

            previousPage() {
                if (State.currentPage > 1) {
                    State.currentPage--;
                    this.populate();
                }
            },

            nextPage() {
                const maxPages = Math.ceil(State.filteredData.length / State.itemsPerPage);
                if (State.currentPage < maxPages) {
                    State.currentPage++;
                    this.populate();
                }
            },

            lastPage() {
                const maxPages = Math.ceil(State.filteredData.length / State.itemsPerPage);
                State.currentPage = maxPages;
                this.populate();
            }
        };

        // ===== ENHANCED SMART SEARCH MODULE =====
        const SmartSearch = {
            searchCache: new Map(),
            
            performSearch() {
                const searchTerm = document.getElementById('searchProduct')?.value?.toLowerCase() || '';
                const searchResults = document.getElementById('searchResults');
                
                if (searchTerm.length < 2) {
                    if (searchResults) {
                        searchResults.classList.remove('show');
                        searchResults.innerHTML = '';
                    }
                    return;
                }
                
                // Check cache first
                if (this.searchCache.has(searchTerm)) {
                    this.displaySearchResults(this.searchCache.get(searchTerm), searchResults);
                    return;
                }
                
                // Perform search
                const results = State.stockData.filter(row => {
                    return row[1].toLowerCase().includes(searchTerm) || // Product
                           row[3].toLowerCase().includes(searchTerm) || // Brand
                           row[2].toLowerCase().includes(searchTerm) || // Packaging
                           row[4].toLowerCase().includes(searchTerm) || // Code
                           row[5].toLowerCase().includes(searchTerm);   // PO Number
                }).slice(0, 8); // Limit to 8 results
                
                // Cache results
                this.searchCache.set(searchTerm, results);
                
                this.displaySearchResults(results, searchResults);
            },
            
            displaySearchResults(results, container) {
                if (!container) return;
                
                if (results.length === 0) {
                    container.innerHTML = '<div class="search-item text-gray-500">No results found</div>';
                    container.classList.add('show');
                    return;
                }
                
                container.innerHTML = results.map(row => `
                    <div class="search-item" onclick="SmartSearch.selectResult('${row[1]}', '${row[3]}', '${row[5]}')">
                        <div class="font-bold text-gray-800">${row[1]}</div>
                        <div class="text-sm text-gray-600">
                            <span class="badge-advanced badge-primary text-xs mr-2">${row[3]}</span>
                            <span class="badge-advanced badge-success text-xs mr-2">PO: ${row[5]}</span>
                            <span class="text-blue-600 font-bold">${row[6]} MC</span> | 
                            <span class="text-green-600 font-bold">${row[7]} kg</span>
                        </div>
                    </div>
                `).join('');
                
                container.classList.add('show');
            },
            
            selectResult(product, brand, po) {
                const searchInput = document.getElementById('searchProduct');
                const brandFilter = document.getElementById('brandFilter');
                const searchResults = document.getElementById('searchResults');
                
                if (searchInput) searchInput.value = product;
                if (brandFilter) brandFilter.value = brand;
                if (searchResults) searchResults.classList.remove('show');
                
                // Apply the filter
                Filters.apply();
            },
            
            applySorting() {
                const sortBy = document.getElementById('sortBy')?.value;
                if (!sortBy) return;
                
                const [column, direction] = sortBy.split('-');
                
                State.filteredData.sort((a, b) => {
                    let aVal, bVal;
                    
                    switch (column) {
                        case 'date':
                            aVal = Utils.parseDate(a[0]);
                            bVal = Utils.parseDate(b[0]);
                            break;
                        case 'product':
                            aVal = a[1].toLowerCase();
                            bVal = b[1].toLowerCase();
                            break;
                        case 'brand':
                            aVal = a[3].toLowerCase();
                            bVal = b[3].toLowerCase();
                            break;
                        case 'mc':
                            aVal = parseInt(a[6]) || 0;
                            bVal = parseInt(b[6]) || 0;
                            break;
                        case 'kg':
                            aVal = parseFloat(a[7]) || 0;
                            bVal = parseFloat(b[7]) || 0;
                            break;
                        case 'po':
                            aVal = a[5].toLowerCase();
                            bVal = b[5].toLowerCase();
                            break;
                        default:
                            aVal = a[0];
                            bVal = b[0];
                    }
                    
                    if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                    return 0;
                });
                
                State.currentPage = 1;
                Table.populate();
                
                Utils.showNotification('success', `📊 Data sorted by ${column} (${direction === 'asc' ? 'ascending' : 'descending'})`);
            },
            

        };

        // ===== ENHANCED FILTERS MODULE =====
        const Filters = {
            apply() {
                const startDate = document.getElementById('startDate')?.value;
                const endDate = document.getElementById('endDate')?.value;
                const brand = document.getElementById('brandFilter')?.value;
                const location = document.getElementById('locationFilter')?.value;
                const searchTerm = document.getElementById('searchProduct')?.value?.toLowerCase() || '';
                
                // Update state
                State.filters = { startDate, endDate, brand, location, search: searchTerm };
                
                State.filteredData = State.stockData.filter(row => {
                    const matchesBrand = !brand || row[3] === brand;
                    const matchesLocation = !location || row[8] === location;
                    const matchesSearch = !searchTerm || 
                        row[1].toLowerCase().includes(searchTerm) ||
                        row[3].toLowerCase().includes(searchTerm) ||
                        row[2].toLowerCase().includes(searchTerm) ||
                        row[4].toLowerCase().includes(searchTerm) ||
                        row[5].toLowerCase().includes(searchTerm); // Added PO search
                    
                    let matchesDateRange = true;
                    if (startDate || endDate) {
                        const rowDate = Utils.parseDate(row[0]);
                        if (startDate) {
                            const start = new Date(startDate);
                            matchesDateRange = matchesDateRange && rowDate >= start;
                        }
                        if (endDate) {
                            const end = new Date(endDate);
                            matchesDateRange = matchesDateRange && rowDate <= end;
                        }
                    }
                    
                    return matchesBrand && matchesLocation && matchesSearch && matchesDateRange;
                });
                
                State.currentPage = 1;
                
                // Apply current sorting
                const sortBy = document.getElementById('sortBy')?.value;
                if (sortBy) {
                    SmartSearch.applySorting();
                } else {
                    UI.updateAll();
                }
                
                Utils.showNotification('success', `🔍 Filter applied: ${State.filteredData.length} records found`);
            },

            reset() {
                const elements = {
                    startDate: document.getElementById('startDate'),
                    endDate: document.getElementById('endDate'),
                    brandFilter: document.getElementById('brandFilter'),
                    locationFilter: document.getElementById('locationFilter'),
                    searchProduct: document.getElementById('searchProduct'),
                    sortBy: document.getElementById('sortBy')
                };
                
                Object.values(elements).forEach(el => {
                    if (el) {
                        if (el.tagName === 'SELECT') {
                            el.selectedIndex = 0;
                        } else {
                            el.value = '';
                        }
                    }
                });
                
                // Clear search results
                const searchResults = document.getElementById('searchResults');
                if (searchResults) {
                    searchResults.classList.remove('show');
                    searchResults.innerHTML = '';
                }
                
                State.filters = { startDate: '', endDate: '', brand: '', location: '', search: '' };
                State.filteredData = [...State.stockData];
                State.currentPage = 1;
                UI.updateAll();
                
                Utils.showNotification('info', '🔄 Filters reset - showing all data');
            }
        };

        // ===== ENHANCED NAVIGATION MODULE =====
        const Navigation = {
            showSection(sectionName) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show target section
                const targetSection = document.getElementById(sectionName + '-section');
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    targetSection.classList.add('animate-fadeIn');
                }
                
                // Update sidebar active state
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (event && event.target) {
                    const sidebarItem = event.target.closest('.sidebar-item');
                    if (sidebarItem) {
                        sidebarItem.classList.add('active');
                    }
                }
                
                // Close mobile sidebar
                if (window.innerWidth <= 768) {
                    UI.closeSidebar();
                }
                
                // Update section-specific content
                setTimeout(() => {
                    switch (sectionName) {
                        case 'analytics':
                            Charts.updateAll();
                            break;
                        case 'rekap-po':
                            Recap.updatePOSection();
                            break;
                        case 'rekap-brand':
                            Recap.updateBrandSection();
                            break;
                        case 'rekap-lokasi':
                            Recap.updateLocationSection();
                            break;
                        case 'code-breakdown':
                            CodeBreakdown.updateSection();
                            break;
                        case 'data-entry-summary':
                            Charts.updateDateSummaryChart();
                            break;
                        case 'real-time':
                            Recap.updateRealTimeSection();
                            break;
                    }
                }, 300);
            }
        };

        // ===== RECAP MODULES =====
        const Recap = {
            updatePOSection() {
                if (!State.stockData.length) return;
                
                // Calculate PO statistics
                const poData = {};
                State.stockData.forEach(row => {
                    const po = row[5];
                    const date = row[0];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (po && po !== '-') {
                        if (!poData[po]) {
                            poData[po] = { date, items: 0, mc: 0, kg: 0 };
                        }
                        poData[po].items++;
                        poData[po].mc += mc;
                        poData[po].kg += kg;
                    }
                });
                
                const totalPOs = Object.keys(poData).length;
                const activePOs = totalPOs; // All POs are considered active
                const totalMC = Object.values(poData).reduce((sum, po) => sum + po.mc, 0);
                const totalKg = Object.values(poData).reduce((sum, po) => sum + po.kg, 0);
                
                // Update stats
                UI.animateNumber(document.getElementById('totalPOs'), totalPOs);
                UI.animateNumber(document.getElementById('activePOs'), activePOs);
                UI.animateNumber(document.getElementById('poTotalMC'), totalMC);
                UI.animateNumber(document.getElementById('poTotalKg'), totalKg, 'kg');
                
                // Update PO table
                const tbody = document.getElementById('poTableBody');
                if (tbody) {
                    tbody.innerHTML = Object.entries(poData)
                        .sort(([,a], [,b]) => b.kg - a.kg)
                        .slice(0, 20)
                        .map(([po, data], index) => `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-mono font-bold text-blue-600">${po}</td>
                                <td class="px-8 py-6 text-sm font-bold text-gray-900">${data.date}</td>
                                <td class="px-8 py-6 text-sm text-gray-700 text-right font-semibold">${data.items}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black">${data.mc.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-green-600 text-right font-black">${data.kg.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm">
                                    <span class="badge-advanced badge-success">Active</span>
                                </td>
                            </tr>
                        `).join('');
                }
            },

            updateBrandSection() {
                if (!State.stockData.length) return;
                
                // Calculate brand statistics
                const brandData = {};
                State.stockData.forEach(row => {
                    const brand = row[3];
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (brand && brand !== '-') {
                        if (!brandData[brand]) {
                            brandData[brand] = { products: new Set(), mc: 0, kg: 0 };
                        }
                        brandData[brand].products.add(product);
                        brandData[brand].mc += mc;
                        brandData[brand].kg += kg;
                    }
                });
                
                const totalBrands = Object.keys(brandData).length;
                const sortedBrands = Object.entries(brandData).sort(([,a], [,b]) => b.kg - a.kg);
                const topBrand = sortedBrands.length > 0 ? sortedBrands[0][0] : '-';
                const avgMC = totalBrands > 0 ? Math.round(Object.values(brandData).reduce((sum, b) => sum + b.mc, 0) / totalBrands) : 0;
                const avgKg = totalBrands > 0 ? Math.round(Object.values(brandData).reduce((sum, b) => sum + b.kg, 0) / totalBrands) : 0;
                
                // Update stats
                UI.animateNumber(document.getElementById('totalBrands'), totalBrands);
                document.getElementById('topBrand').textContent = topBrand;
                UI.animateNumber(document.getElementById('brandTotalMC'), avgMC);
                UI.animateNumber(document.getElementById('brandTotalKg'), avgKg, 'kg');
                
                // Update top brands list
                const topBrandsList = document.getElementById('topBrandsList');
                if (topBrandsList) {
                    const totalWeight = Object.values(brandData).reduce((sum, b) => sum + b.kg, 0);
                    topBrandsList.innerHTML = sortedBrands.slice(0, 8).map(([brand, data], index) => {
                        const percentage = ((data.kg / totalWeight) * 100).toFixed(1);
                        return `
                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl animate-slideInRight" style="animation-delay: ${index * 0.1}s">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mr-4 text-white font-bold">
                                        ${index + 1}
                                    </div>
                                    <div>
                                        <div class="font-bold text-gray-800">${brand}</div>
                                        <div class="text-sm text-gray-600">${data.products.size} products</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-black text-purple-600">${data.kg.toLocaleString()} kg</div>
                                    <div class="text-sm text-gray-500">${percentage}%</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // Update brand table
                const tbody = document.getElementById('brandTableBody');
                if (tbody) {
                    const totalWeight = Object.values(brandData).reduce((sum, b) => sum + b.kg, 0);
                    tbody.innerHTML = sortedBrands.map(([brand, data], index) => {
                        const marketShare = ((data.kg / totalWeight) * 100).toFixed(1);
                        const performance = data.kg > avgKg ? 'High' : data.kg > avgKg * 0.5 ? 'Medium' : 'Low';
                        const performanceClass = performance === 'High' ? 'badge-success' : performance === 'Medium' ? 'badge-warning' : 'badge-danger';
                        
                        return `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-black text-gray-900">${brand}</td>
                                <td class="px-8 py-6 text-sm text-gray-700 text-right font-semibold">${data.products.size}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black">${data.mc.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-green-600 text-right font-black">${data.kg.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm text-purple-600 text-right font-black">${marketShare}%</td>
                                <td class="px-8 py-6 text-sm">
                                    <span class="badge-advanced ${performanceClass}">${performance}</span>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Update brand distribution chart
                this.updateBrandChart(brandData);
            },

            updateLocationSection() {
                if (!State.stockData.length) return;
                
                // Calculate location statistics
                const locationData = {};
                State.stockData.forEach(row => {
                    const location = row[8];
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (location && location !== '-') {
                        if (!locationData[location]) {
                            locationData[location] = { products: new Set(), mc: 0, kg: 0 };
                        }
                        locationData[location].products.add(product);
                        locationData[location].mc += mc;
                        locationData[location].kg += kg;
                    }
                });
                
                const totalLocations = Object.keys(locationData).length;
                const sortedLocations = Object.entries(locationData).sort(([,a], [,b]) => b.kg - a.kg);
                const busyLocation = sortedLocations.length > 0 ? sortedLocations[0][0] : '-';
                const avgMC = totalLocations > 0 ? Math.round(Object.values(locationData).reduce((sum, l) => sum + l.mc, 0) / totalLocations) : 0;
                const avgKg = totalLocations > 0 ? Math.round(Object.values(locationData).reduce((sum, l) => sum + l.kg, 0) / totalLocations) : 0;
                
                // Update stats
                UI.animateNumber(document.getElementById('totalLocations'), totalLocations);
                document.getElementById('busyLocation').textContent = busyLocation;
                UI.animateNumber(document.getElementById('locationTotalMC'), avgMC);
                UI.animateNumber(document.getElementById('locationTotalKg'), avgKg, 'kg');
                
                // Update warehouse capacity
                const warehouseCapacity = document.getElementById('warehouseCapacity');
                if (warehouseCapacity) {
                    const maxCapacity = 10000; // Assumed max capacity per warehouse
                    warehouseCapacity.innerHTML = sortedLocations.slice(0, 6).map(([location, data], index) => {
                        const utilization = Math.min((data.kg / maxCapacity) * 100, 100);
                        const utilizationClass = utilization > 80 ? 'bg-red-500' : utilization > 60 ? 'bg-yellow-500' : 'bg-green-500';
                        
                        return `
                            <div class="animate-slideInRight" style="animation-delay: ${index * 0.1}s">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-bold text-gray-800">${location}</span>
                                    <span class="text-sm font-semibold text-gray-600">${utilization.toFixed(1)}%</span>
                                </div>
                                <div class="progress-advanced mb-2">
                                    <div class="progress-bar-advanced ${utilizationClass}" style="width: ${utilization}%"></div>
                                </div>
                                <div class="text-xs text-gray-500 font-medium">${data.kg.toLocaleString()} kg / ${maxCapacity.toLocaleString()} kg</div>
                            </div>
                        `;
                    }).join('');
                }
                
                // Update location table
                const tbody = document.getElementById('locationTableBody');
                if (tbody) {
                    const maxCapacity = 10000;
                    tbody.innerHTML = sortedLocations.map(([location, data], index) => {
                        const utilization = Math.min((data.kg / maxCapacity) * 100, 100);
                        const status = utilization > 80 ? 'High' : utilization > 60 ? 'Medium' : 'Normal';
                        const statusClass = status === 'High' ? 'badge-danger' : status === 'Medium' ? 'badge-warning' : 'badge-success';
                        
                        return `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-black text-gray-900">${location}</td>
                                <td class="px-8 py-6 text-sm text-gray-700 text-right font-semibold">${data.products.size}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black">${data.mc.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-green-600 text-right font-black">${data.kg.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm text-purple-600 text-right font-black">${utilization.toFixed(1)}%</td>
                                <td class="px-8 py-6 text-sm">
                                    <span class="badge-advanced ${statusClass}">${status}</span>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Update location chart
                this.updateLocationChart(locationData);
            },

            updateRealTimeSection() {
                // Update real-time metrics
                const dataAge = State.lastUpdate ? Math.floor((new Date() - State.lastUpdate) / 1000) : 0;
                const loadTime = State.performance.loadTime ? `${State.performance.loadTime.toFixed(0)}ms` : '-';
                const memoryUsage = 'memory' in performance ? `${(performance.memory.usedJSHeapSize / 1048576).toFixed(1)}MB` : '-';
                
                document.getElementById('dataFreshness').textContent = dataAge < 60 ? `${dataAge}s` : `${Math.floor(dataAge / 60)}m`;
                document.getElementById('loadTime').textContent = loadTime;
                document.getElementById('memoryUsage').textContent = memoryUsage;
                
                // Update system logs
                this.updateSystemLogs();
                
                // Update performance charts
                this.updatePerformanceCharts();
            },

            updateBrandChart(brandData) {
                const ctx = document.getElementById('brandDistributionChart');
                if (!ctx || !brandData) return;
                
                if (State.charts.brandDistribution) {
                    State.charts.brandDistribution.destroy();
                }
                
                const sortedBrands = Object.entries(brandData).sort(([,a], [,b]) => b.kg - a.kg).slice(0, 8);
                const brands = sortedBrands.map(([brand]) => brand);
                const values = sortedBrands.map(([,data]) => data.kg);
                
                State.charts.brandDistribution = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: brands,
                        datasets: [{
                            data: values,
                            backgroundColor: [
                                '#8B5CF6', '#EC4899', '#F59E0B', '#10B981',
                                '#3B82F6', '#EF4444', '#06B6D4', '#84CC16'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            },

            updateLocationChart(locationData) {
                const ctx = document.getElementById('locationChart');
                if (!ctx || !locationData) return;
                
                if (State.charts.locationChart) {
                    State.charts.locationChart.destroy();
                }
                
                const sortedLocations = Object.entries(locationData).sort(([,a], [,b]) => b.kg - a.kg);
                const locations = sortedLocations.map(([location]) => location);
                const values = sortedLocations.map(([,data]) => data.kg);
                
                State.charts.locationChart = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: locations,
                        datasets: [{
                            label: 'Weight (kg)',
                            data: values,
                            backgroundColor: '#10B981',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            },

            updateSystemLogs() {
                const logsContainer = document.getElementById('systemLogs');
                if (!logsContainer) return;
                
                const logs = [
                    `[${new Date().toLocaleTimeString()}] INFO: Dashboard v49 running normally`,
                    `[${new Date().toLocaleTimeString()}] DATA: ${State.stockData.length} records loaded`,
                    `[${new Date().toLocaleTimeString()}] PERF: Load time ${State.performance.loadTime?.toFixed(0) || 0}ms`,
                    `[${new Date().toLocaleTimeString()}] USER: ${State.currentUser?.name || 'Unknown'} active`,
                    `[${new Date().toLocaleTimeString()}] CONN: CDN connection stable`,
                    `[${new Date().toLocaleTimeString()}] CACHE: Data cached successfully`,
                    `[${new Date().toLocaleTimeString()}] UI: All components rendered`,
                    `[${new Date().toLocaleTimeString()}] AUTH: Session valid`
                ];
                
                logsContainer.innerHTML = logs.map(log => `
                    <div class="text-green-400 mb-1 animate-fadeIn">${log}</div>
                `).join('');
                
                logsContainer.scrollTop = logsContainer.scrollHeight;
            },

            updatePerformanceCharts() {
                // Performance chart implementation would go here
                // This is a placeholder for the actual chart updates
                console.log('📊 Performance charts updated');
            }
        };

        // ===== ENHANCED CHARTS MODULE =====
        const Charts = {
            init() {
                this.initBrandChart();
                this.initTrendChart();
                this.initDateSummaryChart();
            },

            initBrandChart() {
                const ctx = document.getElementById('brandChart');
                if (!ctx) return;
                
                State.charts.brand = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6',
                                '#06B6D4', '#84CC16', '#F97316', '#EC4899', '#6366F1'
                            ],
                            borderWidth: 0,
                            hoverBorderWidth: 3,
                            hoverBorderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: { weight: 'bold' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value.toLocaleString()} kg (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            duration: 1000
                        }
                    }
                });
            },

            initTrendChart() {
                const ctx = document.getElementById('trendChart');
                if (!ctx) return;
                
                State.charts.trend = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Total Stock (kg)',
                            data: [],
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + ' kg';
                                    },
                                    font: { weight: 'bold' }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    font: { weight: 'bold' }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    font: { weight: 'bold' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} kg`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            },

            initDateSummaryChart() {
                const ctx = document.getElementById('dateSummaryChart');
                if (!ctx) return;
                
                State.charts.dateSummary = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Total MC',
                            data: [],
                            backgroundColor: '#3B82F6',
                            borderRadius: 8,
                            yAxisID: 'y'
                        }, {
                            label: 'Total Weight (kg)',
                            data: [],
                            backgroundColor: '#10B981',
                            borderRadius: 8,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Total MC',
                                    font: { weight: 'bold' }
                                },
                                ticks: {
                                    font: { weight: 'bold' }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Total Weight (kg)',
                                    font: { weight: 'bold' }
                                },
                                ticks: {
                                    font: { weight: 'bold' }
                                },
                                grid: {
                                    drawOnChartArea: false,
                                }
                            },
                            x: {
                                ticks: {
                                    font: { weight: 'bold' }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    font: { weight: 'bold' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.dataset.label;
                                        const value = context.parsed.y;
                                        return `${label}: ${value.toLocaleString()}${label.includes('Weight') ? ' kg' : ''}`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            },

            updateAll() {
                this.updateBrandChart();
                this.updateTrendChart();
                this.updateDateSummaryChart();
            },

            updateBrandChart() {
                if (!State.charts.brand || !State.filteredData.length) return;
                
                const brandData = {};
                State.filteredData.forEach(row => {
                    const brand = row[3];
                    const kg = parseFloat(row[7]) || 0;
                    brandData[brand] = (brandData[brand] || 0) + kg;
                });
                
                const sortedBrands = Object.entries(brandData)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 8);
                
                const brands = sortedBrands.map(([brand]) => brand);
                const values = sortedBrands.map(([,value]) => value);
                
                State.charts.brand.data.labels = brands;
                State.charts.brand.data.datasets[0].data = values;
                State.charts.brand.update('active');
            },

            updateTrendChart() {
                if (!State.charts.trend || !State.filteredData.length) return;
                
                const dailyData = {};
                State.filteredData.forEach(row => {
                    const date = row[0];
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (date && date !== '-') {
                        if (!dailyData[date]) dailyData[date] = 0;
                        dailyData[date] += kg;
                    }
                });
                
                const sortedDates = Object.keys(dailyData).sort((a, b) => {
                    return Utils.parseDate(a) - Utils.parseDate(b);
                });
                
                const last10Days = sortedDates.slice(-10);
                const labels = last10Days.length > 0 ? last10Days : ['Today'];
                const data = last10Days.length > 0 ? last10Days.map(date => dailyData[date]) : [0];
                
                State.charts.trend.data.labels = labels;
                State.charts.trend.data.datasets[0].data = data;
                State.charts.trend.update('active');
            },

            updateDateSummaryChart() {
                if (!State.charts.dateSummary || !State.filteredData.length) return;
                
                const dailyData = {};
                State.filteredData.forEach(row => {
                    const date = row[0];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (date && date !== '-') {
                        if (!dailyData[date]) {
                            dailyData[date] = { mc: 0, kg: 0, entries: 0 };
                        }
                        dailyData[date].mc += mc;
                        dailyData[date].kg += kg;
                        dailyData[date].entries += 1;
                    }
                });
                
                const sortedDates = Object.keys(dailyData).sort((a, b) => {
                    return Utils.parseDate(a) - Utils.parseDate(b);
                });
                
                const labels = sortedDates;
                const mcData = sortedDates.map(date => dailyData[date].mc);
                const kgData = sortedDates.map(date => dailyData[date].kg);
                
                State.charts.dateSummary.data.labels = labels;
                State.charts.dateSummary.data.datasets[0].data = mcData;
                State.charts.dateSummary.data.datasets[1].data = kgData;
                State.charts.dateSummary.update('active');
                
                // Update date summary list
                this.updateDateSummaryList(dailyData, sortedDates);
            },

            updateDateSummaryList(dailyData, sortedDates) {
                const listContainer = document.getElementById('dateSummaryList');
                if (!listContainer) return;
                
                listContainer.innerHTML = sortedDates.map((date, index) => {
                    const data = dailyData[date];
                    return `
                        <div class="flex items-center justify-between p-4 bg-white rounded-xl shadow-sm animate-slideInRight" style="animation-delay: ${index * 0.05}s">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-green-500 rounded-xl flex items-center justify-center mr-4 text-white font-bold text-sm">
                                    ${date.split('/')[0]}
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">${date}</div>
                                    <div class="text-sm text-gray-600">${data.entries} entries</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-black text-blue-600">${data.mc.toLocaleString()} MC</div>
                                <div class="font-bold text-green-600">${data.kg.toLocaleString()} kg</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        };

        // ===== CODE BREAKDOWN MODULE =====
        const CodeBreakdown = {
            filteredCodes: [],
            currentPage: 1,
            itemsPerPage: 10,
            sortColumn: 'code',
            sortDirection: 'asc',

            updateSection() {
                if (!State.stockData.length) return;
                
                this.processCodeData();
                this.updateStats();
                this.populateFilters();
                this.populateTable();
            },

            processCodeData() {
                // Group data by Brand first
                const brandGroups = {};
                
                State.stockData.forEach(row => {
                    const code = row[4]; // Product code
                    const brand = row[3]; // Brand
                    const product = row[1]; // Product name
                    const packaging = row[2]; // Packaging
                    const po = row[5]; // PO Number
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    const date = row[0]; // Date
                    
                    if (brand && brand !== '-' && code && code !== '-') {
                        if (!brandGroups[brand]) {
                            brandGroups[brand] = {
                                brand: brand,
                                po: po,
                                products: {},
                                totalMC: 0,
                                totalKG: 0,
                                productCount: 0
                            };
                        }
                        
                        // Group products within each Brand
                        if (!brandGroups[brand].products[code]) {
                            brandGroups[brand].products[code] = {
                                code: code,
                                brand: brand,
                                product: product,
                                packaging: packaging,
                                po: po,
                                mc: 0,
                                kg: 0,
                                breakdown: `${brand} : ${product} : ${packaging} : ${code}`
                            };
                            brandGroups[brand].productCount++;
                        }
                        
                        brandGroups[brand].products[code].mc += mc;
                        brandGroups[brand].products[code].kg += kg;
                        brandGroups[brand].totalMC += mc;
                        brandGroups[brand].totalKG += kg;
                    }
                });
                
                // Convert to array format for display
                this.filteredCodes = Object.values(brandGroups);
                this.sortCodes();
            },

            updateStats() {
                const totalBrands = this.filteredCodes.length;
                const totalProducts = this.filteredCodes.reduce((sum, brand) => sum + brand.productCount, 0);
                const totalMC = this.filteredCodes.reduce((sum, brand) => sum + brand.totalMC, 0);
                const totalKg = this.filteredCodes.reduce((sum, brand) => sum + brand.totalKG, 0);
                
                // Get unique products from all brands
                const uniqueProducts = new Set();
                this.filteredCodes.forEach(brand => {
                    Object.values(brand.products).forEach(product => {
                        uniqueProducts.add(product.product);
                    });
                });
                
                UI.animateNumber(document.getElementById('totalCodes'), totalBrands);
                UI.animateNumber(document.getElementById('uniqueCodeBrands'), uniqueProducts.size);
                UI.animateNumber(document.getElementById('codeTotalMC'), totalMC);
                UI.animateNumber(document.getElementById('codeTotalKg'), totalKg, 'kg');
            },

            populateFilters() {
                // Get brands from original stock data
                const brands = [...new Set(State.stockData.map(row => row[3]).filter(b => b && b !== '-'))].sort();
                
                // Get PO numbers from original stock data
                const pos = [...new Set(State.stockData.map(row => row[5]).filter(p => p && p !== '-'))].sort();
                
                const brandFilter = document.getElementById('codeFilterBrand');
                const poFilter = document.getElementById('codeFilterPO');
                
                if (brandFilter) {
                    brandFilter.innerHTML = '<option value="">All Brands</option>' + 
                        brands.map(b => `<option value="${b}">${b}</option>`).join('');
                }
                
                if (poFilter) {
                    poFilter.innerHTML = '<option value="">All PO Numbers</option>' + 
                        pos.map(p => `<option value="${p}">${p}</option>`).join('');
                }
                
                console.log(`🔍 Code filters populated: ${brands.length} brands, ${pos.length} PO numbers`);
            },

            searchCodes() {
                const searchTerm = document.getElementById('codeSearch')?.value?.toLowerCase() || '';
                const brandFilter = document.getElementById('codeFilterBrand')?.value || '';
                const poFilter = document.getElementById('codeFilterPO')?.value || '';
                
                console.log(`🔍 Filtering Brands: search="${searchTerm}", brand="${brandFilter}", po="${poFilter}"`);
                
                // Start with fresh data from stock
                let filteredStock = State.stockData;
                
                // Apply brand filter first
                if (brandFilter) {
                    filteredStock = filteredStock.filter(row => row[3] === brandFilter);
                }
                
                // Apply PO filter
                if (poFilter) {
                    filteredStock = filteredStock.filter(row => row[5] === poFilter);
                }
                
                // Group data by Brand
                const brandGroups = {};
                
                filteredStock.forEach(row => {
                    const code = row[4]; // Product code
                    const brand = row[3]; // Brand
                    const product = row[1]; // Product name
                    const packaging = row[2]; // Packaging
                    const po = row[5]; // PO Number
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    const date = row[0]; // Date
                    
                    if (brand && brand !== '-' && code && code !== '-') {
                        if (!brandGroups[brand]) {
                            brandGroups[brand] = {
                                brand: brand,
                                po: po,
                                products: {},
                                totalMC: 0,
                                totalKG: 0,
                                productCount: 0
                            };
                        }
                        
                        // Group products within each Brand
                        if (!brandGroups[brand].products[code]) {
                            brandGroups[brand].products[code] = {
                                code: code,
                                brand: brand,
                                product: product,
                                packaging: packaging,
                                po: po,
                                mc: 0,
                                kg: 0,
                                breakdown: `${brand} : ${product} : ${packaging} : ${code}`
                            };
                            brandGroups[brand].productCount++;
                        }
                        
                        brandGroups[brand].products[code].mc += mc;
                        brandGroups[brand].products[code].kg += kg;
                        brandGroups[brand].totalMC += mc;
                        brandGroups[brand].totalKG += kg;
                    }
                });
                
                // Convert to array
                this.filteredCodes = Object.values(brandGroups);
                
                // Apply search term filter
                if (searchTerm) {
                    this.filteredCodes = this.filteredCodes.filter(brandGroup => {
                        // Search in brand name
                        if (brandGroup.brand.toLowerCase().includes(searchTerm)) return true;
                        
                        // Search in any product within the brand
                        return Object.values(brandGroup.products).some(product => {
                            return product.code.toLowerCase().includes(searchTerm) ||
                                   product.product.toLowerCase().includes(searchTerm) ||
                                   product.packaging.toLowerCase().includes(searchTerm) ||
                                   product.po.toLowerCase().includes(searchTerm);
                        });
                    });
                }
                
                this.sortCodes();
                this.currentPage = 1;
                this.updateStats();
                this.populateTable();
                
                console.log(`✅ Brand filtering complete: ${this.filteredCodes.length} brands found`);
            },

            filterCodes() {
                this.searchCodes(); // Use same logic as search
            },

            sortCodes() {
                this.filteredCodes.sort((a, b) => {
                    let aVal, bVal;
                    
                    switch (this.sortColumn) {
                        case 'brand':
                            aVal = a.brand;
                            bVal = b.brand;
                            break;
                        case 'po':
                            aVal = a.po;
                            bVal = b.po;
                            break;
                        case 'mc':
                            aVal = a.totalMC;
                            bVal = b.totalMC;
                            break;
                        case 'kg':
                            aVal = a.totalKG;
                            bVal = b.totalKG;
                            break;
                        case 'products':
                            aVal = a.productCount;
                            bVal = b.productCount;
                            break;
                        default:
                            aVal = a.brand;
                            bVal = b.brand;
                    }
                    
                    if (this.sortColumn === 'mc' || this.sortColumn === 'kg' || this.sortColumn === 'products') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    } else {
                        aVal = String(aVal).toLowerCase();
                        bVal = String(bVal).toLowerCase();
                    }
                    
                    if (aVal < bVal) return this.sortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return this.sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            },



            sortTable(column) {
                if (this.sortColumn === column) {
                    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortColumn = column;
                    this.sortDirection = 'asc';
                }
                
                this.filteredCodes.sort((a, b) => {
                    let aVal = a[column];
                    let bVal = b[column];
                    
                    if (column === 'mc' || column === 'kg') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    } else {
                        aVal = String(aVal).toLowerCase();
                        bVal = String(bVal).toLowerCase();
                    }
                    
                    if (aVal < bVal) return this.sortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return this.sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
                
                this.populateTable();
            },

            populateTable() {
                const tbody = document.getElementById('codeTableBody');
                const mobileTable = document.getElementById('mobileCodeTable');
                
                const start = (this.currentPage - 1) * this.itemsPerPage;
                const end = Math.min(start + this.itemsPerPage, this.filteredCodes.length);
                const pageData = this.filteredCodes.slice(start, end);
                
                // Desktop table - now showing Brand groups
                if (tbody) {
                    tbody.innerHTML = pageData.map((brandGroup, index) => {
                        const productDetails = Object.values(brandGroup.products).map(product => 
                            `<div class="mb-2 p-2 bg-white rounded-lg border border-gray-200">
                                <div class="font-mono font-bold text-indigo-600 mb-1">${product.code}</div>
                                <div class="text-xs text-gray-600">
                                    <span class="badge-advanced badge-success text-xs mr-1">${product.po}</span>
                                    ${product.product} | ${product.packaging}
                                </div>
                                <div class="text-xs text-gray-700 mt-1">
                                    <span class="font-bold text-purple-600">${product.mc.toLocaleString()} MC</span> | 
                                    <span class="font-bold text-emerald-600">${product.kg.toLocaleString()} kg</span>
                                </div>
                            </div>`
                        ).join('');
                        
                        return `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-black text-indigo-600">${brandGroup.brand}</td>
                                <td class="px-8 py-6 text-sm font-mono font-bold text-gray-900">${brandGroup.po}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black text-lg">${brandGroup.productCount}</td>
                                <td class="px-8 py-6 text-sm text-purple-600 text-right font-black text-lg">${brandGroup.totalMC.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-emerald-600 text-right font-black text-lg">${brandGroup.totalKG.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm">
                                    <div class="bg-gradient-to-r from-indigo-50 to-cyan-50 p-3 rounded-xl max-w-md max-h-64 overflow-y-auto">
                                        <div class="text-xs font-bold text-gray-600 mb-2">Products in this Brand:</div>
                                        ${productDetails}
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Mobile table - now showing Brand groups
                if (mobileTable) {
                    mobileTable.innerHTML = pageData.map((brandGroup, index) => {
                        const productList = Object.values(brandGroup.products).map(product => 
                            `<div class="flex items-center justify-between p-2 bg-white rounded-lg shadow-sm mb-2">
                                <div>
                                    <div class="font-mono font-bold text-indigo-600">${product.code}</div>
                                    <div class="text-xs text-gray-600">
                                        <span class="badge-advanced badge-success text-xs">${product.po}</span>
                                    </div>
                                    <div class="text-xs text-gray-700">${product.product} | ${product.packaging}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-purple-600">${product.mc.toLocaleString()} MC</div>
                                    <div class="font-bold text-emerald-600">${product.kg.toLocaleString()} kg</div>
                                </div>
                            </div>`
                        ).join('');
                        
                        return `
                            <div class="mobile-table-card animate-slideInUp border-l-4 border-indigo-500" style="animation-delay: ${index * 0.05}s">
                                <!-- Brand Header -->
                                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-3 rounded-lg mb-4">
                                    <div class="text-xs font-bold text-gray-600 mb-2 uppercase tracking-wide">Brand Summary</div>
                                    <div class="grid grid-cols-2 gap-2 text-sm">
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">Brand Name:</span>
                                            <div class="font-black text-indigo-600">${brandGroup.brand}</div>
                                        </div>
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">PO Number:</span>
                                            <div class="font-mono font-bold text-gray-800">${brandGroup.po}</div>
                                        </div>
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">Products:</span>
                                            <div class="font-bold text-blue-600">${brandGroup.productCount} items</div>
                                        </div>
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">Total:</span>
                                            <div class="font-bold text-purple-600">${brandGroup.totalMC.toLocaleString()} MC</div>
                                            <div class="font-bold text-emerald-600">${brandGroup.totalKG.toLocaleString()} kg</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Product Details -->
                                <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-3 rounded-lg">
                                    <div class="text-xs font-bold text-gray-600 mb-3 uppercase tracking-wide">Product Details</div>
                                    <div class="max-h-64 overflow-y-auto">
                                        ${productList}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                this.updatePagination();
            },

            updatePagination() {
                const total = this.filteredCodes.length;
                const start = (this.currentPage - 1) * this.itemsPerPage + 1;
                const end = Math.min(this.currentPage * this.itemsPerPage, total);
                const maxPages = Math.ceil(total / this.itemsPerPage);
                
                const elements = {
                    showingStart: document.getElementById('codeShowingStart'),
                    showingEnd: document.getElementById('codeShowingEnd'),
                    totalRecords: document.getElementById('codeTotalRecords'),
                    pageInfo: document.getElementById('codePageInfo'),
                    firstBtn: document.getElementById('codeFirstBtn'),
                    prevBtn: document.getElementById('codePrevBtn'),
                    nextBtn: document.getElementById('codeNextBtn'),
                    lastBtn: document.getElementById('codeLastBtn')
                };
                
                if (elements.showingStart) elements.showingStart.textContent = total > 0 ? start : 0;
                if (elements.showingEnd) elements.showingEnd.textContent = end;
                if (elements.totalRecords) elements.totalRecords.textContent = total.toLocaleString();
                if (elements.pageInfo) elements.pageInfo.textContent = `${this.currentPage} / ${maxPages}`;
                
                if (elements.firstBtn) elements.firstBtn.disabled = this.currentPage <= 1;
                if (elements.prevBtn) elements.prevBtn.disabled = this.currentPage <= 1;
                if (elements.nextBtn) elements.nextBtn.disabled = this.currentPage >= maxPages;
                if (elements.lastBtn) elements.lastBtn.disabled = this.currentPage >= maxPages;
            },

            resetFilters() {
                const elements = {
                    codeSearch: document.getElementById('codeSearch'),
                    codeFilterBrand: document.getElementById('codeFilterBrand'),
                    codeFilterPO: document.getElementById('codeFilterPO')
                };
                
                Object.values(elements).forEach(el => {
                    if (el) el.value = el.tagName === 'SELECT' ? el.options[0].value : '';
                });
                
                this.currentPage = 1;
                this.updateSection();
                
                Utils.showNotification('info', '🔄 Code filters reset');
            },

            exportToPDF() {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('landscape');
                    
                    // Header
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text('Brand Breakdown Report - Dashboard v49', 20, 20);
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Generated: ${new Date().toLocaleString('id-ID')}`, 20, 30);
                    doc.text(`Total Brands: ${this.filteredCodes.length}`, 20, 35);
                    doc.text(`User: ${State.currentUser?.name || 'Unknown'}`, 20, 40);
                    
                    // Summary stats
                    const totalMC = this.filteredCodes.reduce((sum, brand) => sum + brand.totalMC, 0);
                    const totalKg = this.filteredCodes.reduce((sum, brand) => sum + brand.totalKG, 0);
                    const totalProducts = this.filteredCodes.reduce((sum, brand) => sum + brand.productCount, 0);
                    
                    doc.text(`Total MC: ${totalMC.toLocaleString()}`, 150, 30);
                    doc.text(`Total Weight: ${totalKg.toLocaleString()} kg`, 150, 35);
                    doc.text(`Total Products: ${totalProducts}`, 150, 40);
                    
                    // Table data - Brand summary
                    const tableData = this.filteredCodes.map(brandGroup => [
                        brandGroup.brand, brandGroup.po, brandGroup.productCount.toString(),
                        brandGroup.totalMC.toLocaleString(), brandGroup.totalKG.toLocaleString() + ' kg'
                    ]);
                    
                    doc.autoTable({
                        head: [['Brand Name', 'PO Number', 'Products', 'Total MC', 'Total Weight']],
                        body: tableData,
                        startY: 50,
                        styles: { 
                            fontSize: 10,
                            cellPadding: 4
                        },
                        headStyles: { 
                            fillColor: [79, 70, 229],
                            textColor: 255,
                            fontStyle: 'bold'
                        },
                        alternateRowStyles: {
                            fillColor: [245, 247, 250]
                        }
                    });
                    
                    // Add detailed breakdown for each Brand
                    let currentY = doc.lastAutoTable.finalY + 20;
                    
                    this.filteredCodes.forEach((brandGroup, index) => {
                        if (currentY > 180) { // Start new page if needed
                            doc.addPage();
                            currentY = 20;
                        }
                        
                        // Brand Header
                        doc.setFontSize(14);
                        doc.setFont(undefined, 'bold');
                        doc.text(`Brand: ${brandGroup.brand} (PO: ${brandGroup.po})`, 20, currentY);
                        currentY += 10;
                        
                        // Product details table
                        const productData = Object.values(brandGroup.products).map(product => [
                            product.code, product.po, product.product, product.packaging,
                            product.mc.toLocaleString(), product.kg.toLocaleString() + ' kg'
                        ]);
                        
                        doc.autoTable({
                            head: [['Code', 'PO Number', 'Product', 'Packaging', 'MC', 'Weight']],
                            body: productData,
                            startY: currentY,
                            styles: { 
                                fontSize: 8,
                                cellPadding: 2
                            },
                            headStyles: { 
                                fillColor: [99, 102, 241],
                                textColor: 255,
                                fontStyle: 'bold'
                            },
                            margin: { left: 30, right: 30 }
                        });
                        
                        currentY = doc.lastAutoTable.finalY + 15;
                    });
                    
                    // Footer
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10);
                        doc.text('Brand Breakdown Report - Dashboard v49', 20, doc.internal.pageSize.height - 10);
                    }
                    
                    doc.save(`brand-breakdown-${new Date().toISOString().split('T')[0]}.pdf`);
                    Utils.showNotification('success', '✅ Brand breakdown PDF exported successfully!');
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    Utils.showNotification('error', '❌ Failed to generate PDF report');
                }
            },

            changeItemsPerPage() {
                const select = document.getElementById('codeItemsPerPage');
                if (select) {
                    this.itemsPerPage = parseInt(select.value);
                    this.currentPage = 1;
                    this.populateTable();
                }
            },

            firstPage() {
                this.currentPage = 1;
                this.populateTable();
            },

            previousPage() {
                if (this.currentPage > 1) {
                    this.currentPage--;
                    this.populateTable();
                }
            },

            nextPage() {
                const maxPages = Math.ceil(this.filteredCodes.length / this.itemsPerPage);
                if (this.currentPage < maxPages) {
                    this.currentPage++;
                    this.populateTable();
                }
            },

            lastPage() {
                const maxPages = Math.ceil(this.filteredCodes.length / this.itemsPerPage);
                this.currentPage = maxPages;
                this.populateTable();
            }
        };

        // ===== ENHANCED EXPORT MODULE =====
        const Export = {
            toPDF() {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('landscape');
                    
                    // Header
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text('Dashboard Stok Produk v49 - Advanced Report', 20, 20);
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Generated: ${new Date().toLocaleString('id-ID')}`, 20, 30);
                    doc.text(`Total Records: ${State.filteredData.length}`, 20, 35);
                    doc.text(`User: ${State.currentUser?.name || 'Unknown'}`, 20, 40);
                    
                    // Summary stats
                    const totalMC = State.filteredData.reduce((sum, row) => sum + (parseInt(row[6]) || 0), 0);
                    const totalKg = State.filteredData.reduce((sum, row) => sum + (parseFloat(row[7]) || 0), 0);
                    
                    doc.text(`Total MC: ${totalMC.toLocaleString()}`, 150, 30);
                    doc.text(`Total Weight: ${totalKg.toLocaleString()} kg`, 150, 35);
                    
                    // Table data
                    const tableData = State.filteredData.map(row => [
                        row[0], row[1], row[2], row[3], row[4], row[5], 
                        row[6].toLocaleString(), row[7].toLocaleString() + ' kg', row[8]
                    ]);
                    
                    doc.autoTable({
                        head: [['Date', 'Product', 'Packaging', 'Brand', 'Code', 'PO Number', 'MC Qty', 'Weight', 'Location']],
                        body: tableData,
                        startY: 50,
                        styles: { 
                            fontSize: 8,
                            cellPadding: 3
                        },
                        headStyles: { 
                            fillColor: [59, 130, 246],
                            textColor: 255,
                            fontStyle: 'bold'
                        },
                        alternateRowStyles: {
                            fillColor: [245, 247, 250]
                        }
                    });
                    
                    // Footer
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10);
                        doc.text('Dashboard v49 - Advanced Stock Management System', 20, doc.internal.pageSize.height - 10);
                    }
                    
                    doc.save(`dashboard-v49-report-${new Date().toISOString().split('T')[0]}.pdf`);
                    Utils.showNotification('success', '✅ PDF report generated successfully!');
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    Utils.showNotification('error', '❌ Failed to generate PDF report');
                }
            },

            toExcel() {
                try {
                    const wb = XLSX.utils.book_new();
                    
                    // Main data sheet
                    const wsData = [
                        ['Date', 'Product', 'Packaging', 'Brand', 'Code', 'PO Number', 'MC Qty', 'Weight (kg)', 'Location'],
                        ...State.filteredData
                    ];
                    
                    const ws = XLSX.utils.aoa_to_sheet(wsData);
                    
                    // Set column widths
                    ws['!cols'] = [
                        { wch: 12 }, { wch: 25 }, { wch: 15 }, { wch: 15 },
                        { wch: 12 }, { wch: 15 }, { wch: 10 }, { wch: 12 }, { wch: 15 }
                    ];
                    
                    XLSX.utils.book_append_sheet(wb, ws, 'Stock Data');
                    
                    // Summary sheet
                    const brandSummary = {};
                    State.filteredData.forEach(row => {
                        const brand = row[3];
                        if (!brandSummary[brand]) {
                            brandSummary[brand] = { mc: 0, kg: 0 };
                        }
                        brandSummary[brand].mc += parseInt(row[6]) || 0;
                        brandSummary[brand].kg += parseFloat(row[7]) || 0;
                    });
                    
                    const summaryData = [
                        ['Brand', 'Total MC', 'Total Weight (kg)'],
                        ...Object.entries(brandSummary).map(([brand, data]) => [
                            brand, data.mc, data.kg
                        ])
                    ];
                    
                    const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
                    XLSX.utils.book_append_sheet(wb, wsSummary, 'Brand Summary');
                    
                    XLSX.writeFile(wb, `dashboard-v49-export-${new Date().toISOString().split('T')[0]}.xlsx`);
                    Utils.showNotification('success', '✅ Excel file exported successfully!');
                    
                } catch (error) {
                    console.error('Error generating Excel:', error);
                    Utils.showNotification('error', '❌ Failed to generate Excel file');
                }
            }
        };

        // ===== ENHANCED UTILITIES MODULE =====
        const Utils = {
            formatDate(dateValue) {
                if (!dateValue) return '';
                
                if (typeof dateValue === 'string' && dateValue.includes('/')) {
                    return dateValue;
                }
                
                if (typeof dateValue === 'number') {
                    const date = XLSX.SSF.parse_date_code(dateValue);
                    if (date) {
                        const day = String(date.d).padStart(2, '0');
                        const month = String(date.m).padStart(2, '0');
                        const year = date.y;
                        return `${day}/${month}/${year}`;
                    }
                }
                
                try {
                    const date = new Date(dateValue);
                    if (!isNaN(date.getTime())) {
                        const day = String(date.getDate()).padStart(2, '0');
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const year = date.getFullYear();
                        return `${day}/${month}/${year}`;
                    }
                } catch (e) {
                    console.warn('Date parsing error:', e);
                }
                
                return String(dateValue);
            },

            parseDate(dateString) {
                if (!dateString) return new Date(0);
                
                if (dateString.includes('/')) {
                    const [day, month, year] = dateString.split('/');
                    return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                }
                
                return new Date(dateString);
            },

            showNotification(type, message) {
                // Notifications disabled
                console.log(`${type.toUpperCase()}: ${message}`);
            },

            setCurrentTime() {
                const updateTime = () => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('id-ID');
                    
                    const timeElements = document.querySelectorAll('#currentTime');
                    timeElements.forEach(el => {
                        if (el) el.textContent = timeString;
                    });
                };
                
                updateTime();
                setInterval(updateTime, 1000);
            },



            generateSessionId() {
                return 'sess_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
            },

            updateLastUpdateTime() {
                const lastUpdateElement = document.getElementById('lastUpdateTime');
                if (lastUpdateElement && State.targetDate) {
                    lastUpdateElement.textContent = `Target Date: ${State.targetDate}`;
                }
            }
        };

        // ===== PERFORMANCE MONITORING MODULE =====
        const Performance = {
            startTracking() {
                console.log('📊 Performance tracking started');
                
                // Monitor memory usage
                if ('memory' in performance) {
                    setInterval(() => {
                        const memory = performance.memory;
                        console.log(`Memory: ${(memory.usedJSHeapSize / 1048576).toFixed(2)}MB used`);
                    }, 60000); // Every minute
                }
                
                // Monitor page load performance
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log(`Page load: ${perfData.loadEventEnd - perfData.fetchStart}ms`);
                    }, 0);
                });
            }
        };

        // ===== GLOBAL FUNCTIONS =====
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('passwordToggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye';
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log(`🚀 Initializing Dashboard v${CONFIG.VERSION} - Advanced Stock Management System`);
            console.log('Features enabled:', CONFIG.FEATURES);
            
            Auth.init();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'e':
                            e.preventDefault();
                            Export.toPDF();
                            break;
                        case 'f':
                            e.preventDefault();
                            const searchInput = document.getElementById('searchProduct');
                            if (searchInput) searchInput.focus();
                            break;
                    }
                }
                
                // Close search results on Escape
                if (e.key === 'Escape') {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults) {
                        searchResults.classList.remove('show');
                    }
                }
            });
            
            // Close search results when clicking outside
            document.addEventListener('click', (e) => {
                const searchContainer = document.querySelector('.search-container');
                const searchResults = document.getElementById('searchResults');
                
                if (searchResults && !searchContainer?.contains(e.target)) {
                    searchResults.classList.remove('show');
                }
            });
            
            console.log('✅ Dashboard v49 initialization complete');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96921e4cb44db5ac',t:'MTc1NDE4NTM0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
            overflow-x: hidden;
        }
        
        /* Advanced Glass Morphism */
        .glass-morphism {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Advanced Card Styles */
        .advanced-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .advanced-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .advanced-card:hover::before {
            left: 100%;
        }
        
        .advanced-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(102, 126, 234, 0.2);
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
        
        /* Advanced Sidebar */
        .advanced-sidebar {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(25px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-item {
            position: relative;
            margin: 8px 12px;
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .sidebar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }
        
        .sidebar-item:hover::before,
        .sidebar-item.active::before {
            left: 0;
        }
        
        .sidebar-item:hover,
        .sidebar-item.active {
            color: white;
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        /* Advanced Table */
        .advanced-table {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .table-row {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
        }
        
        .table-row:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, rgba(255, 255, 255, 0.8) 100%);
            border-left-color: #667eea;
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }
        
        /* Advanced Stats Cards */
        .stat-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        .stat-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        /* Advanced Buttons */
        .btn-advanced {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-advanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-advanced:hover::before {
            left: 100%;
        }
        
        .btn-advanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-advanced:active {
            transform: translateY(0);
        }
        
        /* Advanced Form Inputs */
        .form-advanced {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-advanced:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.95);
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        /* Advanced Badges */
        .badge-advanced {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .badge-primary { background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.3) 100%); color: #1d4ed8; }
        .badge-success { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.3) 100%); color: #047857; }
        .badge-warning { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(245, 158, 11, 0.3) 100%); color: #92400e; }
        .badge-danger { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.3) 100%); color: #991b1b; }
        
        /* Loading Animations */
        .loading-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .loading-spin {
            animation: spin 1s linear infinite;
        }
        
        .loading-bounce {
            animation: bounce 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: none; animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .animate-slideInUp { animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-slideInRight { animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .animate-fadeIn { animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Advanced Progress Bar */
        .progress-advanced {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar-advanced {
            background: var(--primary-gradient);
            height: 8px;
            border-radius: 10px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar-advanced::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        

        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .advanced-sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 50;
                height: 100vh;
                width: 280px;
            }
            
            .advanced-sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
                padding: 12px;
            }
            
            .fab {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .stat-card {
                padding: 16px;
            }
            
            .advanced-card {
                margin: 8px 0;
                padding: 16px !important;
            }
            
            /* Mobile table styles */
            .advanced-table {
                border-radius: 12px;
            }
            
            .mobile-table-card {
                background: white;
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                border-left: 4px solid #3B82F6;
            }
            
            .mobile-table-header {
                font-weight: bold;
                color: #1F2937;
                margin-bottom: 8px;
                font-size: 16px;
            }
            
            .mobile-table-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 4px 0;
                border-bottom: 1px solid #F3F4F6;
            }
            
            .mobile-table-row:last-child {
                border-bottom: none;
            }
            
            .mobile-table-label {
                font-weight: 600;
                color: #6B7280;
                font-size: 12px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .mobile-table-value {
                font-weight: bold;
                color: #1F2937;
                text-align: right;
            }
            
            /* Hide desktop table on mobile */
            .desktop-table {
                display: table;
            }
            
            .mobile-table {
                display: none;
            }
            
            @media (max-width: 768px) {
                .desktop-table {
                    display: none;
                }
                
                .mobile-table {
                    display: block;
                }
            }
            
            /* Mobile stats grid */
            .grid {
                gap: 16px;
            }
            
            @media (max-width: 640px) {
                .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-4 {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .grid-cols-1.md\\:grid-cols-4 {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .grid-cols-1.md\\:grid-cols-3 {
                    grid-template-columns: repeat(1, 1fr);
                }
            }
            
            /* Mobile text sizes */
            h2 {
                font-size: 2rem !important;
                line-height: 1.2;
            }
            
            .text-5xl {
                font-size: 2rem !important;
            }
            
            .text-4xl {
                font-size: 1.5rem !important;
            }
            
            .text-2xl {
                font-size: 1.25rem !important;
            }
            
            .text-xl {
                font-size: 1rem !important;
            }
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .glass-morphism {
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .advanced-card {
                background: linear-gradient(145deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.7) 100%);
                border: 1px solid rgba(255, 255, 255, 0.1);
                color: white;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
        
        /* Advanced Search */
        .search-container {
            position: relative;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .search-results.show {
            display: block;
        }
        
        .search-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .search-item:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .search-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="advanced-card p-8 w-full max-w-md mx-4 animate-slideInUp">
            <div class="text-center mb-8">
                <div class="mx-auto w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center mb-6 shadow-2xl transform hover:scale-105 transition-transform">
                    <div class="text-white text-4xl">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <h2 class="text-4xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">Dashboard v49</h2>
                <p class="text-gray-600 font-medium text-lg">Advanced Stock Management System</p>
                <div class="mt-4 flex items-center justify-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-sm text-gray-500 font-medium">CDN Data Ready</span>
                </div>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">Username</label>
                    <div class="relative">
                        <input type="text" id="username" required 
                               class="form-advanced w-full pl-12 pr-4 py-4"
                               placeholder="Enter your username" autocomplete="username">
                        <i class="fas fa-user absolute left-4 top-5 text-blue-500"></i>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-sm font-bold text-gray-700">Password</label>
                    <div class="relative">
                        <input type="password" id="password" required 
                               class="form-advanced w-full pl-12 pr-12 py-4"
                               placeholder="Enter your password" autocomplete="current-password">
                        <i class="fas fa-lock absolute left-4 top-5 text-blue-500"></i>
                        <button type="button" onclick="togglePassword()" class="absolute right-4 top-5 text-gray-400 hover:text-blue-500 transition-colors">
                            <i id="passwordToggle" class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div id="loginError" class="hidden bg-red-50 border-l-4 border-red-500 p-4 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                        <span class="text-red-700 font-medium">Invalid credentials! Please try again.</span>
                    </div>
                </div>
                
                <button type="submit" class="btn-advanced w-full py-4 text-lg font-bold shadow-xl">
                    <span id="loginButtonText" class="flex items-center justify-center">
                        <i class="fas fa-sign-in-alt mr-3"></i>Access Dashboard
                    </span>
                    <div id="loginSpinner" class="hidden flex items-center justify-center">
                        <div class="loading-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full mr-3"></div>
                        Authenticating...
                    </div>
                </button>
            </form>
            
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="advanced-card p-6">
                    <h4 class="text-sm font-bold text-gray-700 mb-4 flex items-center">
                        <i class="fas fa-key text-blue-500 mr-2"></i>Demo Accounts
                    </h4>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Admin:</span>
                            <span class="font-mono text-blue-600 font-bold">admin / admin123</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Manager:</span>
                            <span class="font-mono text-green-600 font-bold">manager / manager123</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
                            <span class="font-semibold text-gray-700">Staff:</span>
                            <span class="font-mono text-purple-600 font-bold">staff / staff123</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Header -->
    <div class="md:hidden glass-morphism shadow-xl px-6 py-4 flex items-center justify-between relative z-40">
        <button onclick="UI.toggleSidebar()" class="text-blue-600 hover:text-purple-600 transition-colors p-2 rounded-lg hover:bg-blue-50">
            <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="flex items-center">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
                <i class="fas fa-chart-line text-white text-lg"></i>
            </div>
            <div>
                <h1 class="text-lg font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Dashboard v49</h1>
                <p class="text-xs text-gray-500 font-medium">Advanced System</p>
            </div>
        </div>
        <div class="w-10"></div>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay fixed inset-0 bg-black bg-opacity-50 z-30 hidden backdrop-blur-sm" onclick="UI.closeSidebar()"></div>

    <!-- Advanced Sidebar -->
    <div class="advanced-sidebar fixed left-0 top-0 h-full w-80 z-40">
        <div class="p-8 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mr-4 shadow-xl">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Dashboard</h1>
                        <p class="text-sm text-gray-500 font-bold mt-1">Advanced System</p>
                    </div>
                </div>
                <button onclick="UI.closeSidebar()" class="md:hidden text-gray-600 hover:text-purple-600 transition-colors p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
        </div>
        
        <!-- User Info -->
        <div id="userInfo" class="px-6 py-6 border-b border-gray-200 hidden">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mr-4 shadow-lg">
                        <i class="fas fa-user text-white"></i>
                    </div>
                    <div>
                        <div class="text-sm font-bold text-gray-800" id="userName">-</div>
                        <div class="text-xs text-gray-500 capitalize font-semibold" id="userRole">-</div>
                    </div>
                </div>
                <button onclick="Auth.logout()" class="text-gray-400 hover:text-red-500 transition-colors p-2 rounded-lg hover:bg-red-50" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <nav class="mt-8 px-6 space-y-4">
            <a href="#" class="sidebar-item active flex items-center px-6 py-4 text-white rounded-2xl font-bold shadow-lg" onclick="Navigation.showSection('dashboard')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-tachometer-alt text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Main Dashboard</div>
                    <div class="text-xs opacity-75">Stock Overview</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('analytics')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-chart-bar text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Analytics</div>
                    <div class="text-xs opacity-75">Advanced Reports</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('rekap-po')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-file-invoice text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">PO Summary</div>
                    <div class="text-xs opacity-75">Purchase Orders</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('rekap-brand')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-tags text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Brand Analysis</div>
                    <div class="text-xs opacity-75">Brand Performance</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('rekap-lokasi')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-map-marker-alt text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Location Tracking</div>
                    <div class="text-xs opacity-75">Warehouse Data</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('code-breakdown')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-code text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Code Breakdown</div>
                    <div class="text-xs opacity-75">Product Codes</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('data-entry-summary')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-calendar-alt text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Data Entry Summary</div>
                    <div class="text-xs opacity-75">Daily Breakdown</div>
                </div>
            </a>
            
            <a href="#" class="sidebar-item flex items-center px-6 py-4 text-gray-700 rounded-2xl font-bold hover:text-white" onclick="Navigation.showSection('real-time')">
                <div class="w-8 h-8 mr-4 flex items-center justify-center">
                    <i class="fas fa-broadcast-tower text-xl"></i>
                </div>
                <div>
                    <div class="text-sm">Real-time Monitor</div>
                    <div class="text-xs opacity-75">Live Updates</div>
                </div>
            </a>
        </nav>
        

    </div>

    <!-- Main Content -->
    <div class="main-content ml-80 p-8 min-h-screen">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section animate-fadeIn">
            <!-- Header -->
            <div class="mb-10">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-5xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">Advanced Dashboard v49</h2>
                        <p class="text-gray-600 text-xl font-semibold">Real-time Stock Management & Analytics System</p>
                    </div>
                </div>
            </div>



            <!-- Advanced Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="totalItems">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total MC</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Master Cartons</span>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="totalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Weight</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Kilograms</span>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="uniqueProducts">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Products</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-cube text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-purple-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Unique Items</span>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.4s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-orange-600 mb-2" id="uniqueBrands">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Brands</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tags text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-orange-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-500 font-semibold">Brand Count</span>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters -->
            <div class="advanced-card p-8 mb-10 animate-slideInUp" style="animation-delay: 0.5s">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-black text-gray-800">Advanced Filters</h3>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                            <span class="text-sm font-semibold text-gray-600">Real-time Filtering</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div id="connectionStatus" class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span id="connectionText" class="text-sm font-semibold text-gray-600">Google Sheets</span>
                        </div>
                        <div id="lastUpdateTime" class="text-xs text-gray-500 font-medium">
                            Target Date: Loading...
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Start Date</label>
                        <input type="date" id="startDate" class="form-advanced w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">End Date</label>
                        <input type="date" id="endDate" class="form-advanced w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Brand Selection</label>
                        <select id="brandFilter" class="form-advanced w-full">
                            <option value="">All Brands</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="search-container">
                        <label class="block text-sm font-bold text-gray-700 mb-3">Smart Search</label>
                        <div class="relative">
                            <input type="text" id="searchProduct" placeholder="Search products, brands, packaging, or PO numbers..." 
                                   class="form-advanced w-full pl-12 pr-4" onkeyup="SmartSearch.performSearch()">
                            <i class="fas fa-search absolute left-4 top-4 text-blue-500"></i>
                        </div>
                        <div id="searchResults" class="search-results"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Location Filter</label>
                        <select id="locationFilter" class="form-advanced w-full">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Sort By</label>
                        <select id="sortBy" class="form-advanced w-full" onchange="SmartSearch.applySorting()">
                            <option value="date-desc">Date (Newest First)</option>
                            <option value="date-asc">Date (Oldest First)</option>
                            <option value="product-asc">Product Name (A-Z)</option>
                            <option value="product-desc">Product Name (Z-A)</option>
                            <option value="brand-asc">Brand (A-Z)</option>
                            <option value="brand-desc">Brand (Z-A)</option>
                            <option value="mc-desc">MC Quantity (High to Low)</option>
                            <option value="mc-asc">MC Quantity (Low to High)</option>
                            <option value="kg-desc">Weight (Heavy to Light)</option>
                            <option value="kg-asc">Weight (Light to Heavy)</option>
                            <option value="po-asc">PO Number (A-Z)</option>
                            <option value="po-desc">PO Number (Z-A)</option>
                        </select>
                    </div>

                </div>
                
                <div class="flex flex-wrap gap-4">
                    <button onclick="Filters.apply()" class="btn-advanced px-8 py-3 shadow-xl">
                        <i class="fas fa-filter mr-2"></i>Apply Filters
                    </button>
                    <button onclick="Filters.reset()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-undo mr-2"></i>Reset All
                    </button>
                    <button onclick="DataLoader.loadFromGoogleSheets()" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl" id="refreshBtn">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh Data
                    </button>
                    <button onclick="Export.toPDF()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-file-pdf mr-2"></i>Export PDF
                    </button>
                </div>
            </div>



            <!-- Advanced Data Table -->
            <div class="advanced-table animate-slideInUp" style="animation-delay: 0.7s">
                <div class="table-header px-4 md:px-8 py-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg md:text-xl font-black">Stock Data Table</h3>
                        <div class="flex items-center space-x-4">
                            <span class="text-xs md:text-sm font-semibold opacity-90">Real-time Data</span>
                            <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Table -->
                <div class="desktop-table overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-blue-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(0)">
                                    Date <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(1)">
                                    Product <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(2)">
                                    Packaging <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(3)">
                                    Brand <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(4)">
                                    Code <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(5)">
                                    PO Number <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(6)">
                                    MC Qty <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(7)">
                                    Weight (Kg) <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-blue-100 transition-colors" onclick="Table.sort(8)">
                                    Location <i class="fas fa-sort ml-2 text-blue-500"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile Table -->
                <div class="mobile-table p-4" id="mobileStockTable">
                    <!-- Mobile cards populated by JavaScript -->
                </div>
                
                <!-- Advanced Pagination -->
                <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-4 md:px-8 py-6 border-t border-gray-200">
                    <!-- Mobile Pagination -->
                    <div class="md:hidden">
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-xs text-gray-700 font-bold">
                                <span id="showingStartMobile" class="font-black text-blue-600">0</span> - <span id="showingEndMobile" class="font-black text-blue-600">0</span> of <span id="totalRecordsMobile" class="font-black text-blue-600">0</span>
                            </div>
                            <select id="itemsPerPageMobile" onchange="Table.changeItemsPerPage()" class="form-advanced text-xs py-1 px-2">
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="25">25</option>
                            </select>
                        </div>
                        <div class="flex items-center justify-center space-x-2">
                            <button onclick="Table.firstPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="firstBtnMobile">
                                <i class="fas fa-angle-double-left text-blue-600"></i>
                            </button>
                            <button onclick="Table.previousPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="prevBtnMobile">
                                <i class="fas fa-angle-left text-blue-600"></i>
                            </button>
                            <span id="pageInfoMobile" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-black shadow-lg text-sm">1</span>
                            <button onclick="Table.nextPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="nextBtnMobile">
                                <i class="fas fa-angle-right text-blue-600"></i>
                            </button>
                            <button onclick="Table.lastPage()" class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold text-sm" id="lastBtnMobile">
                                <i class="fas fa-angle-double-right text-blue-600"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Desktop Pagination -->
                    <div class="hidden md:flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-700 font-bold">
                                Showing <span id="showingStart" class="font-black text-blue-600">0</span> - <span id="showingEnd" class="font-black text-blue-600">0</span> of <span id="totalRecords" class="font-black text-blue-600">0</span>
                            </div>
                            <select id="itemsPerPage" onchange="Table.changeItemsPerPage()" class="form-advanced text-sm py-2 px-3">
                                <option value="10">10 per page</option>
                                <option value="25">25 per page</option>
                                <option value="50">50 per page</option>
                                <option value="100">100 per page</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="Table.firstPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="firstBtn">
                                <i class="fas fa-angle-double-left text-blue-600"></i>
                            </button>
                            <button onclick="Table.previousPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="prevBtn">
                                <i class="fas fa-angle-left text-blue-600"></i>
                            </button>
                            <span id="pageInfo" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-black shadow-lg">1</span>
                            <button onclick="Table.nextPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="nextBtn">
                                <i class="fas fa-angle-right text-blue-600"></i>
                            </button>
                            <button onclick="Table.lastPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-bold" id="lastBtn">
                                <i class="fas fa-angle-double-right text-blue-600"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-3">Advanced Analytics</h2>
                <p class="text-gray-600 text-xl font-semibold">Real-time Data Visualization & Insights</p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Brand Distribution</h3>
                    <div class="h-80">
                        <canvas id="brandChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Stock Trend</h3>
                    <div class="h-80">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- PO Summary Section -->
        <div id="rekap-po-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-blue-600 to-green-600 bg-clip-text text-transparent mb-3">📁 PO Summary</h2>
                <p class="text-gray-600 text-xl font-semibold">Purchase Order Analysis & Tracking</p>
            </div>
            
            <!-- PO Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="totalPOs">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total POs</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-file-invoice text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="activePOs">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Active POs</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-check-circle text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="poTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total MC</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-orange-600 mb-2" id="poTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Weight</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PO Table -->
            <div class="advanced-table animate-slideInUp">
                <div class="table-header px-8 py-6">
                    <h3 class="text-xl font-black">Purchase Order Details</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-blue-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">PO Number</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Date</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Items</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total MC</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total Weight</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="poTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Brand Analysis Section -->
        <div id="rekap-brand-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-3">🏷️ Brand Analysis</h2>
                <p class="text-gray-600 text-xl font-semibold">Brand Performance & Distribution Analysis</p>
            </div>
            
            <!-- Brand Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="totalBrands">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Brands</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tags text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-pink-600 mb-2" id="topBrand">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Top Brand</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-pink-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-crown text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-indigo-600 mb-2" id="brandTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg MC/Brand</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-chart-pie text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-teal-600 mb-2" id="brandTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg Kg/Brand</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-teal-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-balance-scale text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Brand Chart and Table -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Brand Distribution</h3>
                    <div class="h-80">
                        <canvas id="brandDistributionChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Top Brands by Weight</h3>
                    <div class="space-y-4" id="topBrandsList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Brand Table -->
            <div class="advanced-table animate-slideInUp">
                <div class="table-header px-8 py-6">
                    <h3 class="text-xl font-black">Brand Performance Details</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-purple-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Brand Name</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Products</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total MC</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total Weight</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Market Share</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Performance</th>
                            </tr>
                        </thead>
                        <tbody id="brandTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Location Tracking Section -->
        <div id="rekap-lokasi-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent mb-3">📍 Location Tracking</h2>
                <p class="text-gray-600 text-xl font-semibold">Warehouse Distribution & Location Analysis</p>
            </div>
            
            <!-- Location Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="totalLocations">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Locations</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-map-marker-alt text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-teal-600 mb-2" id="busyLocation">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Busiest</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-teal-500 to-teal-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-warehouse text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="locationTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg MC/Location</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="locationTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Avg Kg/Location</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Location Chart and Capacity -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Location Distribution</h3>
                    <div class="h-80">
                        <canvas id="locationChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Warehouse Capacity</h3>
                    <div class="space-y-6" id="warehouseCapacity">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Location Table -->
            <div class="advanced-table animate-slideInUp">
                <div class="table-header px-8 py-6">
                    <h3 class="text-xl font-black">Location Details</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-green-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Location</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Products</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total MC</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Total Weight</th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider">Utilization</th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="locationTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Code Breakdown Section -->
        <div id="code-breakdown-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-indigo-600 to-cyan-600 bg-clip-text text-transparent mb-3">🔍 Code Breakdown</h2>
                <p class="text-gray-600 text-xl font-semibold">Brand Analysis & Product Breakdown</p>
            </div>
            
            <!-- Code Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-indigo-600 mb-2" id="totalCodes">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Brands</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tags text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-cyan-600 mb-2" id="uniqueCodeBrands">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Unique Products</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-cube text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="codeTotalMC">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total MC</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-boxes text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-emerald-600 mb-2" id="codeTotalKg">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Total Weight</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-weight text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Code Search and Filter -->
            <div class="advanced-card p-8 mb-10 animate-slideInUp" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-black text-gray-800">Code Search & Filter</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-indigo-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-semibold text-gray-600">Smart Code Analysis</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Search by Brand</label>
                        <input type="text" id="codeSearch" placeholder="Search brands, products, codes..." 
                               class="form-advanced w-full" onkeyup="CodeBreakdown.searchCodes()">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Filter by Brand</label>
                        <select id="codeFilterBrand" class="form-advanced w-full" onchange="CodeBreakdown.filterCodes()">
                            <option value="">All Brands</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-3">Filter PO</label>
                        <select id="codeFilterPO" class="form-advanced w-full" onchange="CodeBreakdown.filterCodes()">
                            <option value="">All PO Numbers</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-4">
                    <button onclick="CodeBreakdown.resetFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-undo mr-2"></i>Reset Filters
                    </button>
                    <button onclick="CodeBreakdown.exportToPDF()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-xl font-bold transition-all shadow-xl hover:shadow-2xl">
                        <i class="fas fa-file-pdf mr-2"></i>Export PDF
                    </button>
                </div>
            </div>
            
            <!-- Code Breakdown Table -->
            <div class="advanced-table animate-slideInUp" style="animation-delay: 0.5s">
                <div class="table-header px-4 md:px-8 py-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg md:text-xl font-black">Product Code Details</h3>
                        <div class="hidden md:flex items-center space-x-4">
                            <span class="text-sm font-semibold opacity-90">Brand : Product : Packaging : Code</span>
                            <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Table -->
                <div class="desktop-table overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-gray-50 to-indigo-50">
                            <tr>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('brand')">
                                    Brand Name <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('po')">
                                    PO Number <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('products')">
                                    Products <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('mc')">
                                    Total MC <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-right text-xs font-black text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-indigo-100 transition-colors" onclick="CodeBreakdown.sortTable('kg')">
                                    Total Weight <i class="fas fa-sort ml-2 text-indigo-500"></i>
                                </th>
                                <th class="px-8 py-6 text-left text-xs font-black text-gray-700 uppercase tracking-wider">
                                    Product Details
                                </th>
                            </tr>
                        </thead>
                        <tbody id="codeTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Mobile Code Breakdown -->
                <div class="mobile-table p-4" id="mobileCodeTable">
                    <!-- Mobile code cards populated by JavaScript -->
                </div>
                
                <!-- Code Pagination -->
                <div class="bg-gradient-to-r from-gray-50 to-indigo-50 px-8 py-6 flex items-center justify-between border-t border-gray-200">
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-700 font-bold">
                            Showing <span id="codeShowingStart" class="font-black text-indigo-600">0</span> - <span id="codeShowingEnd" class="font-black text-indigo-600">0</span> of <span id="codeTotalRecords" class="font-black text-indigo-600">0</span>
                        </div>
                        <select id="codeItemsPerPage" onchange="CodeBreakdown.changeItemsPerPage()" class="form-advanced text-sm py-2 px-3">
                            <option value="10">10 per page</option>
                            <option value="25">25 per page</option>
                            <option value="50">50 per page</option>
                            <option value="100">100 per page</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="CodeBreakdown.firstPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codeFirstBtn">
                            <i class="fas fa-angle-double-left text-indigo-600"></i>
                        </button>
                        <button onclick="CodeBreakdown.previousPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codePrevBtn">
                            <i class="fas fa-angle-left text-indigo-600"></i>
                        </button>
                        <span id="codePageInfo" class="px-6 py-2 bg-gradient-to-r from-indigo-500 to-cyan-600 text-white rounded-lg font-black shadow-lg">1</span>
                        <button onclick="CodeBreakdown.nextPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codeNextBtn">
                            <i class="fas fa-angle-right text-indigo-600"></i>
                        </button>
                        <button onclick="CodeBreakdown.lastPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-indigo-50 transition-colors shadow-sm font-bold" id="codeLastBtn">
                            <i class="fas fa-angle-double-right text-indigo-600"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Entry Summary Section -->
        <div id="data-entry-summary-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-3">📅 Data Entry Summary</h2>
                <p class="text-gray-600 text-xl font-semibold">Daily Data Entry Breakdown & Analysis</p>
            </div>
            
            <!-- Date Entry Summary -->
            <div class="advanced-card p-8 mb-10 animate-slideInUp" style="animation-delay: 0.1s">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-black text-gray-800">📅 Data Entry Summary by Date</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-semibold text-gray-600">Daily Breakdown</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Date Summary Chart -->
                    <div class="h-80">
                        <canvas id="dateSummaryChart"></canvas>
                    </div>
                    
                    <!-- Date Summary Table -->
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-6 max-h-80 overflow-y-auto">
                        <h4 class="text-lg font-black text-gray-800 mb-4">Daily Statistics</h4>
                        <div id="dateSummaryList" class="space-y-3">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Monitor Section -->
        <div id="real-time-section" class="section hidden">
            <div class="mb-10">
                <h2 class="text-5xl font-black bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text text-transparent mb-3">📡 Real-time Monitor</h2>
                <p class="text-gray-600 text-xl font-semibold">Live System Monitoring & Performance Metrics</p>
            </div>
            
            <!-- Real-time Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-10">
                <div class="stat-card animate-slideInUp">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-green-600 mb-2" id="systemStatus">Online</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">System Status</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-heartbeat text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.1s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-blue-600 mb-2" id="dataFreshness">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Data Age</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-clock text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.2s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-purple-600 mb-2" id="loadTime">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Load Time</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-tachometer-alt text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card animate-slideInUp" style="animation-delay: 0.3s">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-4xl font-black text-orange-600 mb-2" id="memoryUsage">-</div>
                            <div class="text-sm text-gray-600 font-bold uppercase tracking-wide">Memory</div>
                        </div>
                        <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-memory text-white text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Performance Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">System Performance</h3>
                    <div class="h-80">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                
                <div class="advanced-card p-8">
                    <h3 class="text-xl font-black text-gray-800 mb-6">Data Flow Monitor</h3>
                    <div class="h-80">
                        <canvas id="dataFlowChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- System Logs -->
            <div class="advanced-card p-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-black text-gray-800">System Activity Log</h3>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-semibold text-gray-600">Live Updates</span>
                    </div>
                </div>
                <div class="bg-gray-900 rounded-xl p-6 h-64 overflow-y-auto font-mono text-sm" id="systemLogs">
                    <!-- Logs populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="UI.showQuickActions()" title="Quick Actions">
        <i class="fas fa-plus"></i>
    </button>

    <script>
        // ===== ENHANCED CONFIGURATION =====
        const CONFIG = {
            VERSION: '49.0.0',
            SHEET_ID: '18ga4stLBiKWujBryPQHUHrUzgYjprFJEKvUWSd3Zcks',
            SHEET_NAME: 'WKB',
            API_KEY: 'AIzaSyBBY9oqeEjjpVnIXOhdkhR6xuTsCr5gYU8',
            ITEMS_PER_PAGE: window.innerWidth <= 768 ? 5 : 10,
            MAX_ITEMS_PER_PAGE: 100,
            AUTO_REFRESH_INTERVAL: 300000, // 5 minutes
            ANIMATION_DURATION: 300,
            TARGET_DATE_CELL: 'J1',
            USERS: {
                'admin': { password: 'admin123', role: 'admin', name: 'System Administrator', permissions: ['all'] },
                'manager': { password: 'manager123', role: 'manager', name: 'Warehouse Manager', permissions: ['read', 'export', 'analytics'] },
                'staff': { password: 'staff123', role: 'staff', name: 'Warehouse Staff', permissions: ['read'] }
            },
            FEATURES: {
                REAL_TIME_UPDATES: true,
                ADVANCED_ANALYTICS: true,
                EXPORT_CAPABILITIES: true,
                SMART_SEARCH: true,
                AUTO_BACKUP: true
            }
        };

        // ===== ENHANCED GLOBAL STATE =====
        const State = {
            version: CONFIG.VERSION,
            currentUser: null,
            stockData: [],
            filteredData: [],
            currentPage: 1,
            itemsPerPage: CONFIG.ITEMS_PER_PAGE,
            sortColumn: -1,
            sortDirection: 'asc',
            isLoading: false,
            targetDate: '29/01/2024',
            lastUpdate: null,
            autoRefreshTimer: null,
            searchCache: new Map(),
            charts: {
                brand: null,
                trend: null,
                analytics: {}
            },
            performance: {
                loadTime: 0,
                renderTime: 0,
                dataSize: 0
            },
            filters: {
                startDate: '',
                endDate: '',
                brand: '',
                location: '',
                search: ''
            }
        };

        // ===== ENHANCED AUTHENTICATION MODULE =====
        const Auth = {
            init() {
                console.log(`🚀 Initializing Dashboard v${CONFIG.VERSION}...`);
                const savedUser = localStorage.getItem('dashboardUser_v49');
                if (savedUser) {
                    try {
                        State.currentUser = JSON.parse(savedUser);
                        if (this.validateSession()) {
                            this.showDashboard();
                        } else {
                            this.logout();
                        }
                    } catch (e) {
                        console.warn('Invalid session data:', e);
                        localStorage.removeItem('dashboardUser_v49');
                        this.showLogin();
                    }
                } else {
                    this.showLogin();
                }

                this.bindEvents();
            },

            bindEvents() {
                const loginForm = document.getElementById('loginForm');
                if (loginForm) {
                    loginForm.addEventListener('submit', this.handleLogin.bind(this));
                }

                // Auto-logout on tab visibility change for security
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && State.currentUser) {
                        console.log('🔒 Tab hidden - pausing auto-refresh');
                        if (State.autoRefreshTimer) {
                            clearInterval(State.autoRefreshTimer);
                        }
                    } else if (!document.hidden && State.currentUser) {
                        console.log('👁️ Tab visible - resuming auto-refresh');
                        this.startAutoRefresh();
                    }
                });
            },

            validateSession() {
                if (!State.currentUser || !State.currentUser.loginTime) return false;
                
                const loginTime = new Date(State.currentUser.loginTime);
                const now = new Date();
                const sessionDuration = now - loginTime;
                const maxSessionDuration = 8 * 60 * 60 * 1000; // 8 hours
                
                return sessionDuration < maxSessionDuration;
            },

            showLogin() {
                const modal = document.getElementById('loginModal');
                if (modal) {
                    modal.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                    
                    // Focus on username field
                    setTimeout(() => {
                        const usernameField = document.getElementById('username');
                        if (usernameField) usernameField.focus();
                    }, 300);
                }
            },

            hideLogin() {
                const modal = document.getElementById('loginModal');
                if (modal) {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            },

            showDashboard() {
                this.hideLogin();
                this.updateUserInfo();
                this.startAutoRefresh();
                DataLoader.init();
                Charts.init();
                Utils.setCurrentTime();
                Performance.startTracking();
            },

            async handleLogin(e) {
                e.preventDefault();
                
                const elements = {
                    username: document.getElementById('username'),
                    password: document.getElementById('password'),
                    error: document.getElementById('loginError'),
                    buttonText: document.getElementById('loginButtonText'),
                    spinner: document.getElementById('loginSpinner')
                };
                
                const username = elements.username.value.trim();
                const password = elements.password.value;
                
                // Show loading state
                elements.buttonText.classList.add('hidden');
                elements.spinner.classList.remove('hidden');
                elements.error.classList.add('hidden');
                
                // Simulate authentication delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                if (CONFIG.USERS[username] && CONFIG.USERS[username].password === password) {
                    State.currentUser = {
                        username: username,
                        name: CONFIG.USERS[username].name,
                        role: CONFIG.USERS[username].role,
                        permissions: CONFIG.USERS[username].permissions,
                        loginTime: new Date().toISOString(),
                        sessionId: Utils.generateSessionId()
                    };
                    
                    localStorage.setItem('dashboardUser_v49', JSON.stringify(State.currentUser));
                    
                    elements.buttonText.innerHTML = '<i class="fas fa-check mr-3"></i>Access Granted!';
                    elements.buttonText.classList.remove('hidden');
                    elements.spinner.classList.add('hidden');
                    
                    setTimeout(() => {
                        this.showDashboard();
                        Utils.showNotification('success', `🎉 Welcome back, ${State.currentUser.name}!`);
                    }, 800);
                    
                } else {
                    elements.buttonText.classList.remove('hidden');
                    elements.spinner.classList.add('hidden');
                    elements.error.classList.remove('hidden');
                    elements.password.value = '';
                    elements.password.focus();
                }
            },

            updateUserInfo() {
                if (!State.currentUser) return;
                
                const elements = {
                    userInfo: document.getElementById('userInfo'),
                    userName: document.getElementById('userName'),
                    userRole: document.getElementById('userRole')
                };
                
                if (elements.userInfo && elements.userName && elements.userRole) {
                    elements.userInfo.classList.remove('hidden');
                    elements.userName.textContent = State.currentUser.name;
                    elements.userRole.textContent = State.currentUser.role.toUpperCase();
                }
            },

            startAutoRefresh() {
                if (State.autoRefreshTimer) {
                    clearInterval(State.autoRefreshTimer);
                }
                
                if (CONFIG.FEATURES.REAL_TIME_UPDATES) {
                    State.autoRefreshTimer = setInterval(() => {
                        if (!document.hidden) {
                            console.log('🔄 Auto-refreshing data...');
                            DataLoader.loadFromGoogleSheets(true);
                        }
                    }, CONFIG.AUTO_REFRESH_INTERVAL);
                }
            },

            logout() {
                if (confirm('Are you sure you want to logout?')) {
                    if (State.autoRefreshTimer) {
                        clearInterval(State.autoRefreshTimer);
                    }
                    
                    localStorage.removeItem('dashboardUser_v49');
                    State.currentUser = null;
                    
                    Utils.showNotification('info', '👋 Logged out successfully');
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                }
            }
        };

        // ===== ENHANCED DATA LOADER MODULE =====
        const DataLoader = {
            init() {
                console.log('📊 Initializing Google Sheets data loading system...');
                this.loadFromGoogleSheets();
            },

            async loadFromGoogleSheets(isAutoRefresh = false) {
                const startTime = performance.now();
                console.log('🔄 Loading data from Google Sheets...', isAutoRefresh ? '(Auto-refresh)' : '(Manual)');
                
                const elements = {
                    dataStatus: document.getElementById('dataStatus'),
                    loadProgress: document.getElementById('loadProgress'),
                    progressBar: document.getElementById('progressBar'),
                    progressText: document.getElementById('progressText'),
                    refreshBtn: document.getElementById('refreshBtn')
                };
                
                if (!isAutoRefresh) {
                    this.updateLoadingUI(elements, 'loading');
                }
                
                try {
                    if (!isAutoRefresh) {
                        this.updateProgress(elements, 20, 'Connecting to Google Sheets API...');
                    }
                    
                    // Get target date from specific cell
                    const targetDateUrl = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${CONFIG.SHEET_NAME}!${CONFIG.TARGET_DATE_CELL}?key=${CONFIG.API_KEY}`;
                    
                    let targetDate = null;
                    try {
                        const targetDateResponse = await fetch(targetDateUrl);
                        if (targetDateResponse.ok) {
                            const targetDateData = await targetDateResponse.json();
                            if (targetDateData.values && targetDateData.values[0] && targetDateData.values[0][0]) {
                                targetDate = targetDateData.values[0][0];
                                console.log('📅 Target date from sheet:', targetDate);
                            }
                        }
                    } catch (error) {
                        console.warn('⚠️ Could not fetch target date:', error.message);
                    }
                    
                    if (!isAutoRefresh) {
                        this.updateProgress(elements, 40, 'Fetching sheet data...');
                    }
                    
                    // Get all data from the sheet
                    const dataUrl = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${CONFIG.SHEET_NAME}?key=${CONFIG.API_KEY}`;
                    
                    const response = await fetch(dataUrl);
                    
                    if (!response.ok) {
                        throw new Error(`Google Sheets API error: ${response.status} ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    
                    if (!data.values || data.values.length === 0) {
                        throw new Error('No data found in Google Sheets');
                    }
                    
                    if (!isAutoRefresh) {
                        this.updateProgress(elements, 70, 'Processing sheet data...');
                    }
                    
                    // Set target date
                    if (targetDate) {
                        State.targetDate = targetDate;
                    } else if (data.values.length > 1 && data.values[1][0]) {
                        State.targetDate = data.values[1][0]; // First data row, first column
                    }
                    
                    if (!isAutoRefresh) {
                        this.updateProgress(elements, 90, 'Formatting data...');
                    }
                    
                    // Process data (skip header row)
                    const processedData = this.processSheetData(data.values);
                    
                    if (processedData.length === 0) {
                        throw new Error('No valid data found in Google Sheets');
                    }
                    
                    // Update performance metrics
                    const loadTime = performance.now() - startTime;
                    State.performance.loadTime = loadTime;
                    State.performance.dataSize = JSON.stringify(data.values).length;
                    
                    console.log(`✅ Successfully loaded ${processedData.length} records from Google Sheets`);
                    this.completeLoading(processedData, elements, isAutoRefresh);
                    
                } catch (error) {
                    console.error('❌ Error loading data from Google Sheets:', error);
                    if (!isAutoRefresh) {
                        this.loadSampleData(elements);
                    } else {
                        Utils.showNotification('error', '⚠️ Auto-refresh failed - using cached data');
                    }
                }
            },

            processSheetData(sheetValues) {
                const processedData = [];
                let validRows = 0;
                let skippedRows = 0;
                
                // Skip header row (index 0)
                for (let i = 1; i < sheetValues.length; i++) {
                    const row = sheetValues[i];
                    
                    // Ensure we have at least 9 columns, pad with empty strings if needed
                    while (row.length < 9) {
                        row.push('');
                    }
                    
                    // Check if required fields exist
                    const hasDate = row[0] && String(row[0]).trim() !== '';
                    const hasProduct = row[1] && String(row[1]).trim() !== '';
                    const hasMC = row[6] && !isNaN(parseFloat(row[6])) && parseFloat(row[6]) > 0;
                    
                    if (hasDate && hasProduct && hasMC) {
                        const formattedRow = [
                            Utils.formatDate(row[0]), // tanggal
                            String(row[1] || '').trim(), // produk
                            String(row[2] || '').trim(), // kemasan
                            String(row[3] || '').trim(), // brand
                            String(row[4] || '').trim(), // kode
                            String(row[5] || '').trim(), // po
                            parseFloat(row[6]) || 0, // mc
                            parseFloat(row[7]) || 0, // kg
                            String(row[8] || '').trim() // lokasi
                        ];
                        processedData.push(formattedRow);
                        validRows++;
                    } else {
                        skippedRows++;
                    }
                }
                
                console.log(`📊 Sheet processing complete: ${validRows} valid rows, ${skippedRows} skipped`);
                return processedData;
            },



            loadSampleData(elements) {
                console.log('📝 Loading sample data...');
                
                const sampleData = [
                    ['29/01/2024', 'PREMIUM RICE', '25 KG', 'BRAND ALPHA', 'PR001', 'PO-2024-001', 150, 3750, 'WAREHOUSE A'],
                    ['29/01/2024', 'SUGAR WHITE', '1 KG', 'BRAND BETA', 'SW002', 'PO-2024-002', 300, 300, 'WAREHOUSE B'],
                    ['30/01/2024', 'COOKING OIL', '2 L', 'BRAND GAMMA', 'CO003', 'PO-2024-003', 200, 400, 'WAREHOUSE A'],
                    ['30/01/2024', 'WHEAT FLOUR', '1 KG', 'BRAND ALPHA', 'WF004', 'PO-2024-001', 400, 400, 'WAREHOUSE C'],
                    ['31/01/2024', 'COFFEE POWDER', '200 G', 'BRAND DELTA', 'CP005', 'PO-2024-004', 120, 24, 'WAREHOUSE B'],
                    ['31/01/2024', 'TEA BAGS', '25 PCS', 'BRAND BETA', 'TB006', 'PO-2024-002', 180, 45, 'WAREHOUSE A'],
                    ['01/02/2024', 'MILK POWDER', '400 G', 'BRAND EPSILON', 'MP007', 'PO-2024-005', 100, 40, 'WAREHOUSE C'],
                    ['01/02/2024', 'BUTTER', '200 G', 'BRAND GAMMA', 'BT008', 'PO-2024-003', 80, 16, 'WAREHOUSE B'],
                    ['02/02/2024', 'CHEESE SLICES', '200 G', 'BRAND ZETA', 'CS009', 'PO-2024-006', 60, 12, 'WAREHOUSE A'],
                    ['02/02/2024', 'BREAD LOAF', '400 G', 'BRAND ETA', 'BL010', 'PO-2024-007', 100, 40, 'WAREHOUSE C']
                ];
                
                State.targetDate = '29/01/2024';
                this.completeLoading(sampleData, elements, false);
            },

            completeLoading(data, elements, isAutoRefresh) {
                const previousDataLength = State.stockData.length;
                State.stockData = [...data];
                State.filteredData = [...State.stockData];
                State.lastUpdate = new Date();
                
                if (!isAutoRefresh) {
                    this.updateProgress(elements, 100, 'Complete!');
                    
                    setTimeout(() => {
                        this.updateLoadingUI(elements, 'complete');
                        UI.updateAll();
                        
                        const message = previousDataLength === 0 
                            ? `✅ Successfully loaded ${State.stockData.length} records!`
                            : `🔄 Data refreshed: ${State.stockData.length} records`;
                        
                        Utils.showNotification('success', message);
                    }, 1000);
                } else {
                    UI.updateAll();
                    
                    if (previousDataLength !== data.length) {
                        Utils.showNotification('info', `🔄 Auto-refresh: ${data.length} records updated`);
                    }
                }
                
                // Update last update time
                Utils.updateLastUpdateTime();
            },

            updateLoadingUI(elements, state) {
                switch (state) {
                    case 'loading':
                        if (elements.dataStatus) {
                            elements.dataStatus.textContent = 'Loading data...';
                            elements.dataStatus.className = 'text-lg font-bold text-blue-600 mb-2';
                        }
                        if (elements.loadProgress) elements.loadProgress.classList.remove('hidden');
                        if (elements.refreshBtn) elements.refreshBtn.disabled = true;
                        if (elements.progressBar) elements.progressBar.style.width = '0%';
                        if (elements.progressText) elements.progressText.textContent = 'Connecting to CDN...';
                        break;
                        
                    case 'complete':
                        if (elements.loadProgress) elements.loadProgress.classList.add('hidden');
                        if (elements.refreshBtn) elements.refreshBtn.disabled = false;
                        if (elements.dataStatus) {
                            elements.dataStatus.textContent = 'System Ready';
                            elements.dataStatus.className = 'text-lg font-bold text-green-600 mb-2';
                        }
                        
                        const dataInfo = document.getElementById('dataInfo');
                        const connectionStatus = document.getElementById('connectionStatus');
                        const connectionText = document.getElementById('connectionText');
                        
                        if (dataInfo) dataInfo.textContent = `${State.stockData.length} records available`;
                        if (connectionStatus) connectionStatus.className = 'w-3 h-3 bg-green-500 rounded-full shadow-sm animate-pulse';
                        if (connectionText) connectionText.textContent = 'Online';
                        break;
                }
            },

            updateProgress(elements, percentage, text) {
                if (elements.progressBar) elements.progressBar.style.width = `${percentage}%`;
                if (elements.progressText) elements.progressText.textContent = text;
            }
        };

        // ===== ENHANCED UI MODULE =====
        const UI = {
            toggleSidebar() {
                const sidebar = document.querySelector('.advanced-sidebar');
                const overlay = document.querySelector('.mobile-overlay');
                
                if (sidebar) sidebar.classList.toggle('open');
                if (overlay) overlay.classList.toggle('hidden');
            },

            closeSidebar() {
                const sidebar = document.querySelector('.advanced-sidebar');
                const overlay = document.querySelector('.mobile-overlay');
                
                if (sidebar) sidebar.classList.remove('open');
                if (overlay) overlay.classList.add('hidden');
            },

            updateAll() {
                if (State.stockData.length === 0) return;
                
                const startTime = performance.now();
                
                this.populateFilters();
                Table.populate();
                this.updateStats();
                Charts.updateAll();
                
                const renderTime = performance.now() - startTime;
                State.performance.renderTime = renderTime;
                
                console.log(`🎨 UI updated in ${renderTime.toFixed(2)}ms`);
            },

            populateFilters() {
                const brands = [...new Set(State.stockData.map(row => row[3]).filter(item => item && item !== '-'))].sort();
                const locations = [...new Set(State.stockData.map(row => row[8]).filter(item => item && item !== '-'))].sort();
                
                const brandFilter = document.getElementById('brandFilter');
                const locationFilter = document.getElementById('locationFilter');
                
                if (brandFilter) {
                    brandFilter.innerHTML = '<option value="">All Brands</option>' + 
                        brands.map(b => `<option value="${b}">${b}</option>`).join('');
                }
                
                if (locationFilter) {
                    locationFilter.innerHTML = '<option value="">All Locations</option>' + 
                        locations.map(l => `<option value="${l}">${l}</option>`).join('');
                }
            },

            updateStats() {
                const totalItems = State.filteredData.reduce((sum, row) => sum + (parseInt(row[6]) || 0), 0);
                const totalKg = State.filteredData.reduce((sum, row) => sum + (parseFloat(row[7]) || 0), 0);
                const uniqueProducts = new Set(State.filteredData.map(row => row[1])).size;
                const uniqueBrands = new Set(State.filteredData.map(row => row[3])).size;
                
                const elements = {
                    totalItems: document.getElementById('totalItems'),
                    totalKg: document.getElementById('totalKg'),
                    uniqueProducts: document.getElementById('uniqueProducts'),
                    uniqueBrands: document.getElementById('uniqueBrands')
                };
                
                // Animate number changes
                if (elements.totalItems) this.animateNumber(elements.totalItems, totalItems);
                if (elements.totalKg) this.animateNumber(elements.totalKg, totalKg, 'kg');
                if (elements.uniqueProducts) this.animateNumber(elements.uniqueProducts, uniqueProducts);
                if (elements.uniqueBrands) this.animateNumber(elements.uniqueBrands, uniqueBrands);
            },

            animateNumber(element, targetValue, suffix = '') {
                const currentValue = parseInt(element.textContent.replace(/[^\d]/g, '')) || 0;
                const increment = (targetValue - currentValue) / 20;
                let current = currentValue;
                
                const timer = setInterval(() => {
                    current += increment;
                    if ((increment > 0 && current >= targetValue) || (increment < 0 && current <= targetValue)) {
                        current = targetValue;
                        clearInterval(timer);
                    }
                    
                    const displayValue = Math.round(current).toLocaleString();
                    element.textContent = suffix ? `${displayValue} ${suffix}` : displayValue;
                }, 50);
            },

            showQuickActions() {
                // Implementation for floating action button
                const actions = [
                    { icon: 'fas fa-file-pdf', text: 'Export PDF', action: () => Export.toPDF() },
                    { icon: 'fas fa-chart-bar', text: 'Analytics', action: () => Navigation.showSection('analytics') },
                    { icon: 'fas fa-calendar-alt', text: 'Data Summary', action: () => Navigation.showSection('data-entry-summary') }
                ];
                
                // Show quick actions menu (implementation would create a popup menu)
                console.log('Quick actions:', actions);
            }
        };

        // ===== ENHANCED TABLE MODULE =====
        const Table = {
            populate() {
                const tbody = document.getElementById('stockTableBody');
                const mobileTable = document.getElementById('mobileStockTable');
                
                const start = (State.currentPage - 1) * State.itemsPerPage;
                const end = Math.min(start + State.itemsPerPage, State.filteredData.length);
                const pageData = State.filteredData.slice(start, end);
                
                // Desktop table
                if (tbody) {
                    tbody.innerHTML = pageData.map((row, index) => `
                        <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                            <td class="px-8 py-6 text-sm font-bold text-gray-900">${row[0]}</td>
                            <td class="px-8 py-6 text-sm font-black text-gray-900">${row[1]}</td>
                            <td class="px-8 py-6 text-sm text-gray-700 font-semibold">${row[2]}</td>
                            <td class="px-8 py-6 text-sm">
                                <span class="badge-advanced badge-primary">${row[3]}</span>
                            </td>
                            <td class="px-8 py-6 text-sm text-gray-900 font-mono font-bold">${row[4]}</td>
                            <td class="px-8 py-6 text-sm text-gray-900 font-mono font-bold">${row[5]}</td>
                            <td class="px-8 py-6 text-sm text-blue-600 text-right font-black text-lg">${row[6].toLocaleString()}</td>
                            <td class="px-8 py-6 text-sm text-green-600 text-right font-black text-lg">${row[7].toLocaleString()} kg</td>
                            <td class="px-8 py-6 text-sm text-gray-900">
                                <span class="badge-advanced badge-success">${row[8] || '-'}</span>
                            </td>
                        </tr>
                    `).join('');
                }
                
                // Mobile table
                if (mobileTable) {
                    mobileTable.innerHTML = pageData.map((row, index) => `
                        <div class="mobile-table-card animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                            <div class="mobile-table-header">${row[1]}</div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Date</span>
                                <span class="mobile-table-value">${row[0]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Brand</span>
                                <span class="mobile-table-value">
                                    <span class="badge-advanced badge-primary text-xs">${row[3]}</span>
                                </span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Packaging</span>
                                <span class="mobile-table-value">${row[2]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Code</span>
                                <span class="mobile-table-value font-mono">${row[4]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">PO Number</span>
                                <span class="mobile-table-value font-mono">${row[5]}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">MC Qty</span>
                                <span class="mobile-table-value text-blue-600 font-black">${row[6].toLocaleString()}</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Weight</span>
                                <span class="mobile-table-value text-green-600 font-black">${row[7].toLocaleString()} kg</span>
                            </div>
                            <div class="mobile-table-row">
                                <span class="mobile-table-label">Location</span>
                                <span class="mobile-table-value">
                                    <span class="badge-advanced badge-success text-xs">${row[8] || '-'}</span>
                                </span>
                            </div>
                        </div>
                    `).join('');
                }
                
                this.updatePagination();
            },

            updatePagination() {
                const total = State.filteredData.length;
                const start = (State.currentPage - 1) * State.itemsPerPage + 1;
                const end = Math.min(State.currentPage * State.itemsPerPage, total);
                const maxPages = Math.ceil(total / State.itemsPerPage);
                
                // Desktop pagination elements
                const elements = {
                    showingStart: document.getElementById('showingStart'),
                    showingEnd: document.getElementById('showingEnd'),
                    totalRecords: document.getElementById('totalRecords'),
                    pageInfo: document.getElementById('pageInfo'),
                    firstBtn: document.getElementById('firstBtn'),
                    prevBtn: document.getElementById('prevBtn'),
                    nextBtn: document.getElementById('nextBtn'),
                    lastBtn: document.getElementById('lastBtn')
                };
                
                // Mobile pagination elements
                const mobileElements = {
                    showingStart: document.getElementById('showingStartMobile'),
                    showingEnd: document.getElementById('showingEndMobile'),
                    totalRecords: document.getElementById('totalRecordsMobile'),
                    pageInfo: document.getElementById('pageInfoMobile'),
                    firstBtn: document.getElementById('firstBtnMobile'),
                    prevBtn: document.getElementById('prevBtnMobile'),
                    nextBtn: document.getElementById('nextBtnMobile'),
                    lastBtn: document.getElementById('lastBtnMobile')
                };
                
                // Update both desktop and mobile pagination
                [elements, mobileElements].forEach(elemSet => {
                    if (elemSet.showingStart) elemSet.showingStart.textContent = total > 0 ? start : 0;
                    if (elemSet.showingEnd) elemSet.showingEnd.textContent = end;
                    if (elemSet.totalRecords) elemSet.totalRecords.textContent = total.toLocaleString();
                    if (elemSet.pageInfo) elemSet.pageInfo.textContent = `${State.currentPage} / ${maxPages}`;
                    
                    if (elemSet.firstBtn) elemSet.firstBtn.disabled = State.currentPage <= 1;
                    if (elemSet.prevBtn) elemSet.prevBtn.disabled = State.currentPage <= 1;
                    if (elemSet.nextBtn) elemSet.nextBtn.disabled = State.currentPage >= maxPages;
                    if (elemSet.lastBtn) elemSet.lastBtn.disabled = State.currentPage >= maxPages;
                });
            },

            sort(columnIndex) {
                if (State.sortColumn === columnIndex) {
                    State.sortDirection = State.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    State.sortColumn = columnIndex;
                    State.sortDirection = 'asc';
                }
                
                State.filteredData.sort((a, b) => {
                    let aVal = a[columnIndex];
                    let bVal = b[columnIndex];
                    
                    // Handle numeric columns
                    if (columnIndex === 6 || columnIndex === 7) {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    }
                    
                    // Handle date columns
                    if (columnIndex === 0) {
                        aVal = Utils.parseDate(aVal);
                        bVal = Utils.parseDate(bVal);
                    }
                    
                    if (aVal < bVal) return State.sortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return State.sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
                
                State.currentPage = 1;
                this.populate();
            },

            changeItemsPerPage() {
                const select = document.getElementById('itemsPerPage');
                const mobileSelect = document.getElementById('itemsPerPageMobile');
                
                if (select) {
                    State.itemsPerPage = parseInt(select.value);
                    State.currentPage = 1;
                    this.populate();
                }
                
                if (mobileSelect) {
                    State.itemsPerPage = parseInt(mobileSelect.value);
                    State.currentPage = 1;
                    this.populate();
                }
            },

            firstPage() {
                State.currentPage = 1;
                this.populate();
            },

            previousPage() {
                if (State.currentPage > 1) {
                    State.currentPage--;
                    this.populate();
                }
            },

            nextPage() {
                const maxPages = Math.ceil(State.filteredData.length / State.itemsPerPage);
                if (State.currentPage < maxPages) {
                    State.currentPage++;
                    this.populate();
                }
            },

            lastPage() {
                const maxPages = Math.ceil(State.filteredData.length / State.itemsPerPage);
                State.currentPage = maxPages;
                this.populate();
            }
        };

        // ===== ENHANCED SMART SEARCH MODULE =====
        const SmartSearch = {
            searchCache: new Map(),
            
            performSearch() {
                const searchTerm = document.getElementById('searchProduct')?.value?.toLowerCase() || '';
                const searchResults = document.getElementById('searchResults');
                
                if (searchTerm.length < 2) {
                    if (searchResults) {
                        searchResults.classList.remove('show');
                        searchResults.innerHTML = '';
                    }
                    return;
                }
                
                // Check cache first
                if (this.searchCache.has(searchTerm)) {
                    this.displaySearchResults(this.searchCache.get(searchTerm), searchResults);
                    return;
                }
                
                // Perform search
                const results = State.stockData.filter(row => {
                    return row[1].toLowerCase().includes(searchTerm) || // Product
                           row[3].toLowerCase().includes(searchTerm) || // Brand
                           row[2].toLowerCase().includes(searchTerm) || // Packaging
                           row[4].toLowerCase().includes(searchTerm) || // Code
                           row[5].toLowerCase().includes(searchTerm);   // PO Number
                }).slice(0, 8); // Limit to 8 results
                
                // Cache results
                this.searchCache.set(searchTerm, results);
                
                this.displaySearchResults(results, searchResults);
            },
            
            displaySearchResults(results, container) {
                if (!container) return;
                
                if (results.length === 0) {
                    container.innerHTML = '<div class="search-item text-gray-500">No results found</div>';
                    container.classList.add('show');
                    return;
                }
                
                container.innerHTML = results.map(row => `
                    <div class="search-item" onclick="SmartSearch.selectResult('${row[1]}', '${row[3]}', '${row[5]}')">
                        <div class="font-bold text-gray-800">${row[1]}</div>
                        <div class="text-sm text-gray-600">
                            <span class="badge-advanced badge-primary text-xs mr-2">${row[3]}</span>
                            <span class="badge-advanced badge-success text-xs mr-2">PO: ${row[5]}</span>
                            <span class="text-blue-600 font-bold">${row[6]} MC</span> | 
                            <span class="text-green-600 font-bold">${row[7]} kg</span>
                        </div>
                    </div>
                `).join('');
                
                container.classList.add('show');
            },
            
            selectResult(product, brand, po) {
                const searchInput = document.getElementById('searchProduct');
                const brandFilter = document.getElementById('brandFilter');
                const searchResults = document.getElementById('searchResults');
                
                if (searchInput) searchInput.value = product;
                if (brandFilter) brandFilter.value = brand;
                if (searchResults) searchResults.classList.remove('show');
                
                // Apply the filter
                Filters.apply();
            },
            
            applySorting() {
                const sortBy = document.getElementById('sortBy')?.value;
                if (!sortBy) return;
                
                const [column, direction] = sortBy.split('-');
                
                State.filteredData.sort((a, b) => {
                    let aVal, bVal;
                    
                    switch (column) {
                        case 'date':
                            aVal = Utils.parseDate(a[0]);
                            bVal = Utils.parseDate(b[0]);
                            break;
                        case 'product':
                            aVal = a[1].toLowerCase();
                            bVal = b[1].toLowerCase();
                            break;
                        case 'brand':
                            aVal = a[3].toLowerCase();
                            bVal = b[3].toLowerCase();
                            break;
                        case 'mc':
                            aVal = parseInt(a[6]) || 0;
                            bVal = parseInt(b[6]) || 0;
                            break;
                        case 'kg':
                            aVal = parseFloat(a[7]) || 0;
                            bVal = parseFloat(b[7]) || 0;
                            break;
                        case 'po':
                            aVal = a[5].toLowerCase();
                            bVal = b[5].toLowerCase();
                            break;
                        default:
                            aVal = a[0];
                            bVal = b[0];
                    }
                    
                    if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                    return 0;
                });
                
                State.currentPage = 1;
                Table.populate();
                
                Utils.showNotification('success', `📊 Data sorted by ${column} (${direction === 'asc' ? 'ascending' : 'descending'})`);
            },
            

        };

        // ===== ENHANCED FILTERS MODULE =====
        const Filters = {
            apply() {
                const startDate = document.getElementById('startDate')?.value;
                const endDate = document.getElementById('endDate')?.value;
                const brand = document.getElementById('brandFilter')?.value;
                const location = document.getElementById('locationFilter')?.value;
                const searchTerm = document.getElementById('searchProduct')?.value?.toLowerCase() || '';
                
                // Update state
                State.filters = { startDate, endDate, brand, location, search: searchTerm };
                
                State.filteredData = State.stockData.filter(row => {
                    const matchesBrand = !brand || row[3] === brand;
                    const matchesLocation = !location || row[8] === location;
                    const matchesSearch = !searchTerm || 
                        row[1].toLowerCase().includes(searchTerm) ||
                        row[3].toLowerCase().includes(searchTerm) ||
                        row[2].toLowerCase().includes(searchTerm) ||
                        row[4].toLowerCase().includes(searchTerm) ||
                        row[5].toLowerCase().includes(searchTerm); // Added PO search
                    
                    let matchesDateRange = true;
                    if (startDate || endDate) {
                        const rowDate = Utils.parseDate(row[0]);
                        if (startDate) {
                            const start = new Date(startDate);
                            matchesDateRange = matchesDateRange && rowDate >= start;
                        }
                        if (endDate) {
                            const end = new Date(endDate);
                            matchesDateRange = matchesDateRange && rowDate <= end;
                        }
                    }
                    
                    return matchesBrand && matchesLocation && matchesSearch && matchesDateRange;
                });
                
                State.currentPage = 1;
                
                // Apply current sorting
                const sortBy = document.getElementById('sortBy')?.value;
                if (sortBy) {
                    SmartSearch.applySorting();
                } else {
                    UI.updateAll();
                }
                
                Utils.showNotification('success', `🔍 Filter applied: ${State.filteredData.length} records found`);
            },

            reset() {
                const elements = {
                    startDate: document.getElementById('startDate'),
                    endDate: document.getElementById('endDate'),
                    brandFilter: document.getElementById('brandFilter'),
                    locationFilter: document.getElementById('locationFilter'),
                    searchProduct: document.getElementById('searchProduct'),
                    sortBy: document.getElementById('sortBy')
                };
                
                Object.values(elements).forEach(el => {
                    if (el) {
                        if (el.tagName === 'SELECT') {
                            el.selectedIndex = 0;
                        } else {
                            el.value = '';
                        }
                    }
                });
                
                // Clear search results
                const searchResults = document.getElementById('searchResults');
                if (searchResults) {
                    searchResults.classList.remove('show');
                    searchResults.innerHTML = '';
                }
                
                State.filters = { startDate: '', endDate: '', brand: '', location: '', search: '' };
                State.filteredData = [...State.stockData];
                State.currentPage = 1;
                UI.updateAll();
                
                Utils.showNotification('info', '🔄 Filters reset - showing all data');
            }
        };

        // ===== ENHANCED NAVIGATION MODULE =====
        const Navigation = {
            showSection(sectionName) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show target section
                const targetSection = document.getElementById(sectionName + '-section');
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    targetSection.classList.add('animate-fadeIn');
                }
                
                // Update sidebar active state
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (event && event.target) {
                    const sidebarItem = event.target.closest('.sidebar-item');
                    if (sidebarItem) {
                        sidebarItem.classList.add('active');
                    }
                }
                
                // Close mobile sidebar
                if (window.innerWidth <= 768) {
                    UI.closeSidebar();
                }
                
                // Update section-specific content
                setTimeout(() => {
                    switch (sectionName) {
                        case 'analytics':
                            Charts.updateAll();
                            break;
                        case 'rekap-po':
                            Recap.updatePOSection();
                            break;
                        case 'rekap-brand':
                            Recap.updateBrandSection();
                            break;
                        case 'rekap-lokasi':
                            Recap.updateLocationSection();
                            break;
                        case 'code-breakdown':
                            CodeBreakdown.updateSection();
                            break;
                        case 'data-entry-summary':
                            Charts.updateDateSummaryChart();
                            break;
                        case 'real-time':
                            Recap.updateRealTimeSection();
                            break;
                    }
                }, 300);
            }
        };

        // ===== RECAP MODULES =====
        const Recap = {
            updatePOSection() {
                if (!State.stockData.length) return;
                
                // Calculate PO statistics
                const poData = {};
                State.stockData.forEach(row => {
                    const po = row[5];
                    const date = row[0];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (po && po !== '-') {
                        if (!poData[po]) {
                            poData[po] = { date, items: 0, mc: 0, kg: 0 };
                        }
                        poData[po].items++;
                        poData[po].mc += mc;
                        poData[po].kg += kg;
                    }
                });
                
                const totalPOs = Object.keys(poData).length;
                const activePOs = totalPOs; // All POs are considered active
                const totalMC = Object.values(poData).reduce((sum, po) => sum + po.mc, 0);
                const totalKg = Object.values(poData).reduce((sum, po) => sum + po.kg, 0);
                
                // Update stats
                UI.animateNumber(document.getElementById('totalPOs'), totalPOs);
                UI.animateNumber(document.getElementById('activePOs'), activePOs);
                UI.animateNumber(document.getElementById('poTotalMC'), totalMC);
                UI.animateNumber(document.getElementById('poTotalKg'), totalKg, 'kg');
                
                // Update PO table
                const tbody = document.getElementById('poTableBody');
                if (tbody) {
                    tbody.innerHTML = Object.entries(poData)
                        .sort(([,a], [,b]) => b.kg - a.kg)
                        .slice(0, 20)
                        .map(([po, data], index) => `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-mono font-bold text-blue-600">${po}</td>
                                <td class="px-8 py-6 text-sm font-bold text-gray-900">${data.date}</td>
                                <td class="px-8 py-6 text-sm text-gray-700 text-right font-semibold">${data.items}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black">${data.mc.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-green-600 text-right font-black">${data.kg.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm">
                                    <span class="badge-advanced badge-success">Active</span>
                                </td>
                            </tr>
                        `).join('');
                }
            },

            updateBrandSection() {
                if (!State.stockData.length) return;
                
                // Calculate brand statistics
                const brandData = {};
                State.stockData.forEach(row => {
                    const brand = row[3];
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (brand && brand !== '-') {
                        if (!brandData[brand]) {
                            brandData[brand] = { products: new Set(), mc: 0, kg: 0 };
                        }
                        brandData[brand].products.add(product);
                        brandData[brand].mc += mc;
                        brandData[brand].kg += kg;
                    }
                });
                
                const totalBrands = Object.keys(brandData).length;
                const sortedBrands = Object.entries(brandData).sort(([,a], [,b]) => b.kg - a.kg);
                const topBrand = sortedBrands.length > 0 ? sortedBrands[0][0] : '-';
                const avgMC = totalBrands > 0 ? Math.round(Object.values(brandData).reduce((sum, b) => sum + b.mc, 0) / totalBrands) : 0;
                const avgKg = totalBrands > 0 ? Math.round(Object.values(brandData).reduce((sum, b) => sum + b.kg, 0) / totalBrands) : 0;
                
                // Update stats
                UI.animateNumber(document.getElementById('totalBrands'), totalBrands);
                document.getElementById('topBrand').textContent = topBrand;
                UI.animateNumber(document.getElementById('brandTotalMC'), avgMC);
                UI.animateNumber(document.getElementById('brandTotalKg'), avgKg, 'kg');
                
                // Update top brands list
                const topBrandsList = document.getElementById('topBrandsList');
                if (topBrandsList) {
                    const totalWeight = Object.values(brandData).reduce((sum, b) => sum + b.kg, 0);
                    topBrandsList.innerHTML = sortedBrands.slice(0, 8).map(([brand, data], index) => {
                        const percentage = ((data.kg / totalWeight) * 100).toFixed(1);
                        return `
                            <div class="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl animate-slideInRight" style="animation-delay: ${index * 0.1}s">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center mr-4 text-white font-bold">
                                        ${index + 1}
                                    </div>
                                    <div>
                                        <div class="font-bold text-gray-800">${brand}</div>
                                        <div class="text-sm text-gray-600">${data.products.size} products</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-black text-purple-600">${data.kg.toLocaleString()} kg</div>
                                    <div class="text-sm text-gray-500">${percentage}%</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // Update brand table
                const tbody = document.getElementById('brandTableBody');
                if (tbody) {
                    const totalWeight = Object.values(brandData).reduce((sum, b) => sum + b.kg, 0);
                    tbody.innerHTML = sortedBrands.map(([brand, data], index) => {
                        const marketShare = ((data.kg / totalWeight) * 100).toFixed(1);
                        const performance = data.kg > avgKg ? 'High' : data.kg > avgKg * 0.5 ? 'Medium' : 'Low';
                        const performanceClass = performance === 'High' ? 'badge-success' : performance === 'Medium' ? 'badge-warning' : 'badge-danger';
                        
                        return `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-black text-gray-900">${brand}</td>
                                <td class="px-8 py-6 text-sm text-gray-700 text-right font-semibold">${data.products.size}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black">${data.mc.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-green-600 text-right font-black">${data.kg.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm text-purple-600 text-right font-black">${marketShare}%</td>
                                <td class="px-8 py-6 text-sm">
                                    <span class="badge-advanced ${performanceClass}">${performance}</span>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Update brand distribution chart
                this.updateBrandChart(brandData);
            },

            updateLocationSection() {
                if (!State.stockData.length) return;
                
                // Calculate location statistics
                const locationData = {};
                State.stockData.forEach(row => {
                    const location = row[8];
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (location && location !== '-') {
                        if (!locationData[location]) {
                            locationData[location] = { products: new Set(), mc: 0, kg: 0 };
                        }
                        locationData[location].products.add(product);
                        locationData[location].mc += mc;
                        locationData[location].kg += kg;
                    }
                });
                
                const totalLocations = Object.keys(locationData).length;
                const sortedLocations = Object.entries(locationData).sort(([,a], [,b]) => b.kg - a.kg);
                const busyLocation = sortedLocations.length > 0 ? sortedLocations[0][0] : '-';
                const avgMC = totalLocations > 0 ? Math.round(Object.values(locationData).reduce((sum, l) => sum + l.mc, 0) / totalLocations) : 0;
                const avgKg = totalLocations > 0 ? Math.round(Object.values(locationData).reduce((sum, l) => sum + l.kg, 0) / totalLocations) : 0;
                
                // Update stats
                UI.animateNumber(document.getElementById('totalLocations'), totalLocations);
                document.getElementById('busyLocation').textContent = busyLocation;
                UI.animateNumber(document.getElementById('locationTotalMC'), avgMC);
                UI.animateNumber(document.getElementById('locationTotalKg'), avgKg, 'kg');
                
                // Update warehouse capacity
                const warehouseCapacity = document.getElementById('warehouseCapacity');
                if (warehouseCapacity) {
                    const maxCapacity = 10000; // Assumed max capacity per warehouse
                    warehouseCapacity.innerHTML = sortedLocations.slice(0, 6).map(([location, data], index) => {
                        const utilization = Math.min((data.kg / maxCapacity) * 100, 100);
                        const utilizationClass = utilization > 80 ? 'bg-red-500' : utilization > 60 ? 'bg-yellow-500' : 'bg-green-500';
                        
                        return `
                            <div class="animate-slideInRight" style="animation-delay: ${index * 0.1}s">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-bold text-gray-800">${location}</span>
                                    <span class="text-sm font-semibold text-gray-600">${utilization.toFixed(1)}%</span>
                                </div>
                                <div class="progress-advanced mb-2">
                                    <div class="progress-bar-advanced ${utilizationClass}" style="width: ${utilization}%"></div>
                                </div>
                                <div class="text-xs text-gray-500 font-medium">${data.kg.toLocaleString()} kg / ${maxCapacity.toLocaleString()} kg</div>
                            </div>
                        `;
                    }).join('');
                }
                
                // Update location table
                const tbody = document.getElementById('locationTableBody');
                if (tbody) {
                    const maxCapacity = 10000;
                    tbody.innerHTML = sortedLocations.map(([location, data], index) => {
                        const utilization = Math.min((data.kg / maxCapacity) * 100, 100);
                        const status = utilization > 80 ? 'High' : utilization > 60 ? 'Medium' : 'Normal';
                        const statusClass = status === 'High' ? 'badge-danger' : status === 'Medium' ? 'badge-warning' : 'badge-success';
                        
                        return `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-black text-gray-900">${location}</td>
                                <td class="px-8 py-6 text-sm text-gray-700 text-right font-semibold">${data.products.size}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black">${data.mc.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-green-600 text-right font-black">${data.kg.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm text-purple-600 text-right font-black">${utilization.toFixed(1)}%</td>
                                <td class="px-8 py-6 text-sm">
                                    <span class="badge-advanced ${statusClass}">${status}</span>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Update location chart
                this.updateLocationChart(locationData);
            },

            updateRealTimeSection() {
                // Update real-time metrics
                const dataAge = State.lastUpdate ? Math.floor((new Date() - State.lastUpdate) / 1000) : 0;
                const loadTime = State.performance.loadTime ? `${State.performance.loadTime.toFixed(0)}ms` : '-';
                const memoryUsage = 'memory' in performance ? `${(performance.memory.usedJSHeapSize / 1048576).toFixed(1)}MB` : '-';
                
                document.getElementById('dataFreshness').textContent = dataAge < 60 ? `${dataAge}s` : `${Math.floor(dataAge / 60)}m`;
                document.getElementById('loadTime').textContent = loadTime;
                document.getElementById('memoryUsage').textContent = memoryUsage;
                
                // Update system logs
                this.updateSystemLogs();
                
                // Update performance charts
                this.updatePerformanceCharts();
            },

            updateBrandChart(brandData) {
                const ctx = document.getElementById('brandDistributionChart');
                if (!ctx || !brandData) return;
                
                if (State.charts.brandDistribution) {
                    State.charts.brandDistribution.destroy();
                }
                
                const sortedBrands = Object.entries(brandData).sort(([,a], [,b]) => b.kg - a.kg).slice(0, 8);
                const brands = sortedBrands.map(([brand]) => brand);
                const values = sortedBrands.map(([,data]) => data.kg);
                
                State.charts.brandDistribution = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: brands,
                        datasets: [{
                            data: values,
                            backgroundColor: [
                                '#8B5CF6', '#EC4899', '#F59E0B', '#10B981',
                                '#3B82F6', '#EF4444', '#06B6D4', '#84CC16'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            },

            updateLocationChart(locationData) {
                const ctx = document.getElementById('locationChart');
                if (!ctx || !locationData) return;
                
                if (State.charts.locationChart) {
                    State.charts.locationChart.destroy();
                }
                
                const sortedLocations = Object.entries(locationData).sort(([,a], [,b]) => b.kg - a.kg);
                const locations = sortedLocations.map(([location]) => location);
                const values = sortedLocations.map(([,data]) => data.kg);
                
                State.charts.locationChart = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: locations,
                        datasets: [{
                            label: 'Weight (kg)',
                            data: values,
                            backgroundColor: '#10B981',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            },

            updateSystemLogs() {
                const logsContainer = document.getElementById('systemLogs');
                if (!logsContainer) return;
                
                const logs = [
                    `[${new Date().toLocaleTimeString()}] INFO: Dashboard v49 running normally`,
                    `[${new Date().toLocaleTimeString()}] DATA: ${State.stockData.length} records loaded`,
                    `[${new Date().toLocaleTimeString()}] PERF: Load time ${State.performance.loadTime?.toFixed(0) || 0}ms`,
                    `[${new Date().toLocaleTimeString()}] USER: ${State.currentUser?.name || 'Unknown'} active`,
                    `[${new Date().toLocaleTimeString()}] CONN: CDN connection stable`,
                    `[${new Date().toLocaleTimeString()}] CACHE: Data cached successfully`,
                    `[${new Date().toLocaleTimeString()}] UI: All components rendered`,
                    `[${new Date().toLocaleTimeString()}] AUTH: Session valid`
                ];
                
                logsContainer.innerHTML = logs.map(log => `
                    <div class="text-green-400 mb-1 animate-fadeIn">${log}</div>
                `).join('');
                
                logsContainer.scrollTop = logsContainer.scrollHeight;
            },

            updatePerformanceCharts() {
                // Performance chart implementation would go here
                // This is a placeholder for the actual chart updates
                console.log('📊 Performance charts updated');
            }
        };

        // ===== ENHANCED CHARTS MODULE =====
        const Charts = {
            init() {
                this.initBrandChart();
                this.initTrendChart();
                this.initDateSummaryChart();
            },

            initBrandChart() {
                const ctx = document.getElementById('brandChart');
                if (!ctx) return;
                
                State.charts.brand = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6',
                                '#06B6D4', '#84CC16', '#F97316', '#EC4899', '#6366F1'
                            ],
                            borderWidth: 0,
                            hoverBorderWidth: 3,
                            hoverBorderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: { weight: 'bold' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value.toLocaleString()} kg (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            duration: 1000
                        }
                    }
                });
            },

            initTrendChart() {
                const ctx = document.getElementById('trendChart');
                if (!ctx) return;
                
                State.charts.trend = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Total Stock (kg)',
                            data: [],
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: '#3B82F6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + ' kg';
                                    },
                                    font: { weight: 'bold' }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    font: { weight: 'bold' }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    font: { weight: 'bold' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} kg`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            },

            initDateSummaryChart() {
                const ctx = document.getElementById('dateSummaryChart');
                if (!ctx) return;
                
                State.charts.dateSummary = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Total MC',
                            data: [],
                            backgroundColor: '#3B82F6',
                            borderRadius: 8,
                            yAxisID: 'y'
                        }, {
                            label: 'Total Weight (kg)',
                            data: [],
                            backgroundColor: '#10B981',
                            borderRadius: 8,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Total MC',
                                    font: { weight: 'bold' }
                                },
                                ticks: {
                                    font: { weight: 'bold' }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Total Weight (kg)',
                                    font: { weight: 'bold' }
                                },
                                ticks: {
                                    font: { weight: 'bold' }
                                },
                                grid: {
                                    drawOnChartArea: false,
                                }
                            },
                            x: {
                                ticks: {
                                    font: { weight: 'bold' }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    font: { weight: 'bold' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.dataset.label;
                                        const value = context.parsed.y;
                                        return `${label}: ${value.toLocaleString()}${label.includes('Weight') ? ' kg' : ''}`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            },

            updateAll() {
                this.updateBrandChart();
                this.updateTrendChart();
                this.updateDateSummaryChart();
            },

            updateBrandChart() {
                if (!State.charts.brand || !State.filteredData.length) return;
                
                const brandData = {};
                State.filteredData.forEach(row => {
                    const brand = row[3];
                    const kg = parseFloat(row[7]) || 0;
                    brandData[brand] = (brandData[brand] || 0) + kg;
                });
                
                const sortedBrands = Object.entries(brandData)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 8);
                
                const brands = sortedBrands.map(([brand]) => brand);
                const values = sortedBrands.map(([,value]) => value);
                
                State.charts.brand.data.labels = brands;
                State.charts.brand.data.datasets[0].data = values;
                State.charts.brand.update('active');
            },

            updateTrendChart() {
                if (!State.charts.trend || !State.filteredData.length) return;
                
                const dailyData = {};
                State.filteredData.forEach(row => {
                    const date = row[0];
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (date && date !== '-') {
                        if (!dailyData[date]) dailyData[date] = 0;
                        dailyData[date] += kg;
                    }
                });
                
                const sortedDates = Object.keys(dailyData).sort((a, b) => {
                    return Utils.parseDate(a) - Utils.parseDate(b);
                });
                
                const last10Days = sortedDates.slice(-10);
                const labels = last10Days.length > 0 ? last10Days : ['Today'];
                const data = last10Days.length > 0 ? last10Days.map(date => dailyData[date]) : [0];
                
                State.charts.trend.data.labels = labels;
                State.charts.trend.data.datasets[0].data = data;
                State.charts.trend.update('active');
            },

            updateDateSummaryChart() {
                if (!State.charts.dateSummary || !State.filteredData.length) return;
                
                const dailyData = {};
                State.filteredData.forEach(row => {
                    const date = row[0];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (date && date !== '-') {
                        if (!dailyData[date]) {
                            dailyData[date] = { mc: 0, kg: 0, entries: 0 };
                        }
                        dailyData[date].mc += mc;
                        dailyData[date].kg += kg;
                        dailyData[date].entries += 1;
                    }
                });
                
                const sortedDates = Object.keys(dailyData).sort((a, b) => {
                    return Utils.parseDate(a) - Utils.parseDate(b);
                });
                
                const labels = sortedDates;
                const mcData = sortedDates.map(date => dailyData[date].mc);
                const kgData = sortedDates.map(date => dailyData[date].kg);
                
                State.charts.dateSummary.data.labels = labels;
                State.charts.dateSummary.data.datasets[0].data = mcData;
                State.charts.dateSummary.data.datasets[1].data = kgData;
                State.charts.dateSummary.update('active');
                
                // Update date summary list
                this.updateDateSummaryList(dailyData, sortedDates);
            },

            updateDateSummaryList(dailyData, sortedDates) {
                const listContainer = document.getElementById('dateSummaryList');
                if (!listContainer) return;
                
                listContainer.innerHTML = sortedDates.map((date, index) => {
                    const data = dailyData[date];
                    return `
                        <div class="flex items-center justify-between p-4 bg-white rounded-xl shadow-sm animate-slideInRight" style="animation-delay: ${index * 0.05}s">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-green-500 rounded-xl flex items-center justify-center mr-4 text-white font-bold text-sm">
                                    ${date.split('/')[0]}
                                </div>
                                <div>
                                    <div class="font-bold text-gray-800">${date}</div>
                                    <div class="text-sm text-gray-600">${data.entries} entries</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-black text-blue-600">${data.mc.toLocaleString()} MC</div>
                                <div class="font-bold text-green-600">${data.kg.toLocaleString()} kg</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        };

        // ===== CODE BREAKDOWN MODULE =====
        const CodeBreakdown = {
            filteredCodes: [],
            currentPage: 1,
            itemsPerPage: 10,
            sortColumn: 'code',
            sortDirection: 'asc',

            updateSection() {
                if (!State.stockData.length) return;
                
                this.processCodeData();
                this.updateStats();
                this.populateFilters();
                this.populateTable();
            },

            processCodeData() {
                // Group data by Brand first
                const brandGroups = {};
                
                State.stockData.forEach(row => {
                    const code = row[4]; // Product code
                    const brand = row[3]; // Brand
                    const product = row[1]; // Product name
                    const packaging = row[2]; // Packaging
                    const po = row[5]; // PO Number
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    const date = row[0]; // Date
                    
                    if (brand && brand !== '-' && code && code !== '-') {
                        if (!brandGroups[brand]) {
                            brandGroups[brand] = {
                                brand: brand,
                                po: po,
                                products: {},
                                totalMC: 0,
                                totalKG: 0,
                                productCount: 0
                            };
                        }
                        
                        // Group products within each Brand
                        if (!brandGroups[brand].products[code]) {
                            brandGroups[brand].products[code] = {
                                code: code,
                                brand: brand,
                                product: product,
                                packaging: packaging,
                                po: po,
                                mc: 0,
                                kg: 0,
                                breakdown: `${brand} : ${product} : ${packaging} : ${code}`
                            };
                            brandGroups[brand].productCount++;
                        }
                        
                        brandGroups[brand].products[code].mc += mc;
                        brandGroups[brand].products[code].kg += kg;
                        brandGroups[brand].totalMC += mc;
                        brandGroups[brand].totalKG += kg;
                    }
                });
                
                // Convert to array format for display
                this.filteredCodes = Object.values(brandGroups);
                this.sortCodes();
            },

            updateStats() {
                const totalBrands = this.filteredCodes.length;
                const totalProducts = this.filteredCodes.reduce((sum, brand) => sum + brand.productCount, 0);
                const totalMC = this.filteredCodes.reduce((sum, brand) => sum + brand.totalMC, 0);
                const totalKg = this.filteredCodes.reduce((sum, brand) => sum + brand.totalKG, 0);
                
                // Get unique products from all brands
                const uniqueProducts = new Set();
                this.filteredCodes.forEach(brand => {
                    Object.values(brand.products).forEach(product => {
                        uniqueProducts.add(product.product);
                    });
                });
                
                UI.animateNumber(document.getElementById('totalCodes'), totalBrands);
                UI.animateNumber(document.getElementById('uniqueCodeBrands'), uniqueProducts.size);
                UI.animateNumber(document.getElementById('codeTotalMC'), totalMC);
                UI.animateNumber(document.getElementById('codeTotalKg'), totalKg, 'kg');
            },

            populateFilters() {
                // Get brands from original stock data
                const brands = [...new Set(State.stockData.map(row => row[3]).filter(b => b && b !== '-'))].sort();
                
                // Get PO numbers from original stock data
                const pos = [...new Set(State.stockData.map(row => row[5]).filter(p => p && p !== '-'))].sort();
                
                const brandFilter = document.getElementById('codeFilterBrand');
                const poFilter = document.getElementById('codeFilterPO');
                
                if (brandFilter) {
                    brandFilter.innerHTML = '<option value="">All Brands</option>' + 
                        brands.map(b => `<option value="${b}">${b}</option>`).join('');
                }
                
                if (poFilter) {
                    poFilter.innerHTML = '<option value="">All PO Numbers</option>' + 
                        pos.map(p => `<option value="${p}">${p}</option>`).join('');
                }
                
                console.log(`🔍 Code filters populated: ${brands.length} brands, ${pos.length} PO numbers`);
            },

            searchCodes() {
                const searchTerm = document.getElementById('codeSearch')?.value?.toLowerCase() || '';
                const brandFilter = document.getElementById('codeFilterBrand')?.value || '';
                const poFilter = document.getElementById('codeFilterPO')?.value || '';
                
                console.log(`🔍 Filtering Brands: search="${searchTerm}", brand="${brandFilter}", po="${poFilter}"`);
                
                // Start with fresh data from stock
                let filteredStock = State.stockData;
                
                // Apply brand filter first
                if (brandFilter) {
                    filteredStock = filteredStock.filter(row => row[3] === brandFilter);
                }
                
                // Apply PO filter
                if (poFilter) {
                    filteredStock = filteredStock.filter(row => row[5] === poFilter);
                }
                
                // Group data by Brand
                const brandGroups = {};
                
                filteredStock.forEach(row => {
                    const code = row[4]; // Product code
                    const brand = row[3]; // Brand
                    const product = row[1]; // Product name
                    const packaging = row[2]; // Packaging
                    const po = row[5]; // PO Number
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    const date = row[0]; // Date
                    
                    if (brand && brand !== '-' && code && code !== '-') {
                        if (!brandGroups[brand]) {
                            brandGroups[brand] = {
                                brand: brand,
                                po: po,
                                products: {},
                                totalMC: 0,
                                totalKG: 0,
                                productCount: 0
                            };
                        }
                        
                        // Group products within each Brand
                        if (!brandGroups[brand].products[code]) {
                            brandGroups[brand].products[code] = {
                                code: code,
                                brand: brand,
                                product: product,
                                packaging: packaging,
                                po: po,
                                mc: 0,
                                kg: 0,
                                breakdown: `${brand} : ${product} : ${packaging} : ${code}`
                            };
                            brandGroups[brand].productCount++;
                        }
                        
                        brandGroups[brand].products[code].mc += mc;
                        brandGroups[brand].products[code].kg += kg;
                        brandGroups[brand].totalMC += mc;
                        brandGroups[brand].totalKG += kg;
                    }
                });
                
                // Convert to array
                this.filteredCodes = Object.values(brandGroups);
                
                // Apply search term filter
                if (searchTerm) {
                    this.filteredCodes = this.filteredCodes.filter(brandGroup => {
                        // Search in brand name
                        if (brandGroup.brand.toLowerCase().includes(searchTerm)) return true;
                        
                        // Search in any product within the brand
                        return Object.values(brandGroup.products).some(product => {
                            return product.code.toLowerCase().includes(searchTerm) ||
                                   product.product.toLowerCase().includes(searchTerm) ||
                                   product.packaging.toLowerCase().includes(searchTerm) ||
                                   product.po.toLowerCase().includes(searchTerm);
                        });
                    });
                }
                
                this.sortCodes();
                this.currentPage = 1;
                this.updateStats();
                this.populateTable();
                
                console.log(`✅ Brand filtering complete: ${this.filteredCodes.length} brands found`);
            },

            filterCodes() {
                this.searchCodes(); // Use same logic as search
            },

            sortCodes() {
                this.filteredCodes.sort((a, b) => {
                    let aVal, bVal;
                    
                    switch (this.sortColumn) {
                        case 'brand':
                            aVal = a.brand;
                            bVal = b.brand;
                            break;
                        case 'po':
                            aVal = a.po;
                            bVal = b.po;
                            break;
                        case 'mc':
                            aVal = a.totalMC;
                            bVal = b.totalMC;
                            break;
                        case 'kg':
                            aVal = a.totalKG;
                            bVal = b.totalKG;
                            break;
                        case 'products':
                            aVal = a.productCount;
                            bVal = b.productCount;
                            break;
                        default:
                            aVal = a.brand;
                            bVal = b.brand;
                    }
                    
                    if (this.sortColumn === 'mc' || this.sortColumn === 'kg' || this.sortColumn === 'products') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    } else {
                        aVal = String(aVal).toLowerCase();
                        bVal = String(bVal).toLowerCase();
                    }
                    
                    if (aVal < bVal) return this.sortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return this.sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            },



            sortTable(column) {
                if (this.sortColumn === column) {
                    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    this.sortColumn = column;
                    this.sortDirection = 'asc';
                }
                
                this.filteredCodes.sort((a, b) => {
                    let aVal = a[column];
                    let bVal = b[column];
                    
                    if (column === 'mc' || column === 'kg') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    } else {
                        aVal = String(aVal).toLowerCase();
                        bVal = String(bVal).toLowerCase();
                    }
                    
                    if (aVal < bVal) return this.sortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return this.sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
                
                this.populateTable();
            },

            populateTable() {
                const tbody = document.getElementById('codeTableBody');
                const mobileTable = document.getElementById('mobileCodeTable');
                
                const start = (this.currentPage - 1) * this.itemsPerPage;
                const end = Math.min(start + this.itemsPerPage, this.filteredCodes.length);
                const pageData = this.filteredCodes.slice(start, end);
                
                // Desktop table - now showing Brand groups
                if (tbody) {
                    tbody.innerHTML = pageData.map((brandGroup, index) => {
                        const productDetails = Object.values(brandGroup.products).map(product => 
                            `<div class="mb-2 p-2 bg-white rounded-lg border border-gray-200">
                                <div class="font-mono font-bold text-indigo-600 mb-1">${product.code}</div>
                                <div class="text-xs text-gray-600">
                                    <span class="badge-advanced badge-success text-xs mr-1">${product.po}</span>
                                    ${product.product} | ${product.packaging}
                                </div>
                                <div class="text-xs text-gray-700 mt-1">
                                    <span class="font-bold text-purple-600">${product.mc.toLocaleString()} MC</span> | 
                                    <span class="font-bold text-emerald-600">${product.kg.toLocaleString()} kg</span>
                                </div>
                            </div>`
                        ).join('');
                        
                        return `
                            <tr class="table-row animate-slideInUp" style="animation-delay: ${index * 0.05}s">
                                <td class="px-8 py-6 text-sm font-black text-indigo-600">${brandGroup.brand}</td>
                                <td class="px-8 py-6 text-sm font-mono font-bold text-gray-900">${brandGroup.po}</td>
                                <td class="px-8 py-6 text-sm text-blue-600 text-right font-black text-lg">${brandGroup.productCount}</td>
                                <td class="px-8 py-6 text-sm text-purple-600 text-right font-black text-lg">${brandGroup.totalMC.toLocaleString()}</td>
                                <td class="px-8 py-6 text-sm text-emerald-600 text-right font-black text-lg">${brandGroup.totalKG.toLocaleString()} kg</td>
                                <td class="px-8 py-6 text-sm">
                                    <div class="bg-gradient-to-r from-indigo-50 to-cyan-50 p-3 rounded-xl max-w-md max-h-64 overflow-y-auto">
                                        <div class="text-xs font-bold text-gray-600 mb-2">Products in this Brand:</div>
                                        ${productDetails}
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Mobile table - now showing Brand groups
                if (mobileTable) {
                    mobileTable.innerHTML = pageData.map((brandGroup, index) => {
                        const productList = Object.values(brandGroup.products).map(product => 
                            `<div class="flex items-center justify-between p-2 bg-white rounded-lg shadow-sm mb-2">
                                <div>
                                    <div class="font-mono font-bold text-indigo-600">${product.code}</div>
                                    <div class="text-xs text-gray-600">
                                        <span class="badge-advanced badge-success text-xs">${product.po}</span>
                                    </div>
                                    <div class="text-xs text-gray-700">${product.product} | ${product.packaging}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-purple-600">${product.mc.toLocaleString()} MC</div>
                                    <div class="font-bold text-emerald-600">${product.kg.toLocaleString()} kg</div>
                                </div>
                            </div>`
                        ).join('');
                        
                        return `
                            <div class="mobile-table-card animate-slideInUp border-l-4 border-indigo-500" style="animation-delay: ${index * 0.05}s">
                                <!-- Brand Header -->
                                <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-3 rounded-lg mb-4">
                                    <div class="text-xs font-bold text-gray-600 mb-2 uppercase tracking-wide">Brand Summary</div>
                                    <div class="grid grid-cols-2 gap-2 text-sm">
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">Brand Name:</span>
                                            <div class="font-black text-indigo-600">${brandGroup.brand}</div>
                                        </div>
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">PO Number:</span>
                                            <div class="font-mono font-bold text-gray-800">${brandGroup.po}</div>
                                        </div>
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">Products:</span>
                                            <div class="font-bold text-blue-600">${brandGroup.productCount} items</div>
                                        </div>
                                        <div>
                                            <span class="text-xs text-gray-500 font-semibold">Total:</span>
                                            <div class="font-bold text-purple-600">${brandGroup.totalMC.toLocaleString()} MC</div>
                                            <div class="font-bold text-emerald-600">${brandGroup.totalKG.toLocaleString()} kg</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Product Details -->
                                <div class="bg-gradient-to-r from-gray-50 to-blue-50 p-3 rounded-lg">
                                    <div class="text-xs font-bold text-gray-600 mb-3 uppercase tracking-wide">Product Details</div>
                                    <div class="max-h-64 overflow-y-auto">
                                        ${productList}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                this.updatePagination();
            },

            updatePagination() {
                const total = this.filteredCodes.length;
                const start = (this.currentPage - 1) * this.itemsPerPage + 1;
                const end = Math.min(this.currentPage * this.itemsPerPage, total);
                const maxPages = Math.ceil(total / this.itemsPerPage);
                
                const elements = {
                    showingStart: document.getElementById('codeShowingStart'),
                    showingEnd: document.getElementById('codeShowingEnd'),
                    totalRecords: document.getElementById('codeTotalRecords'),
                    pageInfo: document.getElementById('codePageInfo'),
                    firstBtn: document.getElementById('codeFirstBtn'),
                    prevBtn: document.getElementById('codePrevBtn'),
                    nextBtn: document.getElementById('codeNextBtn'),
                    lastBtn: document.getElementById('codeLastBtn')
                };
                
                if (elements.showingStart) elements.showingStart.textContent = total > 0 ? start : 0;
                if (elements.showingEnd) elements.showingEnd.textContent = end;
                if (elements.totalRecords) elements.totalRecords.textContent = total.toLocaleString();
                if (elements.pageInfo) elements.pageInfo.textContent = `${this.currentPage} / ${maxPages}`;
                
                if (elements.firstBtn) elements.firstBtn.disabled = this.currentPage <= 1;
                if (elements.prevBtn) elements.prevBtn.disabled = this.currentPage <= 1;
                if (elements.nextBtn) elements.nextBtn.disabled = this.currentPage >= maxPages;
                if (elements.lastBtn) elements.lastBtn.disabled = this.currentPage >= maxPages;
            },

            resetFilters() {
                const elements = {
                    codeSearch: document.getElementById('codeSearch'),
                    codeFilterBrand: document.getElementById('codeFilterBrand'),
                    codeFilterPO: document.getElementById('codeFilterPO')
                };
                
                Object.values(elements).forEach(el => {
                    if (el) el.value = el.tagName === 'SELECT' ? el.options[0].value : '';
                });
                
                this.currentPage = 1;
                this.updateSection();
                
                Utils.showNotification('info', '🔄 Code filters reset');
            },

            exportToPDF() {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('landscape');
                    
                    // Header
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text('Brand Breakdown Report - Dashboard v49', 20, 20);
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Generated: ${new Date().toLocaleString('id-ID')}`, 20, 30);
                    doc.text(`Total Brands: ${this.filteredCodes.length}`, 20, 35);
                    doc.text(`User: ${State.currentUser?.name || 'Unknown'}`, 20, 40);
                    
                    // Summary stats
                    const totalMC = this.filteredCodes.reduce((sum, brand) => sum + brand.totalMC, 0);
                    const totalKg = this.filteredCodes.reduce((sum, brand) => sum + brand.totalKG, 0);
                    const totalProducts = this.filteredCodes.reduce((sum, brand) => sum + brand.productCount, 0);
                    
                    doc.text(`Total MC: ${totalMC.toLocaleString()}`, 150, 30);
                    doc.text(`Total Weight: ${totalKg.toLocaleString()} kg`, 150, 35);
                    doc.text(`Total Products: ${totalProducts}`, 150, 40);
                    
                    // Table data - Brand summary
                    const tableData = this.filteredCodes.map(brandGroup => [
                        brandGroup.brand, brandGroup.po, brandGroup.productCount.toString(),
                        brandGroup.totalMC.toLocaleString(), brandGroup.totalKG.toLocaleString() + ' kg'
                    ]);
                    
                    doc.autoTable({
                        head: [['Brand Name', 'PO Number', 'Products', 'Total MC', 'Total Weight']],
                        body: tableData,
                        startY: 50,
                        styles: { 
                            fontSize: 10,
                            cellPadding: 4
                        },
                        headStyles: { 
                            fillColor: [79, 70, 229],
                            textColor: 255,
                            fontStyle: 'bold'
                        },
                        alternateRowStyles: {
                            fillColor: [245, 247, 250]
                        }
                    });
                    
                    // Add detailed breakdown for each Brand
                    let currentY = doc.lastAutoTable.finalY + 20;
                    
                    this.filteredCodes.forEach((brandGroup, index) => {
                        if (currentY > 180) { // Start new page if needed
                            doc.addPage();
                            currentY = 20;
                        }
                        
                        // Brand Header
                        doc.setFontSize(14);
                        doc.setFont(undefined, 'bold');
                        doc.text(`Brand: ${brandGroup.brand} (PO: ${brandGroup.po})`, 20, currentY);
                        currentY += 10;
                        
                        // Product details table
                        const productData = Object.values(brandGroup.products).map(product => [
                            product.code, product.po, product.product, product.packaging,
                            product.mc.toLocaleString(), product.kg.toLocaleString() + ' kg'
                        ]);
                        
                        doc.autoTable({
                            head: [['Code', 'PO Number', 'Product', 'Packaging', 'MC', 'Weight']],
                            body: productData,
                            startY: currentY,
                            styles: { 
                                fontSize: 8,
                                cellPadding: 2
                            },
                            headStyles: { 
                                fillColor: [99, 102, 241],
                                textColor: 255,
                                fontStyle: 'bold'
                            },
                            margin: { left: 30, right: 30 }
                        });
                        
                        currentY = doc.lastAutoTable.finalY + 15;
                    });
                    
                    // Footer
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10);
                        doc.text('Brand Breakdown Report - Dashboard v49', 20, doc.internal.pageSize.height - 10);
                    }
                    
                    doc.save(`brand-breakdown-${new Date().toISOString().split('T')[0]}.pdf`);
                    Utils.showNotification('success', '✅ Brand breakdown PDF exported successfully!');
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    Utils.showNotification('error', '❌ Failed to generate PDF report');
                }
            },

            changeItemsPerPage() {
                const select = document.getElementById('codeItemsPerPage');
                if (select) {
                    this.itemsPerPage = parseInt(select.value);
                    this.currentPage = 1;
                    this.populateTable();
                }
            },

            firstPage() {
                this.currentPage = 1;
                this.populateTable();
            },

            previousPage() {
                if (this.currentPage > 1) {
                    this.currentPage--;
                    this.populateTable();
                }
            },

            nextPage() {
                const maxPages = Math.ceil(this.filteredCodes.length / this.itemsPerPage);
                if (this.currentPage < maxPages) {
                    this.currentPage++;
                    this.populateTable();
                }
            },

            lastPage() {
                const maxPages = Math.ceil(this.filteredCodes.length / this.itemsPerPage);
                this.currentPage = maxPages;
                this.populateTable();
            }
        };

        // ===== ENHANCED EXPORT MODULE =====
        const Export = {
            toPDF() {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('landscape');
                    
                    // Header
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text('Dashboard Stok Produk v49 - Advanced Report', 20, 20);
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Generated: ${new Date().toLocaleString('id-ID')}`, 20, 30);
                    doc.text(`Total Records: ${State.filteredData.length}`, 20, 35);
                    doc.text(`User: ${State.currentUser?.name || 'Unknown'}`, 20, 40);
                    
                    // Summary stats
                    const totalMC = State.filteredData.reduce((sum, row) => sum + (parseInt(row[6]) || 0), 0);
                    const totalKg = State.filteredData.reduce((sum, row) => sum + (parseFloat(row[7]) || 0), 0);
                    
                    doc.text(`Total MC: ${totalMC.toLocaleString()}`, 150, 30);
                    doc.text(`Total Weight: ${totalKg.toLocaleString()} kg`, 150, 35);
                    
                    // Table data
                    const tableData = State.filteredData.map(row => [
                        row[0], row[1], row[2], row[3], row[4], row[5], 
                        row[6].toLocaleString(), row[7].toLocaleString() + ' kg', row[8]
                    ]);
                    
                    doc.autoTable({
                        head: [['Date', 'Product', 'Packaging', 'Brand', 'Code', 'PO Number', 'MC Qty', 'Weight', 'Location']],
                        body: tableData,
                        startY: 50,
                        styles: { 
                            fontSize: 8,
                            cellPadding: 3
                        },
                        headStyles: { 
                            fillColor: [59, 130, 246],
                            textColor: 255,
                            fontStyle: 'bold'
                        },
                        alternateRowStyles: {
                            fillColor: [245, 247, 250]
                        }
                    });
                    
                    // Footer
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10);
                        doc.text('Dashboard v49 - Advanced Stock Management System', 20, doc.internal.pageSize.height - 10);
                    }
                    
                    doc.save(`dashboard-v49-report-${new Date().toISOString().split('T')[0]}.pdf`);
                    Utils.showNotification('success', '✅ PDF report generated successfully!');
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    Utils.showNotification('error', '❌ Failed to generate PDF report');
                }
            },

            toExcel() {
                try {
                    const wb = XLSX.utils.book_new();
                    
                    // Main data sheet
                    const wsData = [
                        ['Date', 'Product', 'Packaging', 'Brand', 'Code', 'PO Number', 'MC Qty', 'Weight (kg)', 'Location'],
                        ...State.filteredData
                    ];
                    
                    const ws = XLSX.utils.aoa_to_sheet(wsData);
                    
                    // Set column widths
                    ws['!cols'] = [
                        { wch: 12 }, { wch: 25 }, { wch: 15 }, { wch: 15 },
                        { wch: 12 }, { wch: 15 }, { wch: 10 }, { wch: 12 }, { wch: 15 }
                    ];
                    
                    XLSX.utils.book_append_sheet(wb, ws, 'Stock Data');
                    
                    // Summary sheet
                    const brandSummary = {};
                    State.filteredData.forEach(row => {
                        const brand = row[3];
                        if (!brandSummary[brand]) {
                            brandSummary[brand] = { mc: 0, kg: 0 };
                        }
                        brandSummary[brand].mc += parseInt(row[6]) || 0;
                        brandSummary[brand].kg += parseFloat(row[7]) || 0;
                    });
                    
                    const summaryData = [
                        ['Brand', 'Total MC', 'Total Weight (kg)'],
                        ...Object.entries(brandSummary).map(([brand, data]) => [
                            brand, data.mc, data.kg
                        ])
                    ];
                    
                    const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
                    XLSX.utils.book_append_sheet(wb, wsSummary, 'Brand Summary');
                    
                    XLSX.writeFile(wb, `dashboard-v49-export-${new Date().toISOString().split('T')[0]}.xlsx`);
                    Utils.showNotification('success', '✅ Excel file exported successfully!');
                    
                } catch (error) {
                    console.error('Error generating Excel:', error);
                    Utils.showNotification('error', '❌ Failed to generate Excel file');
                }
            }
        };

        // ===== ENHANCED UTILITIES MODULE =====
        const Utils = {
            formatDate(dateValue) {
                if (!dateValue) return '';
                
                if (typeof dateValue === 'string' && dateValue.includes('/')) {
                    return dateValue;
                }
                
                if (typeof dateValue === 'number') {
                    const date = XLSX.SSF.parse_date_code(dateValue);
                    if (date) {
                        const day = String(date.d).padStart(2, '0');
                        const month = String(date.m).padStart(2, '0');
                        const year = date.y;
                        return `${day}/${month}/${year}`;
                    }
                }
                
                try {
                    const date = new Date(dateValue);
                    if (!isNaN(date.getTime())) {
                        const day = String(date.getDate()).padStart(2, '0');
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const year = date.getFullYear();
                        return `${day}/${month}/${year}`;
                    }
                } catch (e) {
                    console.warn('Date parsing error:', e);
                }
                
                return String(dateValue);
            },

            parseDate(dateString) {
                if (!dateString) return new Date(0);
                
                if (dateString.includes('/')) {
                    const [day, month, year] = dateString.split('/');
                    return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                }
                
                return new Date(dateString);
            },

            showNotification(type, message) {
                // Notifications disabled
                console.log(`${type.toUpperCase()}: ${message}`);
            },

            setCurrentTime() {
                const updateTime = () => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('id-ID');
                    
                    const timeElements = document.querySelectorAll('#currentTime');
                    timeElements.forEach(el => {
                        if (el) el.textContent = timeString;
                    });
                };
                
                updateTime();
                setInterval(updateTime, 1000);
            },



            generateSessionId() {
                return 'sess_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
            },

            updateLastUpdateTime() {
                const lastUpdateElement = document.getElementById('lastUpdateTime');
                if (lastUpdateElement && State.targetDate) {
                    lastUpdateElement.textContent = `Target Date: ${State.targetDate}`;
                }
            }
        };

        // ===== PERFORMANCE MONITORING MODULE =====
        const Performance = {
            startTracking() {
                console.log('📊 Performance tracking started');
                
                // Monitor memory usage
                if ('memory' in performance) {
                    setInterval(() => {
                        const memory = performance.memory;
                        console.log(`Memory: ${(memory.usedJSHeapSize / 1048576).toFixed(2)}MB used`);
                    }, 60000); // Every minute
                }
                
                // Monitor page load performance
                window.addEventListener('load', () => {
                    setTimeout(() => {
                        const perfData = performance.getEntriesByType('navigation')[0];
                        console.log(`Page load: ${perfData.loadEventEnd - perfData.fetchStart}ms`);
                    }, 0);
                });
            }
        };

        // ===== GLOBAL FUNCTIONS =====
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('passwordToggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye';
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log(`🚀 Initializing Dashboard v${CONFIG.VERSION} - Advanced Stock Management System`);
            console.log('Features enabled:', CONFIG.FEATURES);
            
            Auth.init();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'e':
                            e.preventDefault();
                            Export.toPDF();
                            break;
                        case 'f':
                            e.preventDefault();
                            const searchInput = document.getElementById('searchProduct');
                            if (searchInput) searchInput.focus();
                            break;
                    }
                }
                
                // Close search results on Escape
                if (e.key === 'Escape') {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults) {
                        searchResults.classList.remove('show');
                    }
                }
            });
            
            // Close search results when clicking outside
            document.addEventListener('click', (e) => {
                const searchContainer = document.querySelector('.search-container');
                const searchResults = document.getElementById('searchResults');
                
                if (searchResults && !searchContainer?.contains(e.target)) {
                    searchResults.classList.remove('show');
                }
            });
            
            console.log('✅ Dashboard v49 initialization complete');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96921e4cb44db5ac',t:'MTc1NDE4NTM0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
