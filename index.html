<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Stok Produk v3 - CDN Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * { box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        /* Sidebar Enhancements */
        .sidebar { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sidebar-item { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-item:hover { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .sidebar-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
        }
        
        /* Card Enhancements */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.8) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        /* Table Enhancements */
        .table-row { 
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .table-row:hover { 
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.05) 0%, rgba(255, 255, 255, 0.8) 100%);
            border-left-color: #667eea;
            transform: translateX(2px);
        }
        
        /* Button Enhancements */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        /* Loading Animation */
        .loading-spinner { 
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Badge Enhancements */
        .badge {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.2) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .badge-green {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.2) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .badge-purple {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .badge-orange {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.2) 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        /* Input Enhancements */
        .form-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .form-input:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* Progress Bar */
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0 !important; }
            .mobile-overlay { 
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.6); z-index: 15; display: none;
                backdrop-filter: blur(4px);
            }
            .mobile-overlay.show { display: block; }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="glass-card rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 fade-in-up">
            <div class="text-center mb-6">
                <div class="mx-auto w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mb-4 shadow-xl transform hover:scale-105 transition-transform">
                    <div class="text-white text-3xl">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm5-18v4h3V3h-3z"/>
                        </svg>
                    </div>
                </div>
                <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Dashboard v3</h2>
                <p class="text-gray-600 mt-2 font-medium">Masukkan kredensial untuk mengakses dashboard</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
                    <div class="relative">
                        <input type="text" id="username" required 
                               class="form-input w-full px-4 py-3 pl-12 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Masukkan username" autocomplete="username">
                        <i class="fas fa-user absolute left-4 top-4 text-blue-500"></i>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="password" required 
                               class="form-input w-full px-4 py-3 pl-12 pr-12 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Masukkan password" autocomplete="current-password">
                        <i class="fas fa-lock absolute left-4 top-4 text-blue-500"></i>
                        <button type="button" onclick="togglePassword()" class="absolute right-4 top-4 text-gray-400 hover:text-blue-500 transition-colors">
                            <i id="passwordToggle" class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div id="loginError" class="hidden bg-red-50 border border-red-200 rounded-lg p-3">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
                        <span class="text-red-700 text-sm">Username atau password salah!</span>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary w-full text-white font-semibold py-4 px-6 rounded-xl transition-all flex items-center justify-center shadow-lg">
                    <span id="loginButtonText">
                        <i class="fas fa-sign-in-alt mr-2"></i>Masuk Dashboard
                    </span>
                    <div id="loginSpinner" class="hidden">
                        <div class="loading-spinner w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"></div>
                        Memverifikasi...
                    </div>
                </button>
            </form>
            
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="glass-card rounded-xl p-4">
                    <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-users text-blue-500 mr-2"></i>Demo Akun
                    </h4>
                    <div class="text-xs text-gray-600 space-y-2">
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg">
                            <span class="font-medium">Admin:</span>
                            <span class="font-mono text-blue-600">admin / admin123</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg">
                            <span class="font-medium">Manager:</span>
                            <span class="font-mono text-blue-600">manager / manager123</span>
                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg">
                            <span class="font-medium">Staff:</span>
                            <span class="font-mono text-blue-600">staff / staff123</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Header -->
    <div class="md:hidden glass-card shadow-lg px-4 py-4 flex items-center justify-between">
        <button onclick="toggleSidebar()" class="text-blue-600 hover:text-purple-600 transition-colors">
            <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="flex items-center">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mr-2 shadow-md">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm5-18v4h3V3h-3z"/>
                </svg>
            </div>
            <h1 class="text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Dashboard v3</h1>
        </div>
        <div class="w-6"></div>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-20">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mr-3 shadow-lg">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm5-18v4h3V3h-3z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Dashboard v3</h1>
                        <p class="text-xs text-gray-500 mt-1 font-medium">CDN Data System</p>
                    </div>
                </div>
                <button onclick="closeSidebar()" class="md:hidden text-gray-600 hover:text-purple-600 transition-colors">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
        </div>
        
        <!-- User Info -->
        <div id="userInfo" class="px-4 py-4 border-b border-gray-200 hidden">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3 shadow-md">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-gray-800" id="userName">-</div>
                        <div class="text-xs text-gray-500 capitalize font-medium" id="userRole">-</div>
                    </div>
                </div>
                <button onclick="logout()" class="text-gray-400 hover:text-red-500 transition-colors p-2 rounded-lg hover:bg-red-50" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <nav class="mt-6 px-4 space-y-3">
            <a href="#" class="sidebar-item active flex items-center px-4 py-3 text-white rounded-xl font-medium shadow-lg" onclick="showSection('dashboard')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm5-18v4h3V3h-3z"/>
                    </svg>
                </div>
                Dashboard Stok
            </a>
            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-gray-700 rounded-xl font-medium hover:text-white" onclick="showSection('rekap-po')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 4H4c-1.11 0-2 .89-2 2v3h2V6h4V4zm6 0v2h4v3h2V6c0-1.11-.89-2-2-2h-4zm-6 15H4v-3H2v3c0 1.11.89 2 2 2h4v-2zm6 0v2h4c1.11 0 2-.89 2-2v-3h-2v3h-4z"/>
                    </svg>
                </div>
                Rekap per PO
            </a>
            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-gray-700 rounded-xl font-medium hover:text-white" onclick="showSection('rekap-brand')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M5.5 7A1.5 1.5 0 004 5.5 1.5 1.5 0 005.5 4 1.5 1.5 0 007 5.5 1.5 1.5 0 005.5 7zm15.91 4.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42z"/>
                    </svg>
                </div>
                Rekap per Brand
            </a>
            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-gray-700 rounded-xl font-medium hover:text-white" onclick="showSection('rekap-lokasi')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                </div>
                Rekap per Lokasi
            </a>
            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-gray-700 rounded-xl font-medium hover:text-white" onclick="showSection('rekap-kode')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 5v14h18V5H3zm2 2h14v10H5V7zm2 2v6h2V9H7zm4 0v6h2V9h-2zm4 0v6h2V9h-2z"/>
                    </svg>
                </div>
                Rekap per Kode
            </a>
            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-gray-700 rounded-xl font-medium hover:text-white" onclick="showSection('kode-per-size-brand')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                Kode per Size Packing Brand
            </a>
            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-gray-700 rounded-xl font-medium hover:text-white" onclick="showSection('stok-hari-ini')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                    </svg>
                </div>
                Stok Tanggal Target
            </a>
            <a href="#" class="sidebar-item flex items-center px-4 py-3 text-gray-700 rounded-xl font-medium hover:text-white" onclick="showSection('grafik')">
                <div class="w-6 h-6 mr-3 flex items-center justify-center">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z"/>
                    </svg>
                </div>
                Grafik Ringkas
            </a>
        </nav>
        
        <div class="absolute bottom-4 left-4 right-4">
            <div class="glass-card p-4 rounded-xl">
                <p class="text-sm font-semibold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">📊 Dashboard v3</p>
                <p class="text-xs text-gray-600 mt-1 font-medium" id="dataInfo">Data siap digunakan</p>
                <div class="flex items-center mt-3">
                    <div id="connectionStatus" class="w-3 h-3 bg-green-500 rounded-full mr-2 shadow-sm"></div>
                    <span class="text-xs text-gray-600 font-medium" id="connectionText">Siap</span>
                </div>
                <div class="text-xs text-gray-500 mt-2 flex items-center">
                    <i class="fas fa-sync-alt mr-1"></i>
                    Auto-refresh: 5 menit
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content ml-64 p-4 md:p-6 pt-20 md:pt-6 min-h-screen">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section fade-in-up">
            <div class="mb-8">
                <h2 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3">📊 Dashboard Stok Produk</h2>
                <p class="text-gray-600 text-lg font-medium">Kelola dan pantau stok produk dari CDN repository</p>
            </div>

            <!-- Data Status Info -->
            <div class="glass-card p-6 rounded-2xl shadow-lg mb-8">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mr-4 shadow-lg">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4zM4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4zm0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">Status Data</h3>
                            <p class="text-sm text-gray-600 font-medium">Dashboard Stok Produk v3</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="dataStatus" class="text-sm font-semibold text-blue-600 mb-2">Memuat data...</div>
                        <button onclick="loadDataFromCDN()" id="loadDataBtn"
                                class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium shadow-md">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                </div>
                
                <div id="loadProgress" class="hidden mt-4">
                    <div class="bg-gray-200 rounded-full h-3 shadow-inner">
                        <div id="progressBar" class="progress-bar h-3 rounded-full transition-all duration-300 shadow-sm" style="width: 0%"></div>
                    </div>
                    <div class="text-sm text-gray-600 mt-2 font-medium" id="progressText">Memuat data...</div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-blue-600" id="totalItems">-</div>
                            <div class="text-sm text-gray-600 font-medium mt-1">Total MC</div>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#2563eb">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-green-600" id="totalKg">-</div>
                            <div class="text-sm text-gray-600 font-medium mt-1">Total Kg</div>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#16a34a">
                                <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm-1.5 4c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5S9 9.33 9 8.5 9.67 7 10.5 7zm3 0c.83 0 1.5.67 1.5 1.5S14.33 10 13.5 10 12 9.33 12 8.5 12.67 7 13.5 7zM12 17.5c-2.33 0-4.31-1.46-5.11-3.5h10.22c-.8 2.04-2.78 3.5-5.11 3.5z"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-purple-600" id="uniqueProducts">-</div>
                            <div class="text-sm text-gray-600 font-medium mt-1">Produk</div>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#9333ea">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="stat-card p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-3xl font-bold text-orange-600" id="uniqueBrands">-</div>
                            <div class="text-sm text-gray-600 font-medium mt-1">Brand</div>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#ea580c">
                                <path d="M5.5 7A1.5 1.5 0 004 5.5 1.5 1.5 0 005.5 4 1.5 1.5 0 007 5.5 1.5 1.5 0 005.5 7zm15.91 4.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="glass-card p-6 rounded-2xl shadow-lg mb-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Tanggal Mulai</label>
                        <input type="date" id="startDate" class="form-input w-full px-4 py-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Tanggal Akhir</label>
                        <input type="date" id="endDate" class="form-input w-full px-4 py-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Brand</label>
                        <select id="brandFilter" class="form-input w-full px-4 py-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Semua Brand</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Cari Produk/Brand/Packing</label>
                        <div class="relative">
                            <input type="text" id="searchProduct" placeholder="Ketik nama produk, brand, atau packing..." class="form-input w-full px-4 py-3 pl-12 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <svg class="absolute left-4 top-4 text-blue-500" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Lokasi</label>
                        <select id="locationFilter" class="form-input w-full px-4 py-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Semua Lokasi</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-3">
                    <button onclick="applyFilters()" class="btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg flex items-center">
                        <svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                        </svg>
                        Filter
                    </button>
                    <button onclick="resetFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl flex items-center">
                        <svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>
                        </svg>
                        Reset
                    </button>
                    <button onclick="exportToPDF()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl flex items-center">
                        <svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                        </svg>
                        Export PDF
                    </button>

                </div>
            </div>

            <!-- Data Table -->
            <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gradient-to-r from-blue-50 to-purple-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(0)">
                                    Tanggal 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(1)">
                                    Produk 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(2)">
                                    Packing 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(3)">
                                    Brand 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(4)">
                                    Kode 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(5)">
                                    No. PO 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(6)">
                                    Jumlah mc 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(7)">
                                    Jumlah Kg 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase cursor-pointer hover:bg-blue-100 transition-colors" onclick="sortTable(8)">
                                    Lokasi 
                                    <svg class="inline ml-1 text-blue-500" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody" class="divide-y divide-gray-100">
                            <!-- Data populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-4 flex items-center justify-between border-t border-gray-200">
                    <div class="text-sm text-gray-700 font-medium">
                        Menampilkan <span id="showingStart" class="font-bold text-blue-600">0</span> - <span id="showingEnd" class="font-bold text-blue-600">0</span> dari <span id="totalRecords" class="font-bold text-blue-600">0</span>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="previousPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-medium" id="prevBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="#2563eb">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                            </svg>
                        </button>
                        <span id="pageInfo" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-bold shadow-md">1</span>
                        <button onclick="nextPage()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 transition-colors shadow-sm font-medium" id="nextBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="#2563eb">
                                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rekap per PO Section -->
        <div id="rekap-po-section" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">📁 Rekap per PO</h2>
                    <p class="text-gray-600 mt-1">Total <span id="totalPOCount" class="font-semibold text-blue-600">0</span> PO ditemukan</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Menampilkan</div>
                    <div class="text-lg font-bold text-green-600" id="displayedPOCount">0</div>
                    <div class="text-sm text-gray-500">PO teratas</div>
                </div>
            </div>
            
            <!-- PO Statistics -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-blue-600" id="totalPOItems">0</div>
                    <div class="text-sm text-gray-600">Total MC</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-green-600" id="totalPOKg">0</div>
                    <div class="text-sm text-gray-600">Total Kg</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-purple-600" id="avgItemsPerPO">0</div>
                    <div class="text-sm text-gray-600">Rata-rata MC/PO</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <input type="text" id="poSearchInput" placeholder="Cari PO..." class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" onkeyup="filterPOSummary()">
                    <div class="text-xs text-gray-600 mt-1">Kolom Cari</div>
                </div>
            </div>

            <!-- Top 4 Products -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">🏆 Top 4 Produk Terbanyak</h3>
                <div id="poTop4" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Top 4 products will be populated by JavaScript -->
                </div>
            </div>

            <!-- Show All POs Button -->
            <div class="mb-4">
                <button id="showAllPOsBtn" onclick="toggleShowAllPOs()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-eye mr-2"></i>Tampilkan Semua PO
                </button>
                <span class="ml-3 text-sm text-gray-500" id="poDisplayInfo">Menampilkan 6 PO teratas</span>
            </div>
            
            <div id="poSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- PO cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Rekap per Brand Section -->
        <div id="rekap-brand-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">🏷️ Rekap per Brand</h2>
                <p class="text-gray-600">Ringkasan stok berdasarkan brand produk</p>
            </div>
            
            <!-- Brand Statistics -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-blue-600" id="totalBrandItems">0</div>
                    <div class="text-sm text-gray-600">Total MC</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-green-600" id="totalBrandKg">0</div>
                    <div class="text-sm text-gray-600">Total Kg</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-purple-600" id="totalBrandCount">0</div>
                    <div class="text-sm text-gray-600">Total Brand</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <div class="text-2xl font-bold text-orange-600" id="avgKgPerBrand">0</div>
                    <div class="text-sm text-gray-600">Rata-rata Kg/Brand</div>
                </div>
            </div>

            <!-- Top 4 Products -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">🏆 Top 4 Produk Terbanyak</h3>
                <div id="brandTop4" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Top 4 products will be populated by JavaScript -->
                </div>
            </div>
            
            <div id="brandSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Brand cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Rekap per Lokasi Section -->
        <div id="rekap-lokasi-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">📍 Rekap per Lokasi</h2>
                <p class="text-gray-600">Ringkasan stok berdasarkan lokasi gudang</p>
            </div>

            <!-- Top 4 Products -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">🏆 Top 4 Produk Terbanyak</h3>
                <div id="locationTop4" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Top 4 products will be populated by JavaScript -->
                </div>
            </div>
            
            <div id="locationSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Location cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Rekap per Kode Section -->
        <div id="rekap-kode-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">🔢 Rekap per Kode</h2>
                <p class="text-gray-600">Ringkasan stok berdasarkan kode produk</p>
            </div>

            <!-- Top 4 Products -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">🏆 Top 4 Produk Terbanyak</h3>
                <div id="codeTop4" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Top 4 products will be populated by JavaScript -->
                </div>
            </div>
            
            <div id="codeSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Code cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Kode per Size Packing Brand Section -->
        <div id="kode-per-size-brand-section" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800">📦 Kode per Size Packing Brand</h2>
                    <p class="text-gray-600">Detail kode produk berdasarkan ukuran kemasan dan brand</p>
                </div>
                <button onclick="exportSizePackingToPDF()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-file-pdf mr-2"></i>Export PDF
                </button>
            </div>

            <!-- Search Filters -->
            <div class="bg-white p-4 rounded-lg shadow mb-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cari Produk</label>
                        <div class="relative">
                            <input type="text" id="sizePackingProductSearch" placeholder="Ketik nama produk..." 
                                   class="w-full px-3 py-2 pl-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   onkeyup="filterSizePackingData()">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cari Brand</label>
                        <div class="relative">
                            <input type="text" id="sizePackingBrandSearch" placeholder="Ketik nama brand..." 
                                   class="w-full px-3 py-2 pl-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   onkeyup="filterSizePackingData()">
                            <i class="fas fa-tags absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                </div>
                <div class="mt-4 flex gap-2">
                    <button onclick="resetSizePackingFilters()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-undo mr-2"></i>Reset Filter
                    </button>
                    <div class="text-sm text-gray-600 flex items-center">
                        Menampilkan <span id="sizePackingResultCount" class="font-semibold text-blue-600 mx-1">0</span> hasil
                    </div>
                </div>
            </div>

            <!-- Top 4 Products -->
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">🏆 Top 4 Produk Terbanyak</h3>
                <div id="sizePackingTop4" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- Top 4 products will be populated by JavaScript -->
                </div>
            </div>
            
            <div id="sizePackingBrandSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Size packing brand cards will be populated by JavaScript -->
            </div>
        </div>

        <!-- Stok Tanggal Target Section -->
        <div id="stok-hari-ini-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800">📅 Stok Tanggal Target</h2>
                <p class="text-gray-600">Data stok untuk tanggal target: <span id="targetDateDisplay" class="font-semibold text-blue-600">-</span></p>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="targetDateItems">0</div>
                        <div class="text-sm text-gray-600">Total MC</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="targetDateKg">0</div>
                        <div class="text-sm text-gray-600">Total Kg</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600" id="targetDateProducts">0</div>
                        <div class="text-sm text-gray-600">Produk</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-orange-600" id="targetDateBrands">0</div>
                        <div class="text-sm text-gray-600">Brand</div>
                    </div>
                </div>
            </div>
            
            <div id="targetDateTable" class="bg-white rounded-lg shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produk</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Brand</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kode</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">MC</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Kg</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Lokasi</th>
                            </tr>
                        </thead>
                        <tbody id="targetDateTableBody" class="divide-y divide-gray-200">
                            <!-- Target date data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Grafik Section -->
        <div id="grafik-section" class="section hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">📊 Grafik Ringkas</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Stok per Brand</h3>
                    <div style="height: 250px;">
                        <canvas id="brandChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Trend Stok Mingguan</h3>
                    <div style="height: 250px;">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
  EXCEL_URL: 'https://jsdelivr.qaq.qa/gh/PPICWG/Stock/main/WKB.xlsx',
  ITEMS_PER_PAGE: 10,
  REFRESH_INTERVAL: 300000
};
        // User credentials
        const USERS = {
            'admin': { password: 'admin123', role: 'admin', name: 'Administrator' },
            'manager': { password: 'manager123', role: 'manager', name: 'Manager Gudang' },
            'staff': { password: 'staff123', role: 'staff', name: 'Staff Gudang' }
        };

        // CDN data source
        const CDN_DATA_URL = 'https://cdn.jsdelivr.net/gh/PPICWG/Stock/WKB.xlsx';
        let CDN_DATA = [];

        // Global variables
        let currentUser = null;
        let stockData = [];
        let filteredData = [];
        let currentPage = 1;
        let sortColumn = -1;
        let sortDirection = 'asc';
        let isLoading = false;
        let showAllPOs = false;
        let targetDate = '29/01/2024'; // Default target date
        let brandChart = null;
        let trendChart = null;
        let allPOSummaryData = [];
        let allCodeSummaryData = [];
        let allSizePackingSummaryData = [];
        let filteredSizePackingData = [];

        // Authentication functions
        function initAuth() {
            const savedUser = localStorage.getItem('dashboardUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showDashboard();
                } catch (e) {
                    localStorage.removeItem('dashboardUser');
                    showLogin();
                }
            } else {
                showLogin();
            }

            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
        }

        function showLogin() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        function hideLogin() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        function showDashboard() {
            hideLogin();
            updateUserInfo();
            loadData();
            initCharts();
            setCurrentDate();
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const errorDiv = document.getElementById('loginError');
            const buttonText = document.getElementById('loginButtonText');
            const spinner = document.getElementById('loginSpinner');
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            buttonText.classList.add('hidden');
            spinner.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (USERS[username] && USERS[username].password === password) {
                currentUser = {
                    username: username,
                    name: USERS[username].name,
                    role: USERS[username].role,
                    loginTime: new Date().toISOString()
                };
                
                localStorage.setItem('dashboardUser', JSON.stringify(currentUser));
                
                buttonText.innerHTML = '<i class="fas fa-check mr-2"></i>Login Berhasil!';
                buttonText.classList.remove('hidden');
                spinner.classList.add('hidden');
                
                setTimeout(() => {
                    showDashboard();
                }, 500);
                
            } else {
                buttonText.classList.remove('hidden');
                spinner.classList.add('hidden');
                errorDiv.classList.remove('hidden');
                passwordInput.value = '';
            }
        }

        function updateUserInfo() {
            if (!currentUser) return;
            
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');
            
            if (userInfo && userName && userRole) {
                userInfo.classList.remove('hidden');
                userName.textContent = currentUser.name;
                userRole.textContent = currentUser.role;
            }
        }

        function logout() {
            if (confirm('Yakin ingin keluar dari dashboard?')) {
                localStorage.removeItem('dashboardUser');
                currentUser = null;
                location.reload();
            }
        }

        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('passwordToggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye';
            }
        }

        // Data loading functions
        function loadData() {
            console.log('📊 Initializing CDN data loading...');
            
            // Auto-load data from CDN
            loadDataFromCDN();
        }

        async function loadDataFromCDN() {
            console.log('🔄 Loading data from CDN...');
            
            const dataStatus = document.getElementById('dataStatus');
            const loadProgress = document.getElementById('loadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const loadDataBtn = document.getElementById('loadDataBtn');
            
            // Show loading state
            if (dataStatus) dataStatus.textContent = 'Memuat data...';
            if (loadProgress) loadProgress.classList.remove('hidden');
            if (loadDataBtn) loadDataBtn.disabled = true;
            if (progressBar) progressBar.style.width = '0%';
            if (progressText) progressText.textContent = 'Menghubungi CDN...';
            
            try {
                // Update progress
                setTimeout(() => {
                    if (progressBar) progressBar.style.width = '30%';
                    if (progressText) progressText.textContent = 'Mengunduh dari CDN...';
                }, 500);
                
                // Fetch Excel file from CDN with no-cache headers
                const response = await fetch(CONFIG.EXCEL_URL);
const arrayBuffer = await response.arrayBuffer();
const workbook = XLSX.read(arrayBuffer, { type: "array" });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                console.log('📊 Downloaded file size:', arrayBuffer.byteLength, 'bytes');
                
                // Update progress
                if (progressBar) progressBar.style.width = '60%';
                if (progressText) progressText.textContent = 'Memproses data Excel...';
                
                // Parse Excel file
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                console.log('📋 Sheet names:', workbook.SheetNames);
                
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // Get target date from cell J1 if available
                const targetDateCell = worksheet['J1'];
                if (targetDateCell && targetDateCell.v) {
                    targetDate = formatDate(targetDateCell.v);
                    console.log('📅 Target date found:', targetDate);
                }
                
                // Convert to JSON with range to ensure we get all data
                const range = XLSX.utils.decode_range(worksheet['!ref']);
                console.log('📊 Data range:', range);
                
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                    header: 1,
                    defval: '',
                    raw: false
                });
                
                console.log('📊 Raw JSON data rows:', jsonData.length);
                console.log('📊 First few rows:', jsonData.slice(0, 3));
                
                // Update progress
                if (progressBar) progressBar.style.width = '80%';
                if (progressText) progressText.textContent = 'Memformat data...';
                
                // Process data - find header row and data rows
                let headerRowIndex = -1;
                let dataStartIndex = 0;
                
                // Look for header row (contains "Tanggal", "Produk", etc.)
                for (let i = 0; i < Math.min(10, jsonData.length); i++) {
                    const row = jsonData[i];
                    if (row && Array.isArray(row) && row.length > 0) {
                        const firstCell = String(row[0] || '').toLowerCase();
                        if (firstCell.includes('tanggal') || firstCell.includes('date')) {
                            headerRowIndex = i;
                            dataStartIndex = i + 1;
                            break;
                        }
                    }
                }
                
                console.log('📊 Header row index:', headerRowIndex);
                console.log('📊 Data start index:', dataStartIndex);
                
                // Process data rows
                CDN_DATA = [];
                for (let i = dataStartIndex; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (row && Array.isArray(row) && row.length >= 9) {
                        // Check if row has essential data
                        const hasDate = row[0] && String(row[0]).trim() !== '';
                        const hasProduct = row[1] && String(row[1]).trim() !== '';
                        const hasMC = row[6] && !isNaN(parseFloat(row[6]));
                        
                        if (hasDate && hasProduct && hasMC) {
                            // Format the row data
                            const formattedRow = [
                                formatDate(row[0]),           // Tanggal
                                String(row[1] || ''),         // Produk
                                String(row[2] || ''),         // Packing
                                String(row[3] || ''),         // Brand
                                String(row[4] || ''),         // Kode
                                String(row[5] || ''),         // No. PO
                                parseFloat(row[6]) || 0,      // Jumlah MC
                                parseFloat(row[7]) || 0,      // Jumlah Kg
                                String(row[8] || '')          // Lokasi
                            ];
                            CDN_DATA.push(formattedRow);
                        }
                    }
                }
                
                console.log('📊 Processed CDN data rows:', CDN_DATA.length);
                console.log('📊 Sample processed data:', CDN_DATA.slice(0, 2));
                
                if (CDN_DATA.length === 0) {
                    throw new Error('No valid data found in Excel file');
                }
                
                // Complete loading
                completeDataLoading();
                
            } catch (error) {
                console.error('❌ Error loading data from CDN:', error);
                
                // Show error and load sample data as fallback
                if (progressText) progressText.textContent = 'Menggunakan data sampel...';
                if (progressBar) progressBar.style.width = '60%';
                
                setTimeout(() => {
                    loadSampleData();
                }, 1000);
            }
        }
        
        function formatDate(dateValue) {
            if (!dateValue) return '';
            
            // If it's already a string in DD/MM/YYYY format, return as is
            if (typeof dateValue === 'string' && dateValue.includes('/')) {
                return dateValue;
            }
            
            // If it's an Excel date number, convert it
            if (typeof dateValue === 'number') {
                const date = XLSX.SSF.parse_date_code(dateValue);
                if (date) {
                    const day = String(date.d).padStart(2, '0');
                    const month = String(date.m).padStart(2, '0');
                    const year = date.y;
                    return `${day}/${month}/${year}`;
                }
            }
            
            // Try to parse as Date object
            try {
                const date = new Date(dateValue);
                if (!isNaN(date.getTime())) {
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const year = date.getFullYear();
                    return `${day}/${month}/${year}`;
                }
            } catch (e) {
                console.warn('Date parsing error:', e);
            }
            
            return String(dateValue);
        }

        function completeDataLoading() {
            // Load the processed data from CDN
            stockData = [...CDN_DATA];
            filteredData = [...stockData];
            
            // Complete loading UI updates
            const dataStatus = document.getElementById('dataStatus');
            const loadProgress = document.getElementById('loadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const loadDataBtn = document.getElementById('loadDataBtn');
            const dataInfo = document.getElementById('dataInfo');
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionText = document.getElementById('connectionText');
            
            if (progressBar) progressBar.style.width = '100%';
            if (progressText) progressText.textContent = 'Selesai!';
            
            setTimeout(() => {
                if (loadProgress) loadProgress.classList.add('hidden');
                if (loadDataBtn) loadDataBtn.disabled = false;
                if (dataStatus) dataStatus.textContent = 'Data berhasil dimuat';
                if (dataStatus) dataStatus.className = 'text-sm font-medium text-green-600';
                
                if (dataInfo) dataInfo.textContent = `${stockData.length} baris data tersedia`;
                if (connectionStatus) connectionStatus.className = 'w-2 h-2 bg-green-500 rounded-full mr-2';
                if (connectionText) connectionText.textContent = 'Terhubung';
                
                // Update UI
                updateUI();
                
                showNotification('success', `✅ Berhasil memuat ${stockData.length} baris data!`);
                
            }, 1000);
        }

        function loadSampleData() {
            // Sample data that represents the structure from CDN
            CDN_DATA = [
                ['29/01/2024', 'BERAS PREMIUM', '25 KG', 'BRAND A', 'BP001', 'PO-2024-001', 100, 2500, 'GUDANG A'],
                ['29/01/2024', 'GULA PASIR', '1 KG', 'BRAND B', 'GP002', 'PO-2024-002', 200, 200, 'GUDANG B'],
                ['30/01/2024', 'MINYAK GORENG', '2 L', 'BRAND C', 'MG003', 'PO-2024-003', 150, 300, 'GUDANG A'],
                ['30/01/2024', 'TEPUNG TERIGU', '1 KG', 'BRAND A', 'TT004', 'PO-2024-001', 300, 300, 'GUDANG C'],
                ['31/01/2024', 'KOPI BUBUK', '200 G', 'BRAND D', 'KB005', 'PO-2024-004', 80, 16, 'GUDANG B'],
                ['31/01/2024', 'TEH CELUP', '25 PCS', 'BRAND B', 'TC006', 'PO-2024-002', 120, 30, 'GUDANG A'],
                ['01/02/2024', 'SUSU BUBUK', '400 G', 'BRAND E', 'SB007', 'PO-2024-005', 90, 36, 'GUDANG C'],
                ['01/02/2024', 'MENTEGA', '200 G', 'BRAND C', 'MT008', 'PO-2024-003', 60, 12, 'GUDANG B'],
                ['02/02/2024', 'KEJU SLICE', '200 G', 'BRAND F', 'KS009', 'PO-2024-006', 40, 8, 'GUDANG A'],
                ['02/02/2024', 'ROTI TAWAR', '400 G', 'BRAND G', 'RT010', 'PO-2024-007', 75, 30, 'GUDANG C']
            ];
            
            // Set target date from sample data
            targetDate = '29/01/2024';
            
            // Complete loading using the common function
            completeDataLoading();
        }





        function showNotification(type, message) {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50 max-w-md`;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function refreshData() {
            if (stockData.length === 0) {
                showNotification('error', '❌ Tidak ada data untuk direfresh. Muat data dari CDN terlebih dahulu.');
                return;
            }
            
            console.log('🔄 Refreshing data...');
            
            // Simulate data refresh
            const refreshBtn = event.target;
            const originalText = refreshBtn.innerHTML;
            
            refreshBtn.innerHTML = '<div class="loading-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></div>Refreshing...';
            refreshBtn.disabled = true;
            
            setTimeout(() => {
                // Reload from CDN data
                filteredData = [...stockData];
                updateUI();
                
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
                
                showNotification('success', '✅ Data berhasil direfresh!');
                
            }, 2000);
        }

        // UI functions
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            if (sidebar) sidebar.classList.toggle('open');
            if (overlay) overlay.classList.toggle('show');
        }

        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            if (sidebar) sidebar.classList.remove('open');
            if (overlay) overlay.classList.remove('show');
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-purple-600', 'text-white');
                item.classList.add('text-gray-700');
            });
            
            if (event && event.target) {
                const sidebarItem = event.target.closest('.sidebar-item');
                if (sidebarItem) {
                    sidebarItem.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-purple-600', 'text-white');
                    sidebarItem.classList.remove('text-gray-700');
                }
            }
            
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
            
            // Update section-specific data when switching sections
            updateSectionData(sectionName);
        }

        function updateSectionData(sectionName) {
            if (stockData.length === 0) return;
            
            switch(sectionName) {
                case 'rekap-po':
                    updatePOSummary();
                    break;
                case 'rekap-brand':
                    updateBrandSummary();
                    break;
                case 'rekap-lokasi':
                    updateLocationSummary();
                    break;
                case 'rekap-kode':
                    updateCodeSummary();
                    break;
                case 'kode-per-size-brand':
                    updateSizePackingBrandSummary();
                    break;
                case 'stok-hari-ini':
                    updateTargetDateData();
                    break;
                case 'grafik':
                    updateCharts();
                    break;
            }
        }

        function updateUI() {
            if (stockData.length === 0) {
                return;
            }
            
            populateFilters();
            populateTable();
            updateStats();
            updateAllSummaries();
            updateCharts();
            updateCurrentDate();
        }

        // Data processing functions
        function populateFilters() {
            const brands = [...new Set(stockData.map(row => row[3]).filter(item => item && item !== '-'))];
            const locations = [...new Set(stockData.map(row => row[8]).filter(item => item && item !== '-'))];
            
            const brandFilter = document.getElementById('brandFilter');
            const locationFilter = document.getElementById('locationFilter');
            
            if (brandFilter) {
                brandFilter.innerHTML = '<option value="">Semua Brand</option>' + 
                    brands.map(b => `<option value="${b}">${b}</option>`).join('');
            }
            
            if (locationFilter) {
                locationFilter.innerHTML = '<option value="">Semua Lokasi</option>' + 
                    locations.map(l => `<option value="${l}">${l}</option>`).join('');
            }
        }

        function populateTable() {
            const tbody = document.getElementById('stockTableBody');
            if (!tbody) return;
            
            const start = (currentPage - 1) * CONFIG.ITEMS_PER_PAGE;
            const end = Math.min(start + CONFIG.ITEMS_PER_PAGE, filteredData.length);
            
            tbody.innerHTML = filteredData.slice(start, end).map(row => `
                <tr class="table-row">
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${row[0]}</td>
                    <td class="px-6 py-4 text-sm font-semibold text-gray-900">${row[1]}</td>
                    <td class="px-6 py-4 text-sm text-gray-700 font-medium">${row[2]}</td>
                    <td class="px-6 py-4 text-sm">
                        <span class="badge px-3 py-1 rounded-full text-xs font-medium text-blue-800">${row[3]}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 font-mono font-medium">${row[4]}</td>
                    <td class="px-6 py-4 text-sm text-gray-900 font-mono font-medium">${row[5]}</td>
                    <td class="px-6 py-4 text-sm text-gray-900 text-right font-bold">${row[6]}</td>
                    <td class="px-6 py-4 text-sm text-green-600 text-right font-bold">${row[7]} kg</td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                        <span class="badge-green px-3 py-1 rounded-full text-xs font-medium text-green-800">${row[8] || '-'}</span>
                    </td>
                </tr>
            `).join('');
            
            updatePagination();
        }

        function updatePagination() {
            const total = filteredData.length;
            const start = (currentPage - 1) * CONFIG.ITEMS_PER_PAGE + 1;
            const end = Math.min(currentPage * CONFIG.ITEMS_PER_PAGE, total);
            const maxPages = Math.ceil(total / CONFIG.ITEMS_PER_PAGE);
            
            const showingStart = document.getElementById('showingStart');
            const showingEnd = document.getElementById('showingEnd');
            const totalRecords = document.getElementById('totalRecords');
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (showingStart) showingStart.textContent = total > 0 ? start : 0;
            if (showingEnd) showingEnd.textContent = end;
            if (totalRecords) totalRecords.textContent = total;
            if (pageInfo) pageInfo.textContent = `${currentPage} / ${maxPages}`;
            
            if (prevBtn) prevBtn.disabled = currentPage <= 1;
            if (nextBtn) nextBtn.disabled = currentPage >= maxPages;
        }

        function updateStats() {
            const totalItems = filteredData.reduce((sum, row) => sum + (parseInt(row[6]) || 0), 0);
            const totalKg = filteredData.reduce((sum, row) => sum + (parseFloat(row[7]) || 0), 0);
            const uniqueProducts = new Set(filteredData.map(row => row[1])).size;
            const uniqueBrands = new Set(filteredData.map(row => row[3])).size;
            
            const totalItemsEl = document.getElementById('totalItems');
            const totalKgEl = document.getElementById('totalKg');
            const uniqueProductsEl = document.getElementById('uniqueProducts');
            const uniqueBrandsEl = document.getElementById('uniqueBrands');
            
            if (totalItemsEl) totalItemsEl.textContent = totalItems.toLocaleString();
            if (totalKgEl) totalKgEl.textContent = totalKg.toLocaleString();
            if (uniqueProductsEl) uniqueProductsEl.textContent = uniqueProducts;
            if (uniqueBrandsEl) uniqueBrandsEl.textContent = uniqueBrands;
        }

        // Summary functions
        function updateAllSummaries() {
            updatePOSummary();
            updateBrandSummary();
            updateLocationSummary();
            updateCodeSummary();
            updateSizePackingBrandSummary();
            updateTargetDateData();
        }

        function updateTop4Products(containerId, data) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Get top 4 products by total kg and mc
            const productData = {};
            data.forEach(row => {
                const product = row[1];
                const kg = parseFloat(row[7]) || 0;
                const mc = parseInt(row[6]) || 0;
                
                if (!productData[product]) {
                    productData[product] = { kg: 0, mc: 0 };
                }
                productData[product].kg += kg;
                productData[product].mc += mc;
            });

            const top4 = Object.entries(productData)
                .sort((a, b) => b[1].kg - a[1].kg)
                .slice(0, 4);

            container.innerHTML = top4.map((item, index) => {
                const medals = ['🥇', '🥈', '🥉', '🏅'];
                const colors = ['text-yellow-600', 'text-gray-500', 'text-orange-600', 'text-blue-600'];
                
                return `
                    <div class="text-center p-3 bg-gray-50 rounded-lg">
                        <div class="text-2xl mb-1">${medals[index]}</div>
                        <div class="text-sm font-medium ${colors[index]} mb-1">${item[0]}</div>
                        <div class="text-xs text-gray-600 mb-1">${item[1].kg.toLocaleString()} kg</div>
                        <div class="text-xs text-blue-600">${item[1].mc.toLocaleString()} MC</div>
                    </div>
                `;
            }).join('');
        }

        function updatePOSummary() {
            const poData = {};
            
            stockData.forEach(row => {
                const po = row[5];
                const mc = parseInt(row[6]) || 0;
                const kg = parseFloat(row[7]) || 0;
                
                if (!poData[po]) {
                    poData[po] = { mc: 0, kg: 0, products: new Set(), brands: new Set() };
                }
                
                poData[po].mc += mc;
                poData[po].kg += kg;
                poData[po].products.add(row[1]);
                poData[po].brands.add(row[3]);
            });
            
            allPOSummaryData = Object.entries(poData)
                .map(([po, data]) => ({
                    po,
                    mc: data.mc,
                    kg: data.kg,
                    products: data.products.size,
                    brands: data.brands.size
                }))
                .sort((a, b) => b.kg - a.kg);
            
            // Update PO statistics
            const totalPOItems = allPOSummaryData.reduce((sum, item) => sum + item.mc, 0);
            const totalPOKg = allPOSummaryData.reduce((sum, item) => sum + item.kg, 0);
            const avgItemsPerPO = allPOSummaryData.length > 0 ? Math.round(totalPOItems / allPOSummaryData.length) : 0;
            
            document.getElementById('totalPOCount').textContent = allPOSummaryData.length;
            document.getElementById('totalPOItems').textContent = totalPOItems.toLocaleString();
            document.getElementById('totalPOKg').textContent = totalPOKg.toLocaleString();
            document.getElementById('avgItemsPerPO').textContent = avgItemsPerPO;
            
            // Update top 4 products
            updateTop4Products('poTop4', stockData);
            
            renderPOSummary();
        }

        function renderPOSummary() {
            const container = document.getElementById('poSummary');
            if (!container) return;
            
            const displayData = showAllPOs ? allPOSummaryData : allPOSummaryData.slice(0, 6);
            
            // Get top 3 products for each PO
            const poWithTop3 = displayData.map(poItem => {
                const poProducts = {};
                stockData.filter(row => row[5] === poItem.po).forEach(row => {
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (!poProducts[product]) {
                        poProducts[product] = { mc: 0, kg: 0 };
                    }
                    poProducts[product].mc += mc;
                    poProducts[product].kg += kg;
                });
                
                const top3Products = Object.entries(poProducts)
                    .sort((a, b) => b[1].kg - a[1].kg)
                    .slice(0, 3);
                
                return { ...poItem, top3Products };
            });
            
            container.innerHTML = poWithTop3.map(item => `
                <div class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">${item.po}</h3>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">${item.brands} Brand</span>
                    </div>
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total MC:</span>
                            <span class="font-medium">${item.mc.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Kg:</span>
                            <span class="font-medium text-green-600">${item.kg.toLocaleString()} kg</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Produk:</span>
                            <span class="font-medium">${item.products}</span>
                        </div>
                    </div>
                    
                    <!-- Top 3 Products -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3">🏆 Top 3 Produk:</h4>
                        <div class="space-y-2">
                            ${item.top3Products.map((product, index) => {
                                const medals = ['🥇', '🥈', '🥉'];
                                return `
                                    <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                        <div class="flex items-center">
                                            <span class="mr-2">${medals[index]}</span>
                                            <span class="text-sm font-medium text-gray-800">${product[0]}</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-xs text-blue-600 font-medium">${product[1].mc.toLocaleString()} MC</div>
                                            <div class="text-xs text-green-600 font-medium">${product[1].kg.toLocaleString()} kg</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Update display info
            document.getElementById('displayedPOCount').textContent = displayData.length;
            document.getElementById('poDisplayInfo').textContent = showAllPOs ? 
                `Menampilkan semua ${allPOSummaryData.length} PO` : 
                `Menampilkan ${Math.min(6, allPOSummaryData.length)} PO teratas`;
            
            // Update button text
            const btn = document.getElementById('showAllPOsBtn');
            if (btn) {
                btn.innerHTML = showAllPOs ? 
                    '<i class="fas fa-eye-slash mr-2"></i>Tampilkan 6 Teratas' : 
                    '<i class="fas fa-eye mr-2"></i>Tampilkan Semua PO';
            }
        }

        function updateBrandSummary() {
            const brandData = {};
            
            stockData.forEach(row => {
                const brand = row[3];
                const mc = parseInt(row[6]) || 0;
                const kg = parseFloat(row[7]) || 0;
                
                if (!brandData[brand]) {
                    brandData[brand] = { mc: 0, kg: 0, products: new Set() };
                }
                
                brandData[brand].mc += mc;
                brandData[brand].kg += kg;
                brandData[brand].products.add(row[1]);
            });
            
            const brandSummaryData = Object.entries(brandData)
                .map(([brand, data]) => ({
                    brand,
                    mc: data.mc,
                    kg: data.kg,
                    products: data.products.size
                }))
                .sort((a, b) => b.kg - a.kg);
            
            // Update brand statistics
            const totalBrandItems = brandSummaryData.reduce((sum, item) => sum + item.mc, 0);
            const totalBrandKg = brandSummaryData.reduce((sum, item) => sum + item.kg, 0);
            const avgKgPerBrand = brandSummaryData.length > 0 ? Math.round(totalBrandKg / brandSummaryData.length) : 0;
            
            document.getElementById('totalBrandItems').textContent = totalBrandItems.toLocaleString();
            document.getElementById('totalBrandKg').textContent = totalBrandKg.toLocaleString();
            document.getElementById('totalBrandCount').textContent = brandSummaryData.length;
            document.getElementById('avgKgPerBrand').textContent = avgKgPerBrand;

            // Update top 4 products
            updateTop4Products('brandTop4', stockData);
            
            // Get top 3 products for each brand
            const brandWithTop3 = brandSummaryData.map(brandItem => {
                const brandProducts = {};
                stockData.filter(row => row[3] === brandItem.brand).forEach(row => {
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (!brandProducts[product]) {
                        brandProducts[product] = { mc: 0, kg: 0 };
                    }
                    brandProducts[product].mc += mc;
                    brandProducts[product].kg += kg;
                });
                
                const top3Products = Object.entries(brandProducts)
                    .sort((a, b) => b[1].kg - a[1].kg)
                    .slice(0, 3);
                
                return { ...brandItem, top3Products };
            });
            
            // Render brand summary
            const container = document.getElementById('brandSummary');
            if (container) {
                container.innerHTML = brandWithTop3.map(item => `
                    <div class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">${item.brand}</h3>
                            <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">${item.products} Produk</span>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total MC:</span>
                                <span class="font-medium">${item.mc.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Kg:</span>
                                <span class="font-medium text-green-600">${item.kg.toLocaleString()} kg</span>
                            </div>
                        </div>
                        
                        <!-- Top 3 Products -->
                        <div class="border-t pt-4">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">🏆 Top 3 Produk:</h4>
                            <div class="space-y-2">
                                ${item.top3Products.map((product, index) => {
                                    const medals = ['🥇', '🥈', '🥉'];
                                    return `
                                        <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                            <div class="flex items-center">
                                                <span class="mr-2">${medals[index]}</span>
                                                <span class="text-sm font-medium text-gray-800">${product[0]}</span>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-xs text-blue-600 font-medium">${product[1].mc.toLocaleString()} MC</div>
                                                <div class="text-xs text-green-600 font-medium">${product[1].kg.toLocaleString()} kg</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateLocationSummary() {
            const locationData = {};
            
            stockData.forEach(row => {
                const location = row[8] || 'Tidak Diketahui';
                const mc = parseInt(row[6]) || 0;
                const kg = parseFloat(row[7]) || 0;
                
                if (!locationData[location]) {
                    locationData[location] = { mc: 0, kg: 0, products: new Set(), brands: new Set() };
                }
                
                locationData[location].mc += mc;
                locationData[location].kg += kg;
                locationData[location].products.add(row[1]);
                locationData[location].brands.add(row[3]);
            });
            
            const locationSummaryData = Object.entries(locationData)
                .map(([location, data]) => ({
                    location,
                    mc: data.mc,
                    kg: data.kg,
                    products: data.products.size,
                    brands: data.brands.size
                }))
                .sort((a, b) => b.kg - a.kg);

            // Update top 4 products
            updateTop4Products('locationTop4', stockData);
            
            // Get top 3 products for each location
            const locationWithTop3 = locationSummaryData.map(locationItem => {
                const locationProducts = {};
                stockData.filter(row => (row[8] || 'Tidak Diketahui') === locationItem.location).forEach(row => {
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (!locationProducts[product]) {
                        locationProducts[product] = { mc: 0, kg: 0 };
                    }
                    locationProducts[product].mc += mc;
                    locationProducts[product].kg += kg;
                });
                
                const top3Products = Object.entries(locationProducts)
                    .sort((a, b) => b[1].kg - a[1].kg)
                    .slice(0, 3);
                
                return { ...locationItem, top3Products };
            });
            
            // Render location summary
            const container = document.getElementById('locationSummary');
            if (container) {
                container.innerHTML = locationWithTop3.map(item => `
                    <div class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">${item.location}</h3>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">${item.brands} Brand</span>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total MC:</span>
                                <span class="font-medium">${item.mc.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Kg:</span>
                                <span class="font-medium text-green-600">${item.kg.toLocaleString()} kg</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Produk:</span>
                                <span class="font-medium">${item.products}</span>
                            </div>
                        </div>
                        
                        <!-- Top 3 Products -->
                        <div class="border-t pt-4">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">🏆 Top 3 Produk:</h4>
                            <div class="space-y-2">
                                ${item.top3Products.map((product, index) => {
                                    const medals = ['🥇', '🥈', '🥉'];
                                    return `
                                        <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                            <div class="flex items-center">
                                                <span class="mr-2">${medals[index]}</span>
                                                <span class="text-sm font-medium text-gray-800">${product[0]}</span>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-xs text-blue-600 font-medium">${product[1].mc.toLocaleString()} MC</div>
                                                <div class="text-xs text-green-600 font-medium">${product[1].kg.toLocaleString()} kg</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateCodeSummary() {
            const codeData = {};
            
            stockData.forEach(row => {
                const code = row[4];
                const mc = parseInt(row[6]) || 0;
                const kg = parseFloat(row[7]) || 0;
                
                if (!codeData[code]) {
                    codeData[code] = { 
                        mc: 0, 
                        kg: 0, 
                        product: row[1], 
                        brand: row[3], 
                        packing: row[2] 
                    };
                }
                
                codeData[code].mc += mc;
                codeData[code].kg += kg;
            });
            
            allCodeSummaryData = Object.entries(codeData)
                .map(([code, data]) => ({
                    code,
                    mc: data.mc,
                    kg: data.kg,
                    product: data.product,
                    brand: data.brand,
                    packing: data.packing
                }))
                .sort((a, b) => b.kg - a.kg);

            // Update top 4 products
            updateTop4Products('codeTop4', stockData);
            
            // Get top 3 products for code summary (by brand)
            const brandProductsForCode = {};
            stockData.forEach(row => {
                const brand = row[3];
                const product = row[1];
                const mc = parseInt(row[6]) || 0;
                const kg = parseFloat(row[7]) || 0;
                
                if (!brandProductsForCode[brand]) {
                    brandProductsForCode[brand] = {};
                }
                
                if (!brandProductsForCode[brand][product]) {
                    brandProductsForCode[brand][product] = { mc: 0, kg: 0 };
                }
                
                brandProductsForCode[brand][product].mc += mc;
                brandProductsForCode[brand][product].kg += kg;
            });
            
            // Get top 3 products for each brand
            const brandTop3Products = {};
            Object.keys(brandProductsForCode).forEach(brand => {
                brandTop3Products[brand] = Object.entries(brandProductsForCode[brand])
                    .sort((a, b) => b[1].kg - a[1].kg)
                    .slice(0, 3);
            });
            
            // Render code summary
            const container = document.getElementById('codeSummary');
            if (container) {
                container.innerHTML = allCodeSummaryData.map(item => `
                    <div class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 font-mono">${item.code}</h3>
                            <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs">${item.brand}</span>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="text-sm text-gray-600 mb-2">${item.product} - ${item.packing}</div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total MC:</span>
                                <span class="font-medium">${item.mc.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Kg:</span>
                                <span class="font-medium text-green-600">${item.kg.toLocaleString()} kg</span>
                            </div>
                        </div>
                        
                        <!-- Top 3 Products for this Brand -->
                        ${brandTop3Products[item.brand] ? `
                        <div class="border-t pt-4">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">🏆 Top 3 Produk Brand ${item.brand}:</h4>
                            <div class="space-y-2">
                                ${brandTop3Products[item.brand].map((product, index) => {
                                    const medals = ['🥇', '🥈', '🥉'];
                                    return `
                                        <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                            <div class="flex items-center">
                                                <span class="mr-2">${medals[index]}</span>
                                                <span class="text-sm font-medium text-gray-800">${product[0]}</span>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-xs text-blue-600 font-medium">${product[1].mc.toLocaleString()} MC</div>
                                                <div class="text-xs text-green-600 font-medium">${product[1].kg.toLocaleString()} kg</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `).join('');
            }
        }

        function updateSizePackingBrandSummary() {
            const sizePackingBrandData = {};
            
            stockData.forEach(row => {
                const key = `${row[2]}-${row[3]}`; // packing-brand
                const mc = parseInt(row[6]) || 0;
                const kg = parseFloat(row[7]) || 0;
                const po = row[5];
                const code = row[4];
                const product = row[1];
                
                if (!sizePackingBrandData[key]) {
                    sizePackingBrandData[key] = { 
                        mc: 0, 
                        kg: 0, 
                        packing: row[2], 
                        brand: row[3], 
                        codes: new Set(),
                        products: new Set(),
                        pos: new Set(),
                        details: []
                    };
                }
                
                sizePackingBrandData[key].mc += mc;
                sizePackingBrandData[key].kg += kg;
                sizePackingBrandData[key].codes.add(code);
                sizePackingBrandData[key].products.add(product);
                sizePackingBrandData[key].pos.add(po);
                
                // Store detailed information
                sizePackingBrandData[key].details.push({
                    po: po,
                    code: code,
                    product: product,
                    mc: mc,
                    kg: kg
                });
            });
            
            allSizePackingSummaryData = Object.entries(sizePackingBrandData)
                .map(([key, data]) => ({
                    key,
                    mc: data.mc,
                    kg: data.kg,
                    packing: data.packing,
                    brand: data.brand,
                    codes: data.codes.size,
                    products: data.products.size,
                    pos: Array.from(data.pos),
                    details: data.details
                }))
                .sort((a, b) => b.kg - a.kg);

            // Initialize filtered data
            filteredSizePackingData = [...allSizePackingSummaryData];

            // Update top 4 products
            updateTop4Products('sizePackingTop4', stockData);
            
            // Render size packing brand summary
            renderSizePackingBrandSummary();
        }

        function renderSizePackingBrandSummary() {
            const container = document.getElementById('sizePackingBrandSummary');
            const resultCount = document.getElementById('sizePackingResultCount');
            
            if (resultCount) {
                resultCount.textContent = filteredSizePackingData.length;
            }
            
            if (container) {
                container.innerHTML = filteredSizePackingData.map((item, index) => `
                    <div class="bg-white rounded-lg shadow hover:shadow-md transition-shadow">
                        <!-- Header Card -->
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">${item.packing}</h3>
                                <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">${item.brand}</span>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div>
                                    <div class="text-xl font-bold text-blue-600">${item.mc.toLocaleString()}</div>
                                    <div class="text-xs text-gray-600">Total MC</div>
                                </div>
                                <div>
                                    <div class="text-xl font-bold text-green-600">${item.kg.toLocaleString()}</div>
                                    <div class="text-xs text-gray-600">Total Kg</div>
                                </div>
                                <div>
                                    <div class="text-xl font-bold text-purple-600">${item.codes}</div>
                                    <div class="text-xs text-gray-600">Kode</div>
                                </div>
                                <div>
                                    <div class="text-xl font-bold text-orange-600">${item.products}</div>
                                    <div class="text-xs text-gray-600">Produk</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- PO List -->
                        <div class="p-4 bg-gray-50">
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">📋 Daftar PO (${item.pos.length}):</h4>
                            <div class="flex flex-wrap gap-1">
                                ${item.pos.map(po => `
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-mono">${po}</span>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Detailed Breakdown -->
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-semibold text-gray-700">📊 Detail per Kode & PO:</h4>
                                <button onclick="toggleDetails(${index})" class="text-blue-600 hover:text-blue-800 text-xs">
                                    <span id="toggleText${index}">Tampilkan Detail</span>
                                    <i id="toggleIcon${index}" class="fas fa-chevron-down ml-1"></i>
                                </button>
                            </div>
                            
                            <div id="details${index}" class="hidden">
                                <div class="overflow-x-auto">
                                    <table class="w-full text-xs">
                                        <thead class="bg-gray-100">
                                            <tr>
                                                <th class="px-2 py-2 text-left font-medium text-gray-700">PO</th>
                                                <th class="px-2 py-2 text-left font-medium text-gray-700">Kode</th>
                                                <th class="px-2 py-2 text-left font-medium text-gray-700">Produk</th>
                                                <th class="px-2 py-2 text-right font-medium text-gray-700">MC</th>
                                                <th class="px-2 py-2 text-right font-medium text-gray-700">Kg</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${item.details.map(detail => `
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-2 py-2 font-mono text-blue-600">${detail.po}</td>
                                                    <td class="px-2 py-2 font-mono text-gray-800">${detail.code}</td>
                                                    <td class="px-2 py-2 text-gray-700">${detail.product}</td>
                                                    <td class="px-2 py-2 text-right font-medium">${detail.mc.toLocaleString()}</td>
                                                    <td class="px-2 py-2 text-right font-medium text-green-600">${detail.kg.toLocaleString()}</td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function filterSizePackingData() {
            const productSearch = document.getElementById('sizePackingProductSearch')?.value?.toLowerCase() || '';
            const brandSearch = document.getElementById('sizePackingBrandSearch')?.value?.toLowerCase() || '';
            
            filteredSizePackingData = allSizePackingSummaryData.filter(item => {
                const matchesProduct = !productSearch || 
                    item.details.some(detail => detail.product.toLowerCase().includes(productSearch));
                const matchesBrand = !brandSearch || 
                    item.brand.toLowerCase().includes(brandSearch);
                
                return matchesProduct && matchesBrand;
            });
            
            renderSizePackingBrandSummary();
        }

        function resetSizePackingFilters() {
            const productSearchEl = document.getElementById('sizePackingProductSearch');
            const brandSearchEl = document.getElementById('sizePackingBrandSearch');
            
            if (productSearchEl) productSearchEl.value = '';
            if (brandSearchEl) brandSearchEl.value = '';
            
            filteredSizePackingData = [...allSizePackingSummaryData];
            renderSizePackingBrandSummary();
        }

        function updateTargetDateData() {
            const targetDateData = stockData.filter(row => row[0] === targetDate);
            
            const totalItems = targetDateData.reduce((sum, row) => sum + (parseInt(row[6]) || 0), 0);
            const totalKg = targetDateData.reduce((sum, row) => sum + (parseFloat(row[7]) || 0), 0);
            const uniqueProducts = new Set(targetDateData.map(row => row[1])).size;
            const uniqueBrands = new Set(targetDateData.map(row => row[3])).size;
            
            // Update target date display
            document.getElementById('targetDateDisplay').textContent = targetDate;
            document.getElementById('targetDateItems').textContent = totalItems.toLocaleString();
            document.getElementById('targetDateKg').textContent = totalKg.toLocaleString();
            document.getElementById('targetDateProducts').textContent = uniqueProducts;
            document.getElementById('targetDateBrands').textContent = uniqueBrands;
            
            // Render target date table
            const tbody = document.getElementById('targetDateTableBody');
            if (tbody) {
                tbody.innerHTML = targetDateData.map(row => `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${row[1]}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">${row[3]}</span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 font-mono">${row[4]}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 text-right">${row[6]}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 text-right font-medium">${row[7]} kg</td>
                        <td class="px-4 py-3 text-sm text-gray-900">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">${row[8] || '-'}</span>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Chart functions
        function initCharts() {
            initBrandChart();
            initTrendChart();
        }

        function initBrandChart() {
            const ctx = document.getElementById('brandChart');
            if (!ctx) return;
            
            brandChart = new Chart(ctx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function initTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;
            
            trendChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Total Stok (kg)',
                        data: [],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#3B82F6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { 
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + ' kg';
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} kg`;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        function updateCharts() {
            if (!brandChart || !filteredData.length) return;
            
            const brandData = {};
            filteredData.forEach(row => {
                const brand = row[3];
                const kg = parseFloat(row[7]) || 0;
                brandData[brand] = (brandData[brand] || 0) + kg;
            });
            
            const brands = Object.keys(brandData).slice(0, 5);
            const values = brands.map(brand => brandData[brand]);
            
            brandChart.data.labels = brands;
            brandChart.data.datasets[0].data = values;
            brandChart.update();
            
            updateTrendChart();
        }

        function updateTrendChart() {
            if (!trendChart || !filteredData.length) return;
            
            const dailyData = {};
            filteredData.forEach(row => {
                const date = row[0];
                const kg = parseFloat(row[7]) || 0;
                
                if (date && date !== '-') {
                    if (!dailyData[date]) dailyData[date] = 0;
                    dailyData[date] += kg;
                }
            });
            
            const sortedDates = Object.keys(dailyData).sort();
            const last7Days = sortedDates.slice(-7);
            
            const labels = [];
            const data = [];
            
            if (last7Days.length > 0) {
                last7Days.forEach(date => {
                    labels.push(date);
                    data.push(dailyData[date]);
                });
            } else {
                labels.push('Hari ini');
                data.push(0);
            }
            
            trendChart.data.labels = labels;
            trendChart.data.datasets[0].data = data;
            trendChart.update();
        }

        // Filter and action functions
        function applyFilters() {
            const startDate = document.getElementById('startDate')?.value;
            const endDate = document.getElementById('endDate')?.value;
            const brand = document.getElementById('brandFilter')?.value;
            const location = document.getElementById('locationFilter')?.value;
            const searchTerm = document.getElementById('searchProduct')?.value?.toLowerCase() || '';
            
            filteredData = stockData.filter(row => {
                let matchesDate = true;
                
                if (startDate || endDate) {
                    // Simple date matching - you can enhance this with proper date parsing
                    const rowDate = row[0];
                    // Add proper date filtering logic here if needed
                }
                
                const matchesBrand = !brand || row[3] === brand;
                const matchesLocation = !location || row[8] === location;
                
                const matchesSearch = !searchTerm || 
                    row[1].toLowerCase().includes(searchTerm) ||
                    row[3].toLowerCase().includes(searchTerm) ||
                    row[2].toLowerCase().includes(searchTerm);
                
                return matchesDate && matchesBrand && matchesLocation && matchesSearch;
            });
            
            currentPage = 1;
            updateUI();
        }

        function resetFilters() {
            const startDateEl = document.getElementById('startDate');
            const endDateEl = document.getElementById('endDate');
            const brandFilterEl = document.getElementById('brandFilter');
            const locationFilterEl = document.getElementById('locationFilter');
            const searchProductEl = document.getElementById('searchProduct');
            
            if (startDateEl) startDateEl.value = '';
            if (endDateEl) endDateEl.value = '';
            if (brandFilterEl) brandFilterEl.value = '';
            if (locationFilterEl) locationFilterEl.value = '';
            if (searchProductEl) searchProductEl.value = '';
            
            filteredData = [...stockData];
            currentPage = 1;
            updateUI();
        }

        function sortTable(columnIndex) {
            if (sortColumn === columnIndex) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = columnIndex;
                sortDirection = 'asc';
            }
            
            filteredData.sort((a, b) => {
                let aVal = a[columnIndex];
                let bVal = b[columnIndex];
                
                if (columnIndex === 6 || columnIndex === 7) {
                    aVal = parseFloat(aVal) || 0;
                    bVal = parseFloat(bVal) || 0;
                }
                
                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            populateTable();
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                populateTable();
            }
        }

        function nextPage() {
            const maxPages = Math.ceil(filteredData.length / CONFIG.ITEMS_PER_PAGE);
            if (currentPage < maxPages) {
                currentPage++;
                populateTable();
            }
        }

        function toggleShowAllPOs() {
            showAllPOs = !showAllPOs;
            renderPOSummary();
        }

        function filterPOSummary() {
            const searchTerm = document.getElementById('poSearchInput')?.value?.toLowerCase() || '';
            
            if (!searchTerm) {
                renderPOSummary();
                return;
            }
            
            const filteredPOs = allPOSummaryData.filter(item => 
                item.po.toLowerCase().includes(searchTerm)
            );
            
            // Get top 3 products for each filtered PO
            const filteredPOsWithTop3 = filteredPOs.map(poItem => {
                const poProducts = {};
                stockData.filter(row => row[5] === poItem.po).forEach(row => {
                    const product = row[1];
                    const mc = parseInt(row[6]) || 0;
                    const kg = parseFloat(row[7]) || 0;
                    
                    if (!poProducts[product]) {
                        poProducts[product] = { mc: 0, kg: 0 };
                    }
                    poProducts[product].mc += mc;
                    poProducts[product].kg += kg;
                });
                
                const top3Products = Object.entries(poProducts)
                    .sort((a, b) => b[1].kg - a[1].kg)
                    .slice(0, 3);
                
                return { ...poItem, top3Products };
            });
            
            const container = document.getElementById('poSummary');
            if (container) {
                container.innerHTML = filteredPOsWithTop3.map(item => `
                    <div class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">${item.po}</h3>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">${item.brands} Brand</span>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total MC:</span>
                                <span class="font-medium">${item.mc.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Total Kg:</span>
                                <span class="font-medium text-green-600">${item.kg.toLocaleString()} kg</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Produk:</span>
                                <span class="font-medium">${item.products}</span>
                            </div>
                        </div>
                        
                        <!-- Top 3 Products -->
                        <div class="border-t pt-4">
                            <h4 class="text-sm font-semibold text-gray-700 mb-3">🏆 Top 3 Produk:</h4>
                            <div class="space-y-2">
                                ${item.top3Products.map((product, index) => {
                                    const medals = ['🥇', '🥈', '🥉'];
                                    return `
                                        <div class="flex items-center justify-between bg-gray-50 p-2 rounded">
                                            <div class="flex items-center">
                                                <span class="mr-2">${medals[index]}</span>
                                                <span class="text-sm font-medium text-gray-800">${product[0]}</span>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-xs text-blue-600 font-medium">${product[1].mc.toLocaleString()} MC</div>
                                                <div class="text-xs text-green-600 font-medium">${product[1].kg.toLocaleString()} kg</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function exportToPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(16);
                doc.text('Dashboard Stok Produk v3 - GitHub Data', 20, 20);
                
                doc.setFontSize(10);
                doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 20, 30);
                doc.text(`Total Data: ${filteredData.length} baris`, 20, 35);
                
                const tableData = filteredData.map(row => [
                    row[0], row[1], row[2], row[3], row[4], row[5], row[6], row[7] + ' kg', row[8]
                ]);
                
                doc.autoTable({
                    head: [['Tanggal', 'Produk', 'Packing', 'Brand', 'Kode', 'No. PO', 'MC', 'Kg', 'Lokasi']],
                    body: tableData,
                    startY: 45,
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [59, 130, 246] }
                });
                
                doc.save('dashboard-stok-produk-v3.pdf');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Gagal membuat PDF. Silakan coba lagi.');
            }
        }

        function exportSizePackingToPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(16);
                doc.text('Rekap Kode per Size Packing Brand', 20, 20);
                
                doc.setFontSize(10);
                doc.text(`Tanggal: ${new Date().toLocaleDateString('id-ID')}`, 20, 30);
                doc.text(`Total Data: ${allSizePackingSummaryData.length} kombinasi`, 20, 35);
                
                const tableData = allSizePackingSummaryData.map(item => [
                    item.packing,
                    item.brand,
                    item.mc.toLocaleString(),
                    item.kg.toLocaleString() + ' kg',
                    item.codes,
                    item.products
                ]);
                
                doc.autoTable({
                    head: [['Size Packing', 'Brand', 'Total MC', 'Total Kg', 'Jumlah Kode', 'Jumlah Produk']],
                    body: tableData,
                    startY: 45,
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [99, 102, 241] }
                });
                
                doc.save('rekap-kode-per-size-packing-brand.pdf');
                showNotification('success', '✅ PDF berhasil diunduh!');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                showNotification('error', '❌ Gagal membuat PDF. Silakan coba lagi.');
            }
        }

        function setCurrentDate() {
            const currentDateEl = document.getElementById('currentDate');
            if (currentDateEl) {
                const today = new Date();
                currentDateEl.textContent = today.toLocaleDateString('id-ID');
            }
        }

        function updateCurrentDate() {
            setCurrentDate();
        }

        // Toggle details function for size packing brand
        function toggleDetails(index) {
            const detailsDiv = document.getElementById(`details${index}`);
            const toggleText = document.getElementById(`toggleText${index}`);
            const toggleIcon = document.getElementById(`toggleIcon${index}`);
            
            if (detailsDiv.classList.contains('hidden')) {
                detailsDiv.classList.remove('hidden');
                toggleText.textContent = 'Sembunyikan Detail';
                toggleIcon.className = 'fas fa-chevron-up ml-1';
            } else {
                detailsDiv.classList.add('hidden');
                toggleText.textContent = 'Tampilkan Detail';
                toggleIcon.className = 'fas fa-chevron-down ml-1';
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing Dashboard v3 - GitHub Data...');
            initAuth();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'967ed92c3461c649',t:'MTc1Mzk4MzI4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
